function $CombineDelegates(del1,del2){if(null==del1)return del2;if(null==del2)return del1;var del=$CreateMulticastDelegateFunction();if(del.delegates=[],del1.isMulticastDelegate)for(var i=0;i<del1.delegates.length;i++)del.delegates.push(del1.delegates[i]);else del.delegates.push(del1);if(del2.isMulticastDelegate)for(var i=0;i<del2.delegates.length;i++)del.delegates.push(del2.delegates[i]);else del.delegates.push(del2);return del}function $CreateMulticastDelegateFunction(){var del2=null,del=function(){for(var x=void 0,i=0;i<del2.delegates.length;i++){var del3=del2.delegates[i];x=del3.apply(null,arguments)}return x};return del.isMulticastDelegate=!0,del2=del,del}function $RemoveDelegate(delOriginal,delToRemove){if(null==delToRemove||null==delOriginal)return delOriginal;if(delOriginal.isMulticastDelegate){if(delToRemove.isMulticastDelegate)throw new Error("Multicast to multicast delegate removal is not implemented yet");for(var del=$CreateMulticastDelegateFunction(),i=0;i<delOriginal.delegates.length;i++){var del2=delOriginal.delegates[i];del2!=delToRemove&&(null==del.delegates&&(del.delegates=[]),del.delegates.push(del2))}return null==del.delegates?null:1==del.delegates.length?del.delegates[0]:del}if(delToRemove.isMulticastDelegate)throw new Error("single to multicast delegate removal is not supported");return delOriginal==delToRemove?null:delOriginal}var $StaticConstructors=[],$StaticConstructor=function(f){$StaticConstructors.push(f)};if("undefined"==typeof $Inherit)var $Inherit=function(ce,ce2){if("undefined"==typeof Object.getOwnPropertyNames){for(var p in ce2.prototype)("undefined"==typeof ce.prototype[p]||ce.prototype[p]==Object.prototype[p])&&(ce.prototype[p]=ce2.prototype[p]);for(var p in ce2)"undefined"==typeof ce[p]&&(ce[p]=ce2[p]);ce.$baseCtor=ce2}else{for(var props=Object.getOwnPropertyNames(ce2.prototype),i=0;i<props.length;i++)"undefined"==typeof Object.getOwnPropertyDescriptor(ce.prototype,props[i])&&Object.defineProperty(ce.prototype,props[i],Object.getOwnPropertyDescriptor(ce2.prototype,props[i]));for(var p in ce2)"undefined"==typeof ce[p]&&(ce[p]=ce2[p]);ce.$baseCtor=ce2}};if("undefined"==typeof $CreateException)var $CreateException=function(ex,error){null==error&&(error=new Error),null==ex&&(ex=new System.Exception.ctor),error.message=ex.message;for(var p in ex)error[p]=ex[p];return error};if("undefined"==typeof $CreateDelegate){if("undefined"==typeof $iKey)var $iKey=0;if("undefined"==typeof $pKey)var $pKey=String.fromCharCode(1);var $CreateDelegate=function(target,func){if(null==target||null==func)return func;if(func.target==target&&func.func==func)return func;null==target.$delegateCache&&(target.$delegateCache={}),null==func.$key&&(func.$key=$pKey+String(++$iKey));var delegate;return null!=target.$delegateCache&&(delegate=target.$delegateCache[func.$key]),null==delegate&&(delegate=function(){return func.apply(target,arguments)},delegate.func=func,delegate.target=target,delegate.isDelegate=!0,null!=target.$delegateCache&&(target.$delegateCache[func.$key]=delegate)),delegate}}if("undefined"==typeof $CreateAnonymousDelegate)var $CreateAnonymousDelegate=function(target,func){if(null==target||null==func)return func;var delegate=function(){return func.apply(target,arguments)};return delegate.func=func,delegate.target=target,delegate.isDelegate=!0,delegate};var Int16Array=Int16Array||Array,Uint8Array=Uint8Array||Array,Int32Array=Int32Array||Array,Float32Array=Float32Array||Array,AlphaSynth=AlphaSynth||{};AlphaSynth.Main=AlphaSynth.Main||{},AlphaSynth.Main.AlphaSynthApi=function(asRoot,swfObjectRoot){this.RealInstance=null,this.Ready=!1,this.ReadyForPlay=!1;var supportsWebAudio=!!window.ScriptProcessorNode,supportsWebWorkers=!!window.Worker,forceFlash=!!window.ForceFlash;if(""==asRoot&&(asRoot=window.AsRoot.toString()),""==swfObjectRoot&&(swfObjectRoot=window.SwfObjectRoot.toString()),(null==swfObjectRoot||0==swfObjectRoot.length)&&(swfObjectRoot=asRoot),supportsWebAudio&&!forceFlash)AlphaSynth.Util.Logger.Info("Will use webworkers for synthesizing and web audio api for playback"),this.RealInstance=new AlphaSynth.Main.AlphaSynthWebWorkerApi(asRoot);else{if(!supportsWebWorkers)throw AlphaSynth.Util.Logger.Error("Incompatible browser"),$CreateException(new System.Exception.ctor$$String("Incompatible browser"),new Error);AlphaSynth.Util.Logger.Info("Will use webworkers for synthesizing and flash for playback"),this.RealInstance=new AlphaSynth.Main.AlphaSynthFlashPlayerApi(asRoot,swfObjectRoot)}this.RealInstance.Startup()},AlphaSynth.Main.AlphaSynthApi.prototype={Startup:function(){this.RealInstance.On("ready",$CreateAnonymousDelegate(this,function(){this.Ready=!0})),this.RealInstance.On("readyForPlay",$CreateAnonymousDelegate(this,function(){this.ReadyForPlay=!0})),this.RealInstance.Startup()},IsReadyForPlay:function(){null!=this.RealInstance&&this.RealInstance.IsReadyForPlay()},GetMasterVolume:function(){null!=this.RealInstance&&this.RealInstance.GetMasterVolume()},SetMasterVolume:function(volume){null!=this.RealInstance&&this.RealInstance.SetMasterVolume(volume)},GetState:function(){null!=this.RealInstance&&this.RealInstance.GetState()},IsSoundFontLoaded:function(){null!=this.RealInstance&&this.RealInstance.IsSoundFontLoaded()},IsMidiLoaded:function(){null!=this.RealInstance&&this.RealInstance.IsMidiLoaded()},Play:function(){null!=this.RealInstance&&this.RealInstance.Play()},Pause:function(){null!=this.RealInstance&&this.RealInstance.Pause()},PlayPause:function(){null!=this.RealInstance&&this.RealInstance.PlayPause()},Stop:function(){null!=this.RealInstance&&this.RealInstance.Stop()},SetPositionTick:function(tick){null!=this.RealInstance&&this.RealInstance.SetPositionTick(tick)},SetPositionTime:function(millis){null!=this.RealInstance&&this.RealInstance.SetPositionTime(millis)},LoadSoundFontUrl:function(url){null!=this.RealInstance&&this.RealInstance.LoadSoundFontUrl(url)},LoadSoundFontBytes:function(data){null!=this.RealInstance&&this.RealInstance.LoadSoundFontBytes(data)},LoadMidiUrl:function(url){null!=this.RealInstance&&this.RealInstance.LoadMidiUrl(url)},LoadMidiBytes:function(data){null!=this.RealInstance&&this.RealInstance.LoadMidiBytes(data)},SetLogLevel:function(level){AlphaSynth.Util.Logger.LogLevel=level,null!=this.RealInstance&&this.RealInstance.SetLogLevel(level)},On:function(events,fn){null!=this.RealInstance&&(this.RealInstance.On(events,fn),"readyForPlay"==events&&this.Ready&&fn())}},$StaticConstructor(function(){AlphaSynth.Main.AlphaSynthApi.AlphaSynthId="AlphaSynth"}),AlphaSynth.Main.AlphaSynthFlashOutput=function(asRoot,swfObjectRoot){this._asRoot=null,this._swfObjectRoot=null,this._id=null,this._swfId=null,this._swfContainer=null,this.SampleRequest=null,this.Finished=null,this.PositionChanged=null,this.ReadyChanged=null,this._asRoot=asRoot,this._swfObjectRoot=swfObjectRoot},AlphaSynth.Main.AlphaSynthFlashOutput.prototype={Open:function(){this._id="alphaSynthFlashPlayer"+AlphaSynth.Main.AlphaSynthFlashOutput.NextId,this._swfId=this._id+"swf",AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[this._id]=this,AlphaSynth.Main.AlphaSynthFlashOutput.NextId++,this._swfContainer=document.createElement("div"),this._swfContainer.className="alphaSynthFlashPlayer",this._swfContainer.setAttribute("id",this._id),document.body.appendChild(this._swfContainer);var swf=swfobject,embedSwf=swf.embedSWF;embedSwf(this._asRoot+"AlphaSynth.FlashOutput.swf",this._id,"1px","1px","9.0.0",this._swfObjectRoot+"expressInstall.swf",{id:this._id,sampleRate:44100},{allowScriptAccess:"always"},{id:this._swfId})},SequencerFinished:function(){document.getElementById(this._swfId).AlphaSynthSequencerFinished()},AddSamples:function(samples){var uint8=new Uint8Array(samples.buffer),b64=window.btoa(String.fromCharCode.apply(null,uint8));document.getElementById(this._swfId).AlphaSynthAddSamples(b64)},Play:function(){document.getElementById(this._swfId).AlphaSynthPlay()},Pause:function(){document.getElementById(this._swfId).AlphaSynthPause()},Stop:function(){document.getElementById(this._swfId).AlphaSynthStop()},Seek:function(position){document.getElementById(this._swfId).AlphaSynthSeek(position)},add_SampleRequest:function(value){this.SampleRequest=$CombineDelegates(this.SampleRequest,value)},remove_SampleRequest:function(value){this.SampleRequest=$RemoveDelegate(this.SampleRequest,value)},add_Finished:function(value){this.Finished=$CombineDelegates(this.Finished,value)},remove_Finished:function(value){this.Finished=$RemoveDelegate(this.Finished,value)},add_PositionChanged:function(value){this.PositionChanged=$CombineDelegates(this.PositionChanged,value)},remove_PositionChanged:function(value){this.PositionChanged=$RemoveDelegate(this.PositionChanged,value)},add_ReadyChanged:function(value){this.ReadyChanged=$CombineDelegates(this.ReadyChanged,value)},remove_ReadyChanged:function(value){this.ReadyChanged=$RemoveDelegate(this.ReadyChanged,value)}},$StaticConstructor(function(){AlphaSynth.Main.AlphaSynthFlashOutput.Id="alphaSynthFlashPlayer",AlphaSynth.Main.AlphaSynthFlashOutput.Lookup=null,AlphaSynth.Main.AlphaSynthFlashOutput.NextId=0,AlphaSynth.Main.AlphaSynthFlashOutput.Lookup={}}),AlphaSynth.Main.AlphaSynthFlashOutput.OnSampleRequest=function(id){AlphaSynth.Main.AlphaSynthFlashOutput.Lookup.hasOwnProperty(id)&&null!=AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[id].SampleRequest&&AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[id].SampleRequest()},AlphaSynth.Main.AlphaSynthFlashOutput.OnFinished=function(id){AlphaSynth.Main.AlphaSynthFlashOutput.Lookup.hasOwnProperty(id)&&null!=AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[id].Finished&&AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[id].Finished()},AlphaSynth.Main.AlphaSynthFlashOutput.OnPositionChanged=function(id,position){AlphaSynth.Main.AlphaSynthFlashOutput.Lookup.hasOwnProperty(id)&&null!=AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[id].PositionChanged&&AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[id].PositionChanged(position)},AlphaSynth.Main.AlphaSynthFlashOutput.OnReadyChanged=function(id,isReady){AlphaSynth.Main.AlphaSynthFlashOutput.Lookup.hasOwnProperty(id)&&null!=AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[id].ReadyChanged&&AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[id].ReadyChanged(isReady)},AlphaSynth.Main.AlphaSynthWebAudioOutput=function(){this._context=null,this._buffer=null,this._source=null,this._audioNode=null,this._circularBuffer=null,this._finished=!1,this._seekTime=null,this._startTime=0,this._pauseStart=0,this._pauseTime=0,this._paused=!1,this.SampleRequest=null,this.Finished=null,this.PositionChanged=null,this.ReadyChanged=null},AlphaSynth.Main.AlphaSynthWebAudioOutput.prototype={Open:function(){this._finished=!1,this._circularBuffer=new AlphaSynth.Ds.CircularSampleBuffer(40960),window.AudioContext=window.AudioContext||window.webkitAudioContext,this._context=new AudioContext,this._buffer=this._context.createBuffer(2,4096,44100),this._audioNode=this._context.createScriptProcessor(4096,0,2),this._audioNode.onaudioprocess=$CreateDelegate(this,this.GenerateSound),this.OnReadyChanged(!0)},Play:function(){this.RequestBuffers(),this._finished=!1,null!=this._seekTime?(this._startTime=1e3*this._context.currentTime-this._seekTime|0,this._seekTime=null,this._pauseTime=0,this._paused=!1):this._paused?(this._paused=!1,this._pauseTime+=1e3*this._context.currentTime-this._pauseStart|0):(this._startTime=1e3*this._context.currentTime|0,this._pauseTime=0),this._source=this._context.createBufferSource(),this._source.buffer=this._buffer,this._source.loop=!0,this._source.connect(this._audioNode,0,0),this._source.start(0),this._audioNode.connect(this._context.destination,0,0)},Pause:function(){null!=this._source&&this._source.stop(0),this._source=null,this._paused=!0,this._pauseStart=1e3*this._context.currentTime|0,this._audioNode.disconnect(0)},Stop:function(){this._finished=!0,this._paused=!1,this._seekTime=null,null!=this._source&&this._source.stop(0),this._source=null,this._circularBuffer.Clear(),this._audioNode.disconnect(0)},Seek:function(position){this._seekTime=position},SequencerFinished:function(){this._finished=!0},AddSamples:function(f){this._circularBuffer.Write(f,0,f.length)},RequestBuffers:function(){var count=20480;if(this._circularBuffer.get_Count()<count&&null!=this.SampleRequest)for(var i=0;5>i;i++)this.SampleRequest()},CalcPosition:function(){return 1e3*this._context.currentTime-this._startTime-this._pauseTime-46},GenerateSound:function(e){var ae=e,left=ae.outputBuffer.getChannelData(0),right=ae.outputBuffer.getChannelData(1),samples=left.length+right.length;if(this._circularBuffer.get_Count()<samples)this._finished?(null!=this.Finished&&this.Finished(),this.Stop()):this._pauseTime+=46;else{var buffer=new Float32Array(samples);this._circularBuffer.Read(buffer,0,buffer.length);for(var s=0,i=0;i<left.length;i++)left[i]=buffer[s++],right[i]=buffer[s++]}null!=this.PositionChanged&&this.PositionChanged(0|this.CalcPosition()),this._finished||this.RequestBuffers()},add_SampleRequest:function(value){this.SampleRequest=$CombineDelegates(this.SampleRequest,value)},remove_SampleRequest:function(value){this.SampleRequest=$RemoveDelegate(this.SampleRequest,value)},add_Finished:function(value){this.Finished=$CombineDelegates(this.Finished,value)},remove_Finished:function(value){this.Finished=$RemoveDelegate(this.Finished,value)},add_PositionChanged:function(value){this.PositionChanged=$CombineDelegates(this.PositionChanged,value)},remove_PositionChanged:function(value){this.PositionChanged=$RemoveDelegate(this.PositionChanged,value)},add_ReadyChanged:function(value){this.ReadyChanged=$CombineDelegates(this.ReadyChanged,value)},remove_ReadyChanged:function(value){this.ReadyChanged=$RemoveDelegate(this.ReadyChanged,value)},OnReadyChanged:function(isReady){var handler=this.ReadyChanged;null!=handler&&handler(isReady)}},$StaticConstructor(function(){AlphaSynth.Main.AlphaSynthWebAudioOutput.BufferSize=4096,AlphaSynth.Main.AlphaSynthWebAudioOutput.Latency=46,AlphaSynth.Main.AlphaSynthWebAudioOutput.BufferCount=10}),AlphaSynth.Main.AlphaSynthWebWorker=function(main){this._player=null,this._main=null,this._main=main,this._main.addEventListener("message",$CreateDelegate(this,this.HandleMessage),!1),this._player=new AlphaSynth.Player.SynthPlayer,this._player.add_PositionChanged($CreateDelegate(this,this.OnPositionChanged)),this._player.add_PlayerStateChanged($CreateDelegate(this,this.OnPlayerStateChanged)),this._player.add_Finished($CreateDelegate(this,this.OnFinished)),this._player.add_SoundFontLoad($CreateDelegate(this,this.OnSoundFontLoad)),this._player.add_SoundFontLoaded($CreateDelegate(this,this.OnSoundFontLoaded)),this._player.add_SoundFontLoadFailed($CreateDelegate(this,this.OnSoundFontLoadFailed)),this._player.add_MidiLoad($CreateDelegate(this,this.OnMidiLoad)),this._player.add_MidiLoaded($CreateDelegate(this,this.OnMidiLoaded)),this._player.add_MidiLoadFailed($CreateDelegate(this,this.OnMidiLoadFailed)),this._player.add_ReadyForPlay($CreateDelegate(this,this.OnReadyForPlay)),this.OnReady()},AlphaSynth.Main.AlphaSynthWebWorker.prototype={HandleMessage:function(e){var data=e.data,cmd=data.cmd;switch(cmd){case"play":this.Play();break;case"pause":this.Pause();break;case"isReadyForPlay":this._main.postMessage({cmd:"isReadyForPlay",value:this.IsReadyForPlay()});break;case"getMasterVolume":this._main.postMessage({cmd:"getMasterVolume",value:this._player.get_MasterVolume()});break;case"setMasterVolume":this._player.set_MasterVolume(data.value);break;case"playPause":this.PlayPause();break;case"stop":this.Stop();break;case"setPositionTick":this.SetPositionTick(data.tick);break;case"setPositionTime":this.SetPositionTime(data.time);break;case"loadSoundFontUrl":this.LoadSoundFontUrl(data.url);break;case"loadSoundFontBytes":this.LoadSoundFontBytes(data.data);break;case"loadMidiUrl":this.LoadMidiUrl(data.url);break;case"loadMidiBytes":this.LoadMidiBytes(data.data);break;case"getState":this._main.postMessage({cmd:"getState",value:this.GetState()});break;case"isSoundFontLoaded":this._main.postMessage({cmd:"isSoundFontLoaded",value:this.IsSoundFontLoaded()});break;case"isMidiLoaded":this._main.postMessage({cmd:"isMidiLoaded",value:this.IsMidiLoaded()});break;case"setLogLevel":this.SetLogLevel(data.level)}},IsReadyForPlay:function(){return this._player.get_IsReady()},Play:function(){this._player.Play()},Pause:function(){this._player.Pause()},PlayPause:function(){this._player.PlayPause()},Stop:function(){this._player.Stop()},SetPositionTick:function(tick){this._player.set_TickPosition(tick)},SetPositionTime:function(millis){this._player.set_TimePosition(millis)},LoadSoundFontUrl:function(url){this._player.LoadSoundFontUrl(url)},LoadSoundFontBytes:function(data){this._player.LoadSoundFontBytes(data)},LoadMidiUrl:function(url){this._player.LoadMidiUrl(url)},LoadMidiBytes:function(data){this._player.LoadMidiBytes(data)},GetState:function(){return this._player.State},IsSoundFontLoaded:function(){return this._player.IsSoundFontLoaded},IsMidiLoaded:function(){return this._player.IsMidiLoaded},GetMasterVolume:function(){return this._player.get_MasterVolume()},SetMasterVolume:function(volume){this._player.set_MasterVolume(volume)},OnReady:function(){this._main.postMessage({cmd:"ready"})},OnPositionChanged:function(sender,e){this._main.postMessage({cmd:"positionChanged",currentTime:e.CurrentTime,endTime:e.EndTime,currentTick:e.CurrentTick,endTick:e.EndTick})},OnPlayerStateChanged:function(sender,e){this._main.postMessage({cmd:"playerStateChanged",state:e.State})},OnFinished:function(){this._main.postMessage({cmd:"finished"})},OnSoundFontLoad:function(sender,e){this._main.postMessage({cmd:"soundFontLoad",loaded:e.Loaded,total:e.Total})},OnSoundFontLoaded:function(){this._main.postMessage({cmd:"soundFontLoaded"})},OnSoundFontLoadFailed:function(){this._main.postMessage({cmd:"soundFontLoadFailed"})},OnMidiLoad:function(sender,e){this._main.postMessage({cmd:"midiLoad",loaded:e.Loaded,total:e.Total})},OnMidiLoaded:function(){this._main.postMessage({cmd:"midiFileLoaded"})},OnMidiLoadFailed:function(){this._main.postMessage({cmd:"midiFileLoadFailed"})},OnReadyForPlay:function(){this._main.postMessage({cmd:"readyForPlay",value:this.IsReadyForPlay()})},SendLog:function(level,s){this._main.postMessage({cmd:"log",level:level,message:s})},SetLogLevel:function(level){AlphaSynth.Util.Logger.LogLevel=level}},AlphaSynth.Main.AlphaSynthWebWorkerApiBase=function(player,asRoot){this._asRoot=null,this._synth=null,this._player=null,this._isPlayerReady=!1,this._isWorkerReady=!1,this._events=null,this._asRoot=asRoot,this._player=player,this._player.add_ReadyChanged($CreateDelegate(this,this.PlayerReadyChanged)),this._player.add_PositionChanged($CreateDelegate(this,this.PlayerPositionChanged)),this._player.add_SampleRequest($CreateDelegate(this,this.PlayerSampleRequest)),this._player.add_Finished($CreateDelegate(this,this.PlayerFinished)),this._events={},""!=asRoot&&!asRoot.indexOf("/")==asRoot.length-"/".length&&(asRoot+="/"),this._asRoot=asRoot,this._synth=new Worker(asRoot+"AlphaSynth.worker.js")},AlphaSynth.Main.AlphaSynthWebWorkerApiBase.prototype={Startup:function(){this._player.Open(),this._synth.addEventListener("message",$CreateDelegate(this,this.HandleWorkerMessage),!1);var root=new Array;root.push(window.location.protocol),root.push("//"),root.push(window.location.hostname),window.location.port&&(root.push(":"),root.push(window.location.port)),root.push(this._asRoot),this._synth.postMessage({cmd:"playerReady",root:root.join("")})},IsReadyForPlay:function(){this._synth.postMessage({cmd:"isReadyForPlay"})},Play:function(){this._synth.postMessage({cmd:"play"})},Pause:function(){this._synth.postMessage({cmd:"pause"})},PlayPause:function(){this._synth.postMessage({cmd:"playPause"})},Stop:function(){this._synth.postMessage({cmd:"stop"})},SetPositionTick:function(tick){this._synth.postMessage({cmd:"setPositionTick",tick:tick})},SetPositionTime:function(millis){this._synth.postMessage({cmd:"setPositionTime",time:millis})},LoadSoundFontUrl:function(url){this._synth.postMessage({cmd:"loadSoundFontUrl",url:AlphaSynth.Main.AlphaSynthWebWorkerApiBase.QualifyUrl(url)})},LoadSoundFontBytes:function(data){this._synth.postMessage({cmd:"loadSoundFontBytes",data:data})},LoadMidiUrl:function(url){this._synth.postMessage({cmd:"loadMidiUrl",url:AlphaSynth.Main.AlphaSynthWebWorkerApiBase.QualifyUrl(url)})},LoadMidiBytes:function(data){this._synth.postMessage({cmd:"loadMidiBytes",data:data})},GetState:function(){this._synth.postMessage({cmd:"getState"})},GetMasterVolume:function(){this._synth.postMessage({cmd:"getMasterVolume"})},SetMasterVolume:function(volume){this._synth.postMessage({cmd:"setMasterVolume",value:volume})},IsSoundFontLoaded:function(){this._synth.postMessage({cmd:"isSoundFontLoaded"})},IsMidiLoaded:function(){this._synth.postMessage({cmd:"isMidiLoaded"})},SetLogLevel:function(level){this._synth.postMessage({cmd:"setLogLevel",level:level})},HandleWorkerMessage:function(e){var data=e.data,cmd=data.cmd;switch(cmd){case"isReadyForPlay":case"getState":case"getMasterVolume":case"isSoundFontLoaded":case"isMidiLoaded":this.TriggerEvent(cmd,[data.value]);break;case"ready":this._isWorkerReady=!0,this.CheckForReadyState();break;case"positionChanged":this.TriggerEvent(cmd,[data.currentTime,data.endTime,data.currentTick,data.endTick]);break;case"playerStateChanged":this.TriggerEvent(cmd,[data.state]);break;case"finished":this.TriggerEvent(cmd,null);break;case"soundFontLoad":this.TriggerEvent(cmd,[data.loaded,data.total]);break;case"soundFontLoaded":this.TriggerEvent(cmd,null);break;case"soundFontLoadFailed":this.TriggerEvent(cmd,null);break;case"midiLoad":this.TriggerEvent(cmd,[data.loaded,data.total]);break;case"midiFileLoaded":this.TriggerEvent(cmd,null);break;case"midiFileLoadFailed":this.TriggerEvent(cmd,null);break;case"readyForPlay":this.TriggerEvent(cmd,[data.value]);break;case"log":this.Log(data.level,data.message);break;case"playerSequencerFinished":this._player.SequencerFinished();break;case"playerAddSamples":this._player.AddSamples(data.samples);break;case"playerPlay":this._player.Play();break;case"playerPause":this._player.Pause();break;case"playerStop":this._player.Stop();break;case"playerSeek":this._player.Seek(data.pos)}},CheckForReadyState:function(){this.TriggerEvent("ready",[this._isWorkerReady&&this._isPlayerReady])},PlayerReadyChanged:function(isReady){this._isPlayerReady=isReady,this.CheckForReadyState()},On:function(events,action){this._events.hasOwnProperty(events)||(this._events[events]=[]),this._events[events].push(action)},TriggerEvent:function(name,args){var events=this._events[name];if(null!=events)for(var i=0;i<events.length;i++)events[i].apply(null,args)},PlayerSampleRequest:function(){this._synth.postMessage({cmd:"playerSampleRequest"})},PlayerFinished:function(){this._synth.postMessage({cmd:"playerFinished"})},PlayerPositionChanged:function(pos){this._synth.postMessage({cmd:"playerPositionChanged",pos:pos})},Log:function(level,message){switch(level){case AlphaSynth.Util.LogLevel.None:console.log(message);break;case AlphaSynth.Util.LogLevel.Debug:console.debug(message);break;case AlphaSynth.Util.LogLevel.Info:console.info(message);break;case AlphaSynth.Util.LogLevel.Warning:console.warn(message);break;case AlphaSynth.Util.LogLevel.Error:console.error(message)}}},AlphaSynth.Main.AlphaSynthWebWorkerApiBase.QualifyUrl=function(url){var img=document.createElement("img");return img.onerror=function(){},img.src=url,url=img.src,img.src=null,url},AlphaSynth.Main.AlphaSynthFlashPlayerApi=function(asRoot,swfObjectRoot){AlphaSynth.Main.AlphaSynthWebWorkerApiBase.call(this,new AlphaSynth.Main.AlphaSynthFlashOutput(asRoot,swfObjectRoot),asRoot)},$Inherit(AlphaSynth.Main.AlphaSynthFlashPlayerApi,AlphaSynth.Main.AlphaSynthWebWorkerApiBase),AlphaSynth.Main.AlphaSynthWebWorkerApi=function(asRoot){AlphaSynth.Main.AlphaSynthWebWorkerApiBase.call(this,new AlphaSynth.Main.AlphaSynthWebAudioOutput,asRoot)},$Inherit(AlphaSynth.Main.AlphaSynthWebWorkerApi,AlphaSynth.Main.AlphaSynthWebWorkerApiBase),AlphaSynth.Platform=AlphaSynth.Platform||{},AlphaSynth.Platform.Platform=function(){},AlphaSynth.Platform.Platform.CreateOutput=function(){return new AlphaSynth.Player.WebWorkerOutput},AlphaSynth.Platform.Std=function(){},$StaticConstructor(function(){AlphaSynth.Platform.Std.IsLittleEndian=!0}),AlphaSynth.Platform.Std.ParseInt=function(s){var f=parseInt(s);return isNaN(f)&&(f=0),f},AlphaSynth.Platform.Std.StringFromCharCode=function(){return""},AlphaSynth.Platform.Std.Random=function(){return Math.random()},AlphaSynth.Platform.Std.BlockCopy=function(){},AlphaSynth.Platform.Std.ArrayCopy=function(src,srcOffset,dst,dstOffset,count){for(var i=0;count>i;i++)dst[dstOffset+i]=src[srcOffset+i]},AlphaSynth.Platform.Std.Reverse=function(array){for(var i=0,j=array.length-1;j>i;){var t=array[i];array[i]=array[j],array[j]=t,i++,j--}},AlphaSynth.Platform.TypeUtils=function(){},$StaticConstructor(function(){AlphaSynth.Platform.TypeUtils.IsLittleEndian=!0,AlphaSynth.Platform.TypeUtils.Int16=new Int16Array(1)}),AlphaSynth.Platform.TypeUtils.ToUInt32=function(i){return 0|i},AlphaSynth.Platform.TypeUtils.ToInt16=function(i){return AlphaSynth.Platform.TypeUtils.Int16[0]=0|i,AlphaSynth.Platform.TypeUtils.Int16[0]},AlphaSynth.Platform.TypeUtils.ToUInt16=function(i){return 0|i},AlphaSynth.Platform.TypeUtils.ToUInt8=function(i){return i},AlphaSynth.Platform.TypeUtils.ClearIntArray=function(array){for(var i=0;i<array.length;i++)array[i]=0},AlphaSynth.Platform.TypeUtils.ClearShortArray=function(array){for(var i=0;i<array.length;i++)array[i]=0},AlphaSynth.Player=AlphaSynth.Player||{},AlphaSynth.Player.WebWorkerOutput=function(){this._positionChangedListeners=null,this._finishedListeners=null,this._sampleRequestListeners=null,this._workerSelf=null,this.PositionChanged=null,this.Finished=null,this.SampleRequest=null,this.ReadyChanged=null},AlphaSynth.Player.WebWorkerOutput.prototype={Open:function(){AlphaSynth.Util.Logger.Debug("Initializing webworker worker"),this._workerSelf=self,this._workerSelf.addEventListener("message",$CreateDelegate(this,this.HandleMessage),!1),this.OnReadyChanged(!0)},HandleMessage:function(e){var data=e.data,cmd=data.cmd;switch(cmd){case"playerSampleRequest":this.OnSampleRequest();break;case"playerFinished":this.OnFinished();break;case"playerPositionChanged":this.OnPositionChanged(data.pos)}},PostMessage:function(){},add_PositionChanged:function(value){this.PositionChanged=$CombineDelegates(this.PositionChanged,value)},remove_PositionChanged:function(value){this.PositionChanged=$RemoveDelegate(this.PositionChanged,value)},OnPositionChanged:function(obj){var handler=this.PositionChanged;null!=handler&&handler(obj)},add_Finished:function(value){this.Finished=$CombineDelegates(this.Finished,value)},remove_Finished:function(value){this.Finished=$RemoveDelegate(this.Finished,value)},OnFinished:function(){var handler=this.Finished;null!=handler&&handler()},add_SampleRequest:function(value){this.SampleRequest=$CombineDelegates(this.SampleRequest,value)},remove_SampleRequest:function(value){this.SampleRequest=$RemoveDelegate(this.SampleRequest,value)},OnSampleRequest:function(){var handler=this.SampleRequest;null!=handler&&handler()},add_ReadyChanged:function(value){this.ReadyChanged=$CombineDelegates(this.ReadyChanged,value)},remove_ReadyChanged:function(value){this.ReadyChanged=$RemoveDelegate(this.ReadyChanged,value)},OnReadyChanged:function(isReady){var handler=this.ReadyChanged;null!=handler&&handler(isReady)},SequencerFinished:function(){this._workerSelf.postMessage({cmd:"playerSequencerFinished"})},AddSamples:function(samples){this._workerSelf.postMessage({cmd:"playerAddSamples",samples:samples})},Play:function(){this._workerSelf.postMessage({cmd:"playerPlay"})},Pause:function(){this._workerSelf.postMessage({cmd:"playerPause"})},Stop:function(){this._workerSelf.postMessage({cmd:"playerStop"})},Seek:function(position){this._workerSelf.postMessage({cmd:"playerSeek",pos:position})}},AlphaSynth.Util=AlphaSynth.Util||{},AlphaSynth.Util.Extensions=function(){},AlphaSynth.Util.Logger=function(){},$StaticConstructor(function(){AlphaSynth.Util.Logger.LogLevel=AlphaSynth.Util.LogLevel.None,AlphaSynth.Util.Logger.LogHandler=null,AlphaSynth.Util.Logger.LogLevel=AlphaSynth.Util.LogLevel.Info,AlphaSynth.Util.Logger.LogHandler=function(s){console.log(s)}}),AlphaSynth.Util.Logger.Debug=function(msg){AlphaSynth.Util.Logger.Log(AlphaSynth.Util.LogLevel.Debug,msg)},AlphaSynth.Util.Logger.Warning=function(msg){AlphaSynth.Util.Logger.Log(AlphaSynth.Util.LogLevel.Warning,msg)},AlphaSynth.Util.Logger.Info=function(msg){AlphaSynth.Util.Logger.Log(AlphaSynth.Util.LogLevel.Info,msg)},AlphaSynth.Util.Logger.Error=function(msg){AlphaSynth.Util.Logger.Log(AlphaSynth.Util.LogLevel.Error,msg)},AlphaSynth.Util.Logger.Log=function(logLevel,msg){if(!(logLevel<AlphaSynth.Util.Logger.LogLevel)){var caller=arguments.callee.caller.caller.name;AlphaSynth.Util.Logger.LogHandler(caller+"-"+msg)}},AlphaSynth.Util.Logger.GetCaller=function(){return""},AlphaSynth.Util.LogLevel={None:0,Debug:1,Info:2,Warning:3,Error:4},AlphaSynth.Util.UrlLoader=function(){this.Progress=null,this.Complete=null,this.Url=null,this.Method=null},AlphaSynth.Util.UrlLoader.prototype={Load:function(){var request=new XMLHttpRequest;request.open(this.Method,this.Url,!0),request.responseType="arraybuffer",request.onload=$CreateAnonymousDelegate(this,function(){var buffer=new Uint8Array(request.response);null!=buffer&&this.FireComplete(buffer)}),request.onerror=$CreateAnonymousDelegate(this,function(e){AlphaSynth.Util.Logger.Error("Loading failed: "+e.message)}),request.onprogress=$CreateAnonymousDelegate(this,function(e){this.FireProgress(e.loaded,e.total)}),request.send()},FireProgress:function(loaded,full){null!=this.Progress&&this.Progress(loaded,full)},FireComplete:function(data){null!=this.Complete&&this.Complete(data)}},AlphaSynth.Bank=AlphaSynth.Bank||{},AlphaSynth.Bank.AssetManager=function(){this.PatchAssets=null,this.SampleAssets=null,this.PatchAssets=[],this.SampleAssets=[]},AlphaSynth.Bank.AssetManager.prototype={FindPatch:function(name){for(var i=0;i<this.PatchAssets.length;i++){var patchAsset=this.PatchAssets[i];if(patchAsset.Name==name)return patchAsset}return null},FindSample:function(name){for(var i=0;i<this.SampleAssets.length;i++){var sampleDataAsset=this.SampleAssets[i];if(sampleDataAsset.Name==name)return sampleDataAsset}return null}},AlphaSynth.Bank.Components=AlphaSynth.Bank.Components||{},AlphaSynth.Bank.Components.Generators=AlphaSynth.Bank.Components.Generators||{},AlphaSynth.Bank.Components.Generators.Generator=function(description){this.LoopMode=AlphaSynth.Bank.Components.Generators.LoopMode.NoLoop,this.LoopStartPhase=0,this.LoopEndPhase=0,this.StartPhase=0,this.EndPhase=0,this.Offset=0,this.Period=0,this.Frequency=0,this.RootKey=0,this.KeyTrack=0,this.VelocityTrack=0,this.Tune=0,this.LoopMode=description.LoopMethod,this.LoopStartPhase=description.LoopStartPhase,this.LoopEndPhase=description.LoopEndPhase,this.StartPhase=description.StartPhase,this.EndPhase=description.EndPhase,this.Offset=description.Offset,this.Period=description.Period,this.Frequency=0,this.RootKey=description.RootKey,this.KeyTrack=description.KeyTrack,this.VelocityTrack=description.VelTrack,this.Tune=description.Tune},AlphaSynth.Bank.Components.Generators.Generator.prototype={Release:function(generatorParams){this.LoopMode==AlphaSynth.Bank.Components.Generators.LoopMode.LoopUntilNoteOff&&(generatorParams.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.PostLoop,generatorParams.CurrentStart=this.StartPhase,generatorParams.CurrentEnd=this.EndPhase)},GetValues:function(generatorParams,blockBuffer,increment){var proccessed=0;do{var samplesAvailable=0|Math.ceil((generatorParams.CurrentEnd-generatorParams.Phase)/increment);if(samplesAvailable>blockBuffer.length-proccessed)for(;proccessed<blockBuffer.length;)blockBuffer[proccessed++]=this.GetValue(generatorParams.Phase),generatorParams.Phase+=increment;
else{for(var endProccessed=proccessed+samplesAvailable;endProccessed>proccessed;)blockBuffer[proccessed++]=this.GetValue(generatorParams.Phase),generatorParams.Phase+=increment;switch(generatorParams.CurrentState){case AlphaSynth.Bank.Components.Generators.GeneratorState.PreLoop:generatorParams.CurrentStart=this.LoopStartPhase,generatorParams.CurrentEnd=this.LoopEndPhase,generatorParams.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.Loop;break;case AlphaSynth.Bank.Components.Generators.GeneratorState.Loop:generatorParams.Phase+=generatorParams.CurrentStart-generatorParams.CurrentEnd;break;case AlphaSynth.Bank.Components.Generators.GeneratorState.PostLoop:for(generatorParams.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.Finished;proccessed<blockBuffer.length;)blockBuffer[proccessed++]=0}}}while(proccessed<blockBuffer.length)}},AlphaSynth.Bank.Components.Generators.WhiteNoiseGenerator=function(description){AlphaSynth.Bank.Components.Generators.Generator.call(this,description),this.EndPhase<0&&(this.EndPhase=1),this.StartPhase<0&&(this.StartPhase=0),this.LoopEndPhase<0&&(this.LoopEndPhase=this.EndPhase),this.LoopStartPhase<0&&(this.LoopStartPhase=this.StartPhase),this.Period<0&&(this.Period=1),this.RootKey<0&&(this.RootKey=69),this.Frequency=440},AlphaSynth.Bank.Components.Generators.WhiteNoiseGenerator.prototype={GetValue:function(){return 2*AlphaSynth.Platform.Std.Random()-1}},$Inherit(AlphaSynth.Bank.Components.Generators.WhiteNoiseGenerator,AlphaSynth.Bank.Components.Generators.Generator),AlphaSynth.Bank.Components.Generators.TriangleGenerator=function(description){AlphaSynth.Bank.Components.Generators.Generator.call(this,description),this.EndPhase<0&&(this.EndPhase=1.25),this.StartPhase<0&&(this.StartPhase=.25),this.LoopEndPhase<0&&(this.LoopEndPhase=this.EndPhase),this.LoopStartPhase<0&&(this.LoopStartPhase=this.StartPhase),this.Period<0&&(this.Period=1),this.RootKey<0&&(this.RootKey=69),this.Frequency=440},AlphaSynth.Bank.Components.Generators.TriangleGenerator.prototype={GetValue:function(phase){return 4*Math.abs(phase-Math.Floor(phase+.5))-1}},$Inherit(AlphaSynth.Bank.Components.Generators.TriangleGenerator,AlphaSynth.Bank.Components.Generators.Generator),AlphaSynth.Bank.Components.Generators.SquareGenerator=function(description){AlphaSynth.Bank.Components.Generators.Generator.call(this,description),this.EndPhase<0&&(this.EndPhase=6.28318530717958),this.StartPhase<0&&(this.StartPhase=0),this.LoopEndPhase<0&&(this.LoopEndPhase=this.EndPhase),this.LoopStartPhase<0&&(this.LoopStartPhase=this.StartPhase),this.Period<0&&(this.Period=6.28318530717958),this.RootKey<0&&(this.RootKey=69),this.Frequency=440},AlphaSynth.Bank.Components.Generators.SquareGenerator.prototype={GetValue:function(phase){return Math.Sign(Math.sin(phase))}},$Inherit(AlphaSynth.Bank.Components.Generators.SquareGenerator,AlphaSynth.Bank.Components.Generators.Generator),AlphaSynth.Bank.Components.Generators.SineGenerator=function(description){AlphaSynth.Bank.Components.Generators.Generator.call(this,description),this.EndPhase<0&&(this.EndPhase=6.28318530717958),this.StartPhase<0&&(this.StartPhase=0),this.LoopEndPhase<0&&(this.LoopEndPhase=this.EndPhase),this.LoopStartPhase<0&&(this.LoopStartPhase=this.StartPhase),this.Period<0&&(this.Period=6.28318530717958),this.RootKey<0&&(this.RootKey=69),this.Frequency=440},AlphaSynth.Bank.Components.Generators.SineGenerator.prototype={GetValue:function(phase){return Math.sin(phase)}},$Inherit(AlphaSynth.Bank.Components.Generators.SineGenerator,AlphaSynth.Bank.Components.Generators.Generator),AlphaSynth.Bank.Components.Generators.SawGenerator=function(description){AlphaSynth.Bank.Components.Generators.Generator.call(this,description),this.EndPhase<0&&(this.EndPhase=1),this.StartPhase<0&&(this.StartPhase=0),this.LoopEndPhase<0&&(this.LoopEndPhase=this.EndPhase),this.LoopStartPhase<0&&(this.LoopStartPhase=this.StartPhase),this.Period<0&&(this.Period=1),this.RootKey<0&&(this.RootKey=69),this.Frequency=440},AlphaSynth.Bank.Components.Generators.SawGenerator.prototype={GetValue:function(phase){return 2*(phase-Math.Floor(phase+.5))}},$Inherit(AlphaSynth.Bank.Components.Generators.SawGenerator,AlphaSynth.Bank.Components.Generators.Generator),AlphaSynth.Bank.Components.Generators.Interpolation={None:0,Linear:1,Cosine:2,CubicSpline:3,Sinc:4},AlphaSynth.Bank.Components.Generators.SampleGenerator=function(){this.Samples=null,AlphaSynth.Bank.Components.Generators.Generator.call(this,new AlphaSynth.Bank.Descriptors.GeneratorDescriptor)},AlphaSynth.Bank.Components.Generators.SampleGenerator.prototype={GetValue:function(phase){return this.Samples.get_Item(0|phase)},GetValues:function(generatorParams,blockBuffer,increment){var proccessed=0;do{var samplesAvailable=0|Math.ceil((generatorParams.CurrentEnd-generatorParams.Phase)/increment);if(samplesAvailable>blockBuffer.length-proccessed)return void this.Interpolate(generatorParams,blockBuffer,increment,proccessed,blockBuffer.length);var endProccessed=proccessed+samplesAvailable;switch(this.Interpolate(generatorParams,blockBuffer,increment,proccessed,endProccessed),proccessed=endProccessed,generatorParams.CurrentState){case AlphaSynth.Bank.Components.Generators.GeneratorState.PreLoop:generatorParams.CurrentStart=this.LoopStartPhase,generatorParams.CurrentEnd=this.LoopEndPhase,generatorParams.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.Loop;break;case AlphaSynth.Bank.Components.Generators.GeneratorState.Loop:generatorParams.Phase+=generatorParams.CurrentStart-generatorParams.CurrentEnd;break;case AlphaSynth.Bank.Components.Generators.GeneratorState.PostLoop:for(generatorParams.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.Finished;proccessed<blockBuffer.length;)blockBuffer[proccessed++]=0}}while(proccessed<blockBuffer.length)},Interpolate:function(generatorParams,blockBuffer,increment,start,end){switch(1){case AlphaSynth.Bank.Components.Generators.Interpolation.Linear:for(var index,s1,s2,mu,_end=generatorParams.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.LoopEndPhase-1:this.EndPhase-1;end>start&&generatorParams.Phase<_end;)index=0|generatorParams.Phase,s1=this.Samples.get_Item(index),s2=this.Samples.get_Item(index+1),mu=generatorParams.Phase-index,blockBuffer[start++]=s1+mu*(s2-s1),generatorParams.Phase+=increment;for(;end>start;)index=0|generatorParams.Phase,s1=this.Samples.get_Item(index),s2=generatorParams.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.Samples.get_Item(0|generatorParams.CurrentStart):s1,mu=generatorParams.Phase-index,blockBuffer[start++]=s1+mu*(s2-s1),generatorParams.Phase+=increment;break;case AlphaSynth.Bank.Components.Generators.Interpolation.Cosine:for(var index,s1,s2,mu,_end=generatorParams.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.LoopEndPhase-1:this.EndPhase-1;end>start&&generatorParams.Phase<_end;)index=0|generatorParams.Phase,s1=this.Samples.get_Item(index),s2=this.Samples.get_Item(index+1),mu=.5*(1-Math.cos(3.14159265358979*(generatorParams.Phase-index))),blockBuffer[start++]=s1*(1-mu)+s2*mu,generatorParams.Phase+=increment;for(;end>start;)index=0|generatorParams.Phase,s1=this.Samples.get_Item(index),s2=generatorParams.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.Samples.get_Item(0|generatorParams.CurrentStart):s1,mu=.5*(1-Math.cos(3.14159265358979*(generatorParams.Phase-index))),blockBuffer[start++]=s1*(1-mu)+s2*mu,generatorParams.Phase+=increment;break;case AlphaSynth.Bank.Components.Generators.Interpolation.CubicSpline:for(var index,s0,s1,s2,s3,mu,_end=generatorParams.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.LoopStartPhase+1:this.StartPhase+1;end>start&&generatorParams.Phase<_end;)index=0|generatorParams.Phase,s0=this.Samples.get_Item(generatorParams.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?-1|generatorParams.CurrentEnd:index),s1=this.Samples.get_Item(index),s2=this.Samples.get_Item(index+1),s3=this.Samples.get_Item(index+2),mu=generatorParams.Phase-index,blockBuffer[start++]=(-.5*s0+1.5*s1-1.5*s2+.5*s3)*mu*mu*mu+(s0-2.5*s1+2*s2-.5*s3)*mu*mu+(-.5*s0+.5*s2)*mu+s1,generatorParams.Phase+=increment;for(_end=generatorParams.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.LoopEndPhase-2:this.EndPhase-2;end>start&&generatorParams.Phase<_end;)index=0|generatorParams.Phase,s0=this.Samples.get_Item(index-1),s1=this.Samples.get_Item(index),s2=this.Samples.get_Item(index+1),s3=this.Samples.get_Item(index+2),mu=generatorParams.Phase-index,blockBuffer[start++]=(-.5*s0+1.5*s1-1.5*s2+.5*s3)*mu*mu*mu+(s0-2.5*s1+2*s2-.5*s3)*mu*mu+(-.5*s0+.5*s2)*mu+s1,generatorParams.Phase+=increment;for(_end+=1;end>start;)index=0|generatorParams.Phase,s0=this.Samples.get_Item(index-1),s1=this.Samples.get_Item(index),generatorParams.Phase<_end?(s2=this.Samples.get_Item(index+1),s3=generatorParams.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.Samples.get_Item(0|generatorParams.CurrentStart):s2):generatorParams.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?(s2=this.Samples.get_Item(0|generatorParams.CurrentStart),s3=this.Samples.get_Item(1|generatorParams.CurrentStart)):(s2=s1,s3=s1),mu=generatorParams.Phase-index,blockBuffer[start++]=(-.5*s0+1.5*s1-1.5*s2+.5*s3)*mu*mu*mu+(s0-2.5*s1+2*s2-.5*s3)*mu*mu+(-.5*s0+.5*s2)*mu+s1,generatorParams.Phase+=increment;break;default:for(;end>start;)blockBuffer[start++]=this.Samples.get_Item(0|generatorParams.Phase),generatorParams.Phase+=increment}}},$Inherit(AlphaSynth.Bank.Components.Generators.SampleGenerator,AlphaSynth.Bank.Components.Generators.Generator),AlphaSynth.Bank.Components.Generators.GeneratorParameters=function(){this.Phase=0,this.CurrentStart=0,this.CurrentEnd=0,this.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.PreLoop,this.Phase=0,this.CurrentStart=0,this.CurrentEnd=0,this.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.PreLoop},AlphaSynth.Bank.Components.Generators.GeneratorParameters.prototype={QuickSetup:function(generator){switch(this.CurrentStart=generator.StartPhase,this.Phase=this.CurrentStart+generator.Offset,generator.LoopMode){case AlphaSynth.Bank.Components.Generators.LoopMode.Continuous:case AlphaSynth.Bank.Components.Generators.LoopMode.LoopUntilNoteOff:this.Phase>=generator.EndPhase?this.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.Finished:this.Phase>=generator.LoopEndPhase?(this.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.PostLoop,this.CurrentEnd=generator.EndPhase):this.Phase>=generator.LoopStartPhase?(this.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.Loop,this.CurrentEnd=generator.LoopEndPhase,this.CurrentStart=generator.LoopStartPhase):(this.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.PreLoop,this.CurrentEnd=generator.LoopStartPhase);break;default:this.CurrentEnd=generator.EndPhase,this.CurrentState=this.Phase>=this.CurrentEnd?AlphaSynth.Bank.Components.Generators.GeneratorState.Finished:AlphaSynth.Bank.Components.Generators.GeneratorState.PostLoop}}},AlphaSynth.Bank.Components.Generators.LoopMode={NoLoop:0,OneShot:1,Continuous:2,LoopUntilNoteOff:3},AlphaSynth.Bank.Components.Generators.GeneratorState={PreLoop:0,Loop:1,PostLoop:2,Finished:3},AlphaSynth.Bank.Components.Generators.DefaultGenerators=function(){},$StaticConstructor(function(){AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultSine=new AlphaSynth.Bank.Components.Generators.SineGenerator(new AlphaSynth.Bank.Descriptors.GeneratorDescriptor),AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultSaw=new AlphaSynth.Bank.Components.Generators.SawGenerator(new AlphaSynth.Bank.Descriptors.GeneratorDescriptor),AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultSquare=new AlphaSynth.Bank.Components.Generators.SquareGenerator(new AlphaSynth.Bank.Descriptors.GeneratorDescriptor),AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultTriangle=new AlphaSynth.Bank.Components.Generators.TriangleGenerator(new AlphaSynth.Bank.Descriptors.GeneratorDescriptor)}),AlphaSynth.Bank.Components.LfoState={Delay:0,Sustain:1},AlphaSynth.Bank.Components.Lfo=function(){this._phase=0,this._increment=0,this._delayTime=0,this._generator=null,this.Frequency=0,this.CurrentState=AlphaSynth.Bank.Components.LfoState.Delay,this.Value=0,this.Depth=0,this.CurrentState=AlphaSynth.Bank.Components.LfoState.Delay,this._generator=AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultSine,this._delayTime=0,this._increment=0,this._phase=0,this.Frequency=0,this.CurrentState=AlphaSynth.Bank.Components.LfoState.Delay,this.Value=0,this.Depth=0},AlphaSynth.Bank.Components.Lfo.prototype={QuickSetup:function(sampleRate,lfoInfo){this._generator=lfoInfo.Generator,this._delayTime=sampleRate*lfoInfo.DelayTime|0,this.Frequency=lfoInfo.Frequency,this._increment=this._generator.Period*this.Frequency/sampleRate,this.Depth=lfoInfo.Depth,this.Reset()},Increment:function(amount){this.CurrentState==AlphaSynth.Bank.Components.LfoState.Delay?(this._phase-=amount,this._phase<=0&&(this._phase=this._generator.LoopStartPhase+this._increment*-this._phase,this.Value=this._generator.GetValue(this._phase),this.CurrentState=AlphaSynth.Bank.Components.LfoState.Sustain)):(this._phase+=this._increment*amount,this._phase>=this._generator.LoopEndPhase&&(this._phase=this._generator.LoopStartPhase+(this._phase-this._generator.LoopEndPhase)%(this._generator.LoopEndPhase-this._generator.LoopStartPhase)),this.Value=this._generator.GetValue(this._phase))},Reset:function(){this.Value=0,this._delayTime>0?(this._phase=this._delayTime,this.CurrentState=AlphaSynth.Bank.Components.LfoState.Delay):(this._phase=0,this.CurrentState=AlphaSynth.Bank.Components.LfoState.Sustain)}},AlphaSynth.Bank.Components.FilterType={None:0,BiquadLowpass:1,BiquadHighpass:2,OnePoleLowpass:3},AlphaSynth.Bank.Components.Filter=function(){this._a1=0,this._a2=0,this._b1=0,this._b2=0,this._m1=0,this._m2=0,this._m3=0,this._cutOff=0,this._resonance=0,this.FilterMethod=AlphaSynth.Bank.Components.FilterType.None,this.CoeffNeedsUpdating=!1,this._a1=0,this._a2=0,this._b1=0,this._b2=0,this._m1=0,this._m2=0,this._m3=0,this.FilterMethod=AlphaSynth.Bank.Components.FilterType.None,this.set_CutOff(0),this.set_Resonance(0)},AlphaSynth.Bank.Components.Filter.prototype={get_CutOff:function(){return this._cutOff},set_CutOff:function(value){this._cutOff=value,this.CoeffNeedsUpdating=!0},get_Resonance:function(){return this._resonance},set_Resonance:function(value){this._resonance=value,this.CoeffNeedsUpdating=!0},get_Enabled:function(){return this.FilterMethod!=AlphaSynth.Bank.Components.FilterType.None},Disable:function(){this.FilterMethod=AlphaSynth.Bank.Components.FilterType.None},QuickSetup:function(sampleRate,note,velocity,filterInfo){this.CoeffNeedsUpdating=!1,this.set_CutOff(filterInfo.CutOff),this.set_Resonance(filterInfo.Resonance),this.FilterMethod=filterInfo.FilterMethod,this._a1=0,this._a2=0,this._b1=0,this._b2=0,this._m1=0,this._m2=0,this._m3=0,(this.get_CutOff()<=0||this.get_Resonance()<=0)&&(this.FilterMethod=AlphaSynth.Bank.Components.FilterType.None),this.FilterMethod!=AlphaSynth.Bank.Components.FilterType.None&&(this.set_CutOff(this.get_CutOff()*AlphaSynth.Synthesis.SynthHelper.CentsToPitch((note-filterInfo.RootKey)*filterInfo.KeyTrack+velocity*filterInfo.VelTrack|0)),this.UpdateCoefficients(sampleRate))},ApplyFilter:function(sample){switch(this.FilterMethod){case AlphaSynth.Bank.Components.FilterType.BiquadHighpass:case AlphaSynth.Bank.Components.FilterType.BiquadLowpass:return this._m3=sample-this._a1*this._m1-this._a2*this._m2,sample=this._b2*(this._m3+this._m2)+this._b1*this._m1,this._m2=this._m1,this._m1=this._m3,sample;case AlphaSynth.Bank.Components.FilterType.OnePoleLowpass:return this._m1+=this._a1*(sample-this._m1),this._m1;default:return 0}},ApplyFilter:function(data){switch(this.FilterMethod){case AlphaSynth.Bank.Components.FilterType.BiquadHighpass:case AlphaSynth.Bank.Components.FilterType.BiquadLowpass:for(var x=0;x<data.length;x++)this._m3=data[x]-this._a1*this._m1-this._a2*this._m2,data[x]=this._b2*(this._m3+this._m2)+this._b1*this._m1,this._m2=this._m1,this._m1=this._m3;break;case AlphaSynth.Bank.Components.FilterType.OnePoleLowpass:for(var x=0;x<data.length;x++)this._m1+=this._a1*(data[x]-this._m1),data[x]=this._m1}},ApplyFilterInterp:function(data,sampleRate){var ic=this.GenerateFilterCoeff(this.get_CutOff()/sampleRate,this.get_Resonance()),a1_inc=(ic[0]-this._a1)/data.length,a2_inc=(ic[1]-this._a2)/data.length,b1_inc=(ic[2]-this._b1)/data.length,b2_inc=(ic[3]-this._b2)/data.length;switch(this.FilterMethod){case AlphaSynth.Bank.Components.FilterType.BiquadHighpass:case AlphaSynth.Bank.Components.FilterType.BiquadLowpass:for(var x=0;x<data.length;x++)this._a1+=a1_inc,this._a2+=a2_inc,this._b1+=b1_inc,this._b2+=b2_inc,this._m3=data[x]-this._a1*this._m1-this._a2*this._m2,data[x]=this._b2*(this._m3+this._m2)+this._b1*this._m1,this._m2=this._m1,this._m1=this._m3;this._a1=ic[0],this._a2=ic[1],this._b1=ic[2],this._b2=ic[3];break;case AlphaSynth.Bank.Components.FilterType.OnePoleLowpass:for(var x=0;x<data.length;x++)this._a1+=a1_inc,this._m1+=this._a1*(data[x]-this._m1),data[x]=this._m1;this._a1=ic[0]}this.CoeffNeedsUpdating=!1},UpdateCoefficients:function(sampleRate){var coeff=this.GenerateFilterCoeff(this.get_CutOff()/sampleRate,this.get_Resonance());this._a1=coeff[0],this._a2=coeff[1],this._b1=coeff[2],this._b2=coeff[3],this.CoeffNeedsUpdating=!1},GenerateFilterCoeff:function(fc,q){fc=AlphaSynth.Synthesis.SynthHelper.ClampD(fc,1e-38,.49);var coeff=new Float32Array(4);switch(this.FilterMethod){case AlphaSynth.Bank.Components.FilterType.BiquadLowpass:var w0=6.28318530717958*fc,cosw0=Math.cos(w0),alpha=Math.sin(w0)/(2*q),a0inv=1/(1+alpha);coeff[0]=-2*cosw0*a0inv,coeff[1]=(1-alpha)*a0inv,coeff[2]=(1-cosw0)*a0inv*(1/Math.sqrt(q)),coeff[3]=.5*this._b1;break;case AlphaSynth.Bank.Components.FilterType.BiquadHighpass:var w0=6.28318530717958*fc,cosw0=Math.cos(w0),alpha=Math.sin(w0)/(2*q),a0inv=1/(1+alpha),qinv=1/Math.sqrt(q);coeff[0]=-2*cosw0*a0inv,coeff[1]=(1-alpha)*a0inv,coeff[2]=(-1-cosw0)*a0inv*qinv,coeff[3]=(1+cosw0)*a0inv*qinv*.5;break;case AlphaSynth.Bank.Components.FilterType.OnePoleLowpass:coeff[0]=1-Math.Exp(-6.28318530717959*fc)}return coeff}},AlphaSynth.Bank.Components.EnvelopeState={Delay:0,Attack:1,Hold:2,Decay:3,Sustain:4,Release:5,None:6},AlphaSynth.Bank.Components.Envelope=function(){this._stages=null,this._index=0,this._stage=null,this.Value=0,this.CurrentStage=AlphaSynth.Bank.Components.EnvelopeState.Delay,this.Depth=0,this.Value=0,this.Depth=0,this._stages=new Array(7);for(var x=0;x<this._stages.length;x++)this._stages[x]=new AlphaSynth.Bank.Components.EnvelopeStage,this._stages[x].Graph=AlphaSynth.Util.Tables.EnvelopeTables(0);this._stages[3].Reverse=!0,this._stages[5].Reverse=!0,this._stages[6].Time=1e8,this.CurrentStage=AlphaSynth.Bank.Components.EnvelopeState.Delay,this._stage=this._stages[this.CurrentStage]},AlphaSynth.Bank.Components.Envelope.prototype={QuickSetupSf2:function(sampleRate,note,keyNumToHold,keyNumToDecay,isVolumeEnvelope,envelopeInfo){for(this.Depth=envelopeInfo.Depth,this._stages[0].Offset=0,this._stages[0].Scale=0,this._stages[0].Time=Math.max(0,sampleRate*envelopeInfo.DelayTime|0),this._stages[1].Offset=envelopeInfo.StartLevel,this._stages[1].Scale=envelopeInfo.PeakLevel-envelopeInfo.StartLevel,this._stages[1].Time=Math.max(0,sampleRate*envelopeInfo.AttackTime|0),this._stages[1].Graph=AlphaSynth.Util.Tables.EnvelopeTables(envelopeInfo.AttackGraph),this._stages[2].Offset=0,this._stages[2].Scale=envelopeInfo.PeakLevel,this._stages[2].Time=0|Math.max(0,sampleRate*envelopeInfo.HoldTime*Math.pow(2,(60-note)*keyNumToHold/1200)),this._stages[3].Offset=envelopeInfo.SustainLevel,this._stages[3].Scale=envelopeInfo.PeakLevel-envelopeInfo.SustainLevel,this._stages[3].Time=envelopeInfo.SustainLevel==envelopeInfo.PeakLevel?0:Math.max(0,sampleRate*envelopeInfo.DecayTime*Math.pow(2,(60-note)*keyNumToDecay/1200)|0),this._stages[3].Graph=AlphaSynth.Util.Tables.EnvelopeTables(envelopeInfo.DecayGraph),this._stages[4].Offset=0,this._stages[4].Scale=envelopeInfo.SustainLevel,this._stages[4].Time=sampleRate*envelopeInfo.SustainTime|0,this._stages[5].Scale=0==this._stages[3].Time&&0==this._stages[4].Time?envelopeInfo.PeakLevel:this._stages[4].Scale,isVolumeEnvelope?(this._stages[5].Offset=-100,this._stages[5].Scale+=100,this._stages[6].Scale=-100):(this._stages[5].Offset=0,this._stages[6].Scale=0),this._stages[5].Time=Math.max(0,sampleRate*envelopeInfo.ReleaseTime|0),this._stages[5].Graph=AlphaSynth.Util.Tables.EnvelopeTables(envelopeInfo.ReleaseGraph),this._index=0,this.Value=0,this.CurrentStage=AlphaSynth.Bank.Components.EnvelopeState.Delay;0==this._stages[this.CurrentStage].Time;)this.CurrentStage++;this._stage=this._stages[this.CurrentStage]},Increment:function(samples){do{var neededSamples=this._stage.Time-this._index;if(neededSamples>samples)this._index+=samples,samples=0;else{if(this._index=0,this.CurrentStage!=AlphaSynth.Bank.Components.EnvelopeState.None)do this._stage=this._stages[++this.CurrentStage];while(0==this._stage.Time);samples-=neededSamples}}while(samples>0);var i=this._stage.Graph.length*(this._index/this._stage.Time)|0;this.Value=this._stage.Reverse?(1-this._stage.Graph[i])*this._stage.Scale+this._stage.Offset:this._stage.Graph[i]*this._stage.Scale+this._stage.Offset},Release:function(lowerLimit){this.Value<=lowerLimit?(this._index=0,this.CurrentStage=AlphaSynth.Bank.Components.EnvelopeState.None,this._stage=this._stages[this.CurrentStage]):this.CurrentStage<AlphaSynth.Bank.Components.EnvelopeState.Release&&(this._index=0,this.CurrentStage=AlphaSynth.Bank.Components.EnvelopeState.Release,this._stage=this._stages[this.CurrentStage],this._stage.Scale=this.Value)},ReleaseSf2VolumeEnvelope:function(){this.Value<=-100?(this._index=0,this.CurrentStage=AlphaSynth.Bank.Components.EnvelopeState.None,this._stage=this._stages[this.CurrentStage]):this.CurrentStage<AlphaSynth.Bank.Components.EnvelopeState.Release&&(this._index=0,this.CurrentStage=AlphaSynth.Bank.Components.EnvelopeState.Release,this._stage=this._stages[this.CurrentStage],this._stage.Offset=-100,this._stage.Scale=100+this.Value)}},AlphaSynth.Bank.Components.EnvelopeStage=function(){this.Time=0,this.Graph=null,this.Scale=0,this.Offset=0,this.Reverse=!1,this.Time=0,this.Graph=null,this.Scale=0,this.Offset=0,this.Reverse=!1},AlphaSynth.Bank.Components.PanFormulaEnum={Neg3dBCenter:0,Neg6dBCenter:1,ZeroCenter:2},AlphaSynth.Bank.Components.PanComponent=function(){this.Left=0,this.Right=0},AlphaSynth.Bank.Components.PanComponent.prototype={SetValue:function(value,formula){value=AlphaSynth.Synthesis.SynthHelper.ClampF(value,-1,1);var dvalue;switch(formula){case AlphaSynth.Bank.Components.PanFormulaEnum.Neg3dBCenter:dvalue=1.5707963267949*(value+1)/2,this.Left=Math.cos(dvalue),this.Right=Math.sin(dvalue);break;case AlphaSynth.Bank.Components.PanFormulaEnum.Neg6dBCenter:this.Left=.5+value*-.5,this.Right=.5+.5*value;break;case AlphaSynth.Bank.Components.PanFormulaEnum.ZeroCenter:dvalue=1.5707963267949*(value+1)/2,this.Left=Math.cos(dvalue)/.707106781186,this.Right=Math.sin(dvalue)/.707106781186;break;default:throw $CreateException(new System.Exception.ctor$$String("Invalid pan law selected."),new Error)}}},AlphaSynth.Bank.Descriptors=AlphaSynth.Bank.Descriptors||{},AlphaSynth.Bank.Descriptors.LfoDescriptor=function(){this.DelayTime=0,this.Frequency=0,this.Depth=0,this.Generator=null,this.DelayTime=0,this.Frequency=8,this.Depth=1,this.Generator=AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultSine},AlphaSynth.Bank.Descriptors.Waveform={Sine:0,Square:1,Saw:2,Triangle:3,SampleData:4,WhiteNoise:5},AlphaSynth.Bank.Descriptors.GeneratorDescriptor=function(){this.LoopMethod=AlphaSynth.Bank.Components.Generators.LoopMode.NoLoop,this.SamplerType=AlphaSynth.Bank.Descriptors.Waveform.Sine,this.AssetName=null,this.EndPhase=0,this.StartPhase=0,this.LoopEndPhase=0,this.LoopStartPhase=0,this.Offset=0,this.Period=0,this.RootKey=0,this.KeyTrack=0,this.VelTrack=0,this.Tune=0,this.LoopMethod=AlphaSynth.Bank.Components.Generators.LoopMode.NoLoop,this.SamplerType=AlphaSynth.Bank.Descriptors.Waveform.Sine,this.AssetName="null",this.EndPhase=-1,this.StartPhase=-1,this.LoopEndPhase=-1,this.LoopStartPhase=-1,this.Offset=0,this.Period=-1,this.RootKey=-1,this.KeyTrack=100,this.VelTrack=0,this.Tune=0},AlphaSynth.Bank.Descriptors.FilterDescriptor=function(){this.FilterMethod=AlphaSynth.Bank.Components.FilterType.None,this.CutOff=0,this.Resonance=0,this.RootKey=0,this.KeyTrack=0,this.VelTrack=0,this.FilterMethod=AlphaSynth.Bank.Components.FilterType.None,this.CutOff=-1,this.Resonance=1,this.RootKey=60,this.KeyTrack=0,this.VelTrack=0},AlphaSynth.Bank.Descriptors.EnvelopeDescriptor=function(){this.DelayTime=0,this.AttackTime=0,this.AttackGraph=0,this.HoldTime=0,this.DecayTime=0,this.DecayGraph=0,this.SustainTime=0,this.ReleaseTime=0,this.ReleaseGraph=0,this.SustainLevel=0,this.PeakLevel=0,this.StartLevel=0,this.Depth=0,this.Vel2Delay=0,this.Vel2Attack=0,this.Vel2Hold=0,this.Vel2Decay=0,this.Vel2Sustain=0,this.Vel2Release=0,this.Vel2Depth=0,this.DelayTime=0,this.AttackTime=0,this.AttackGraph=1,this.HoldTime=0,this.DecayTime=0,this.DecayGraph=1,this.SustainTime=3600,this.ReleaseTime=0,this.ReleaseGraph=1,this.SustainLevel=0,this.PeakLevel=1,this.StartLevel=0,this.Depth=1,this.Vel2Delay=0,this.Vel2Attack=0,this.Vel2Hold=0,this.Vel2Decay=0,this.Vel2Sustain=0,this.Vel2Release=0,this.Vel2Depth=0},AlphaSynth.Bank.Patch=AlphaSynth.Bank.Patch||{},AlphaSynth.Bank.Patch.Patch=function(name){this.ExclusiveGroupTarget=0,this.ExclusiveGroup=0,this.Name=null,this.Name=name,this.ExclusiveGroup=0,this.ExclusiveGroupTarget=0},AlphaSynth.Bank.Patch.Sf2Patch=function(name){this.iniFilterFc=0,this.filterQ=0,this.initialAttn=0,this.keyOverride=0,this.velOverride=0,this.keynumToModEnvHold=0,this.keynumToModEnvDecay=0,this.keynumToVolEnvHold=0,this.keynumToVolEnvDecay=0,this.pan=null,this.modLfoToPitch=0,this.vibLfoToPitch=0,this.modEnvToPitch=0,this.modLfoToFilterFc=0,this.modEnvToFilterFc=0,this.modLfoToVolume=0,this.gen=null,this.mod_env=null,this.vel_env=null,this.mod_lfo=null,this.vib_lfo=null,this.fltr=null,AlphaSynth.Bank.Patch.Patch.call(this,name)},AlphaSynth.Bank.Patch.Sf2Patch.prototype={Start:function(voiceparams){{var note=this.keyOverride>-1?this.keyOverride:voiceparams.Note;this.velOverride>-1?this.velOverride:voiceparams.Velocity}return voiceparams.GeneratorParams[0].QuickSetup(this.gen),voiceparams.Envelopes[0].QuickSetupSf2(voiceparams.SynthParams.Synth.SampleRate,note,this.keynumToModEnvHold,this.keynumToModEnvDecay,!1,this.mod_env),voiceparams.Envelopes[1].QuickSetupSf2(voiceparams.SynthParams.Synth.SampleRate,note,this.keynumToVolEnvHold,this.keynumToVolEnvDecay,!0,this.vel_env),voiceparams.Filters[0].Disable(),voiceparams.Lfos[0].QuickSetup(voiceparams.SynthParams.Synth.SampleRate,this.mod_lfo),voiceparams.Lfos[1].QuickSetup(voiceparams.SynthParams.Synth.SampleRate,this.vib_lfo),voiceparams.PitchOffset=(note-this.gen.RootKey)*this.gen.KeyTrack+this.gen.Tune,voiceparams.PitchOffset+=100*(voiceparams.SynthParams.MasterCoarseTune+(voiceparams.SynthParams.MasterFineTune.get_Combined()-8192)/8192)|0,voiceparams.VolOffset=this.initialAttn,voiceparams.VolOffset-=96*AlphaSynth.Bank.Patch.Sf2Patch.CalculateModulator(AlphaSynth.Sf2.SourceTypeEnum.Concave,AlphaSynth.Sf2.TransformEnum.Linear,AlphaSynth.Sf2.DirectionEnum.MaxToMin,AlphaSynth.Sf2.PolarityEnum.Unipolar,voiceparams.Velocity,0,127),voiceparams.VolOffset-=96*AlphaSynth.Bank.Patch.Sf2Patch.CalculateModulator(AlphaSynth.Sf2.SourceTypeEnum.Concave,AlphaSynth.Sf2.TransformEnum.Linear,AlphaSynth.Sf2.DirectionEnum.MaxToMin,AlphaSynth.Sf2.PolarityEnum.Unipolar,voiceparams.SynthParams.Volume.get_Coarse(),0,127),voiceparams.GeneratorParams[0].CurrentState!=AlphaSynth.Bank.Components.Generators.GeneratorState.Finished&&voiceparams.Envelopes[1].CurrentStage!=AlphaSynth.Bank.Components.EnvelopeState.None},Stop:function(voiceparams){this.gen.Release(voiceparams.GeneratorParams[0]),this.gen.LoopMode!=AlphaSynth.Bank.Components.Generators.LoopMode.OneShot&&(voiceparams.Envelopes[0].Release(1e-38),voiceparams.Envelopes[1].ReleaseSf2VolumeEnvelope())},Process:function(voiceparams,startIndex,endIndex){for(var basePitch=AlphaSynth.Synthesis.SynthHelper.CentsToPitch(voiceparams.PitchOffset+voiceparams.SynthParams.CurrentPitch)*this.gen.Frequency/voiceparams.SynthParams.Synth.SampleRate,baseVolume=voiceparams.SynthParams.Synth.get_MasterVolume()*voiceparams.SynthParams.CurrentVolume*voiceparams.SynthParams.Synth.get_MixGain(),x=startIndex;endIndex>x;x+=64*voiceparams.SynthParams.Synth.AudioChannels){if(voiceparams.Envelopes[0].Increment(64),voiceparams.Envelopes[1].Increment(64),voiceparams.Lfos[0].Increment(64),voiceparams.Lfos[1].Increment(64),this.gen.GetValues(voiceparams.GeneratorParams[0],voiceparams.BlockBuffer,basePitch*AlphaSynth.Synthesis.SynthHelper.CentsToPitch(voiceparams.Envelopes[0].Value*this.modEnvToPitch+voiceparams.Lfos[0].Value*this.modLfoToPitch+voiceparams.Lfos[1].Value*this.vibLfoToPitch|0)),voiceparams.Filters[0].get_Enabled()){var centsFc=voiceparams.PData[0].getInt32(0,!0)+voiceparams.Lfos[0].Value*this.modLfoToFilterFc+voiceparams.Envelopes[0].Value*this.modEnvToFilterFc;centsFc>13500&&(centsFc=13500),voiceparams.Filters[0].set_CutOff(AlphaSynth.Synthesis.SynthHelper.KeyToFrequency(centsFc/100,69)),voiceparams.Filters[0].CoeffNeedsUpdating?voiceparams.Filters[0].ApplyFilterInterp(voiceparams.BlockBuffer,voiceparams.SynthParams.Synth.SampleRate):voiceparams.Filters[0].ApplyFilter(voiceparams.BlockBuffer)}var volume=AlphaSynth.Synthesis.SynthHelper.DBtoLinear(voiceparams.VolOffset+voiceparams.Envelopes[1].Value+voiceparams.Lfos[0].Value*this.modLfoToVolume)*baseVolume;if(2==voiceparams.SynthParams.Synth.AudioChannels?voiceparams.MixMonoToStereoInterp(x,volume*this.pan.Left*voiceparams.SynthParams.CurrentPan.Left,volume*this.pan.Right*voiceparams.SynthParams.CurrentPan.Right):voiceparams.MixMonoToMonoInterp(x,volume),voiceparams.Envelopes[1].CurrentStage>AlphaSynth.Bank.Components.EnvelopeState.Hold&&1e-5>=volume||voiceparams.GeneratorParams[0].CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Finished)return void(voiceparams.State=AlphaSynth.Synthesis.VoiceStateEnum.Stopped)}},Load:function(region,assets){this.ExclusiveGroup=region.Generators[57],this.ExclusiveGroupTarget=this.ExclusiveGroup,this.iniFilterFc=region.Generators[8],this.filterQ=AlphaSynth.Synthesis.SynthHelper.DBtoLinear(region.Generators[9]/10),this.initialAttn=-region.Generators[48]/10,this.keyOverride=region.Generators[46],this.velOverride=region.Generators[47],this.keynumToModEnvHold=region.Generators[31],this.keynumToModEnvDecay=region.Generators[32],this.keynumToVolEnvHold=region.Generators[39],this.keynumToVolEnvDecay=region.Generators[40],this.pan=new AlphaSynth.Bank.Components.PanComponent,this.pan.SetValue(region.Generators[17]/500,AlphaSynth.Bank.Components.PanFormulaEnum.Neg3dBCenter),this.modLfoToPitch=region.Generators[5],this.vibLfoToPitch=region.Generators[6],this.modEnvToPitch=region.Generators[7],this.modLfoToFilterFc=region.Generators[10],this.modEnvToFilterFc=region.Generators[11],this.modLfoToVolume=region.Generators[13]/10,this.LoadGen(region,assets),this.LoadEnvelopes(region),this.LoadLfos(region),this.LoadFilter(region)},LoadGen:function(region,assets){var sda=assets.SampleAssets[region.Generators[53]];switch(this.gen=new AlphaSynth.Bank.Components.Generators.SampleGenerator,this.gen.EndPhase=sda.End+region.Generators[1]+32768*region.Generators[12],this.gen.Frequency=sda.SampleRate,this.gen.KeyTrack=region.Generators[56],this.gen.LoopEndPhase=sda.LoopEnd+region.Generators[3]+32768*region.Generators[50],3&region.Generators[54]){case 0:case 2:this.gen.LoopMode=AlphaSynth.Bank.Components.Generators.LoopMode.NoLoop;
break;case 1:this.gen.LoopMode=AlphaSynth.Bank.Components.Generators.LoopMode.Continuous;break;case 3:this.gen.LoopMode=AlphaSynth.Bank.Components.Generators.LoopMode.LoopUntilNoteOff}this.gen.LoopStartPhase=sda.LoopStart+region.Generators[2]+32768*region.Generators[45],this.gen.Offset=0,this.gen.Period=1,this.gen.RootKey=region.Generators[58]>-1?region.Generators[58]:sda.RootKey,this.gen.StartPhase=sda.Start+region.Generators[0]+32768*region.Generators[4],this.gen.Tune=sda.Tune+region.Generators[52]+100*region.Generators[51]|0,this.gen.VelocityTrack=0,this.gen.Samples=sda.SampleData},LoadEnvelopes:function(region){this.mod_env=new AlphaSynth.Bank.Descriptors.EnvelopeDescriptor,this.mod_env.AttackTime=Math.pow(2,region.Generators[26]/1200),this.mod_env.AttackGraph=3,this.mod_env.DecayTime=Math.pow(2,region.Generators[28]/1200),this.mod_env.DelayTime=Math.pow(2,region.Generators[25]/1200),this.mod_env.HoldTime=Math.pow(2,region.Generators[27]/1200),this.mod_env.PeakLevel=1,this.mod_env.ReleaseTime=Math.pow(2,region.Generators[30]/1200),this.mod_env.StartLevel=0,this.mod_env.SustainLevel=1-AlphaSynth.Synthesis.SynthHelper.ClampS(region.Generators[29],0,1e3)/1e3,this.mod_env.AttackTime<.001?this.mod_env.AttackTime=.001:this.mod_env.AttackTime>100&&(this.mod_env.AttackTime=100),this.mod_env.DecayTime<.001?this.mod_env.DecayTime=0:this.mod_env.DecayTime>100&&(this.mod_env.DecayTime=100),this.mod_env.DelayTime<.001?this.mod_env.DelayTime=0:this.mod_env.DelayTime>20&&(this.mod_env.DelayTime=20),this.mod_env.HoldTime<.001?this.mod_env.HoldTime=0:this.mod_env.HoldTime>20&&(this.mod_env.HoldTime=20),this.mod_env.ReleaseTime<.001?this.mod_env.ReleaseTime=.001:this.mod_env.ReleaseTime>100&&(this.mod_env.ReleaseTime=100),this.vel_env=new AlphaSynth.Bank.Descriptors.EnvelopeDescriptor,this.vel_env.AttackTime=Math.pow(2,region.Generators[34]/1200),this.vel_env.AttackGraph=3,this.vel_env.DecayTime=Math.pow(2,region.Generators[36]/1200),this.vel_env.DelayTime=Math.pow(2,region.Generators[33]/1200),this.vel_env.HoldTime=Math.pow(2,region.Generators[35]/1200),this.vel_env.PeakLevel=0,this.vel_env.ReleaseTime=Math.pow(2,region.Generators[38]/1200),this.vel_env.StartLevel=-100,this.vel_env.SustainLevel=AlphaSynth.Synthesis.SynthHelper.ClampS(region.Generators[37],0,1e3)/-10,this.vel_env.AttackTime<.001?this.vel_env.AttackTime=.001:this.vel_env.AttackTime>100&&(this.vel_env.AttackTime=100),this.vel_env.DecayTime<.001?this.vel_env.DecayTime=0:this.vel_env.DecayTime>100&&(this.vel_env.DecayTime=100),this.vel_env.DelayTime<.001?this.vel_env.DelayTime=0:this.vel_env.DelayTime>20&&(this.vel_env.DelayTime=20),this.vel_env.HoldTime<.001?this.vel_env.HoldTime=0:this.vel_env.HoldTime>20&&(this.vel_env.HoldTime=20),this.vel_env.ReleaseTime<.001?this.vel_env.ReleaseTime=.001:this.vel_env.ReleaseTime>100&&(this.vel_env.ReleaseTime=100)},LoadLfos:function(region){this.mod_lfo=new AlphaSynth.Bank.Descriptors.LfoDescriptor,this.mod_lfo.DelayTime=Math.pow(2,region.Generators[21]/1200),this.mod_lfo.Frequency=8.176*Math.pow(2,region.Generators[22]/1200),this.mod_lfo.Generator=AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultSine,this.vib_lfo=new AlphaSynth.Bank.Descriptors.LfoDescriptor,this.vib_lfo.DelayTime=Math.pow(2,region.Generators[23]/1200),this.vib_lfo.Frequency=8.176*Math.pow(2,region.Generators[24]/1200),this.vib_lfo.Generator=AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultSine},LoadFilter:function(region){this.fltr=new AlphaSynth.Bank.Descriptors.FilterDescriptor,this.fltr.FilterMethod=AlphaSynth.Bank.Components.FilterType.BiquadLowpass,this.fltr.CutOff=AlphaSynth.Synthesis.SynthHelper.KeyToFrequency(region.Generators[8]/100,69),this.fltr.Resonance=AlphaSynth.Synthesis.SynthHelper.DBtoLinear(region.Generators[9]/10)}},AlphaSynth.Bank.Patch.Sf2Patch.CalculateModulator=function(s,t,d,p,value,min,max){var i,output=0;switch(value-=min,max-=min,d==AlphaSynth.Sf2.DirectionEnum.MaxToMin&&(value=max-value),s){case AlphaSynth.Sf2.SourceTypeEnum.Linear:output=value/max|0;break;case AlphaSynth.Sf2.SourceTypeEnum.Concave:i=127-value,output=-.208333333333333*(Math.log(i*i/(max*max))/Math.LN10);break;case AlphaSynth.Sf2.SourceTypeEnum.Convex:i=value,output=1+.208333333333333*(Math.log(i*i/(max*max))/Math.LN10);break;case AlphaSynth.Sf2.SourceTypeEnum.Switch:output=(max/2|0)>=value?0:1}return p==AlphaSynth.Sf2.PolarityEnum.Bipolar&&(output=2*output-1),t==AlphaSynth.Sf2.TransformEnum.AbsoluteValue&&(output=Math.abs(output)),output},$Inherit(AlphaSynth.Bank.Patch.Sf2Patch,AlphaSynth.Bank.Patch.Patch),AlphaSynth.Bank.Patch.MultiPatch=function(name){this._intervalType=AlphaSynth.Bank.Patch.IntervalType.ChannelKeyVelocity,this._intervalList=null,AlphaSynth.Bank.Patch.Patch.call(this,name),this._intervalType=AlphaSynth.Bank.Patch.IntervalType.ChannelKeyVelocity},AlphaSynth.Bank.Patch.MultiPatch.prototype={FindPatches:function(channel,key,velocity,layers){var count=0;switch(this._intervalType){case AlphaSynth.Bank.Patch.IntervalType.ChannelKeyVelocity:for(var x=0;x<this._intervalList.length&&(!this._intervalList[x].CheckAllIntervals(channel,key,velocity)||(layers[count++]=this._intervalList[x].Patch,count!=layers.length));x++);break;case AlphaSynth.Bank.Patch.IntervalType.ChannelKey:for(var x=0;x<this._intervalList.length&&(!this._intervalList[x].CheckChannelAndKey(channel,key)||(layers[count++]=this._intervalList[x].Patch,count!=layers.length));x++);break;case AlphaSynth.Bank.Patch.IntervalType.KeyVelocity:for(var x=0;x<this._intervalList.length&&(!this._intervalList[x].CheckKeyAndVelocity(key,velocity)||(layers[count++]=this._intervalList[x].Patch,count!=layers.length));x++);break;case AlphaSynth.Bank.Patch.IntervalType.Key:for(var x=0;x<this._intervalList.length&&(!this._intervalList[x].CheckKey(key)||(layers[count++]=this._intervalList[x].Patch,count!=layers.length));x++);}return count},Start:function(){return!1},Process:function(){},Stop:function(){},LoadSf2:function(regions,assets){this._intervalList=new Array(regions.length);for(var x=0;x<regions.length;x++){var loKey,hiKey,loVel,hiVel;AlphaSynth.Platform.TypeUtils.IsLittleEndian?(loKey=255&regions[x].Generators[43]&255,hiKey=regions[x].Generators[43]>>8&255&255,loVel=255&regions[x].Generators[44]&255,hiVel=regions[x].Generators[44]>>8&255&255):(hiKey=255&regions[x].Generators[43]&255,loKey=regions[x].Generators[43]>>8&255&255,hiVel=255&regions[x].Generators[44]&255,loVel=regions[x].Generators[44]>>8&255&255);var sf2=new AlphaSynth.Bank.Patch.Sf2Patch(this.Name+"_"+x);sf2.Load(regions[x],assets),this._intervalList[x]=new AlphaSynth.Bank.Patch.PatchInterval(sf2,0,15,loKey,hiKey,loVel,hiVel)}this.DetermineIntervalType()},DetermineIntervalType:function(){for(var checkChannel=!1,checkVelocity=!1,x=0;x<this._intervalList.length&&(0==this._intervalList[x].StartChannel&&15==this._intervalList[x].EndChannel||(checkChannel=!0,!checkChannel||!checkVelocity))&&(0==this._intervalList[x].StartVelocity&&127==this._intervalList[x].EndVelocity||(checkVelocity=!0,!checkChannel||!checkVelocity));x++);this._intervalType=checkChannel&checkVelocity?AlphaSynth.Bank.Patch.IntervalType.ChannelKeyVelocity:checkChannel?AlphaSynth.Bank.Patch.IntervalType.ChannelKey:checkVelocity?AlphaSynth.Bank.Patch.IntervalType.KeyVelocity:AlphaSynth.Bank.Patch.IntervalType.Key}},$Inherit(AlphaSynth.Bank.Patch.MultiPatch,AlphaSynth.Bank.Patch.Patch),AlphaSynth.Bank.Patch.IntervalType={ChannelKeyVelocity:0,ChannelKey:1,KeyVelocity:2,Key:3},AlphaSynth.Bank.Patch.PatchInterval=function(patch,startChannel,endChannel,startKey,endKey,startVelocity,endVelocity){this.Patch=null,this.StartChannel=0,this.StartKey=0,this.StartVelocity=0,this.EndChannel=0,this.EndKey=0,this.EndVelocity=0,this.Patch=patch,this.StartChannel=startChannel,this.EndChannel=endChannel,this.StartKey=startKey,this.EndKey=endKey,this.StartVelocity=startVelocity,this.EndVelocity=endVelocity},AlphaSynth.Bank.Patch.PatchInterval.prototype={CheckAllIntervals:function(channel,key,velocity){return channel>=this.StartChannel&&channel<=this.EndChannel&&key>=this.StartKey&&key<=this.EndKey&&velocity>=this.StartVelocity&&velocity<=this.EndVelocity},CheckChannelAndKey:function(channel,key){return channel>=this.StartChannel&&channel<=this.EndChannel&&key>=this.StartKey&&key<=this.EndKey},CheckKeyAndVelocity:function(key,velocity){return key>=this.StartKey&&key<=this.EndKey&&velocity>=this.StartVelocity&&velocity<=this.EndVelocity},CheckKey:function(key){return key>=this.StartKey&&key<=this.EndKey}},AlphaSynth.Bank.SampleDataAsset=function(sample,sampleData){this.Name=null,this.Channels=0,this.SampleRate=0,this.RootKey=0,this.Tune=0,this.Start=0,this.End=0,this.LoopStart=0,this.LoopEnd=0,this.SampleData=null,this.Channels=1,this.Name=sample.Name,this.SampleRate=sample.SampleRate,this.RootKey=sample.RootKey,this.Tune=sample.Tune,this.Start=sample.Start,this.End=sample.End,this.LoopStart=sample.StartLoop,this.LoopEnd=sample.EndLoop,this.SampleData=AlphaSynth.Util.PcmData.Create(sampleData.BitsPerSample,sampleData.SampleData,!0)},AlphaSynth.Bank.PatchBank=function(){this._bank=null,this._assets=null,this.Name=null,this.Comments=null,this.Reset()},AlphaSynth.Bank.PatchBank.prototype={Reset:function(){this._bank={},this._assets=new AlphaSynth.Bank.AssetManager,this.Name="",this.Comments=""},get_LoadedBanks:function(){for(var banks=[],$i2=0,$t2=Object.keys(this._bank),$l2=$t2.length,bank=$t2[$i2];$l2>$i2;$i2++,bank=$t2[$i2])banks.push(AlphaSynth.Platform.Std.ParseInt(bank));return banks.slice(0)},GetBank:function(bankNumber){return this._bank.hasOwnProperty(bankNumber)?this._bank[bankNumber]:null},GetPatchByNumber:function(bankNumber,patchNumber){return this._bank.hasOwnProperty(bankNumber)?this._bank[bankNumber][patchNumber]:null},GetPatchByName:function(bankNumber,name){if(this._bank.hasOwnProperty(bankNumber))for(var patches=this._bank[bankNumber],$i3=0,$l3=patches.length,patch=patches[$i3];$l3>$i3;$i3++,patch=patches[$i3])if(null!=patch&&patch.Name==name)return patch;return null},IsBankLoaded:function(bankNumber){return this._bank.hasOwnProperty(bankNumber)},LoadSf2:function(input){this.Reset(),AlphaSynth.Util.Logger.Debug("Reading SF2");var sf=new AlphaSynth.Sf2.SoundFont;sf.Load(input),AlphaSynth.Util.Logger.Debug("Building patchbank"),this.Name=sf.Info.BankName,this.Comments=sf.Info.Comments;for(var $i4=0,$t4=sf.Presets.SampleHeaders,$l4=$t4.length,sampleHeader=$t4[$i4];$l4>$i4;$i4++,sampleHeader=$t4[$i4])this._assets.SampleAssets.push(new AlphaSynth.Bank.SampleDataAsset(sampleHeader,sf.SampleData));for(var sfinsts=this.ReadSf2Instruments(sf.Presets.Instruments),$i5=0,$t5=sf.Presets.PresetHeaders,$l5=$t5.length,p=$t5[$i5];$l5>$i5;$i5++,p=$t5[$i5]){var i,globalGens=null;0==p.Zones[0].Generators.length||p.Zones[0].Generators[p.Zones[0].Generators.length-1].GeneratorType!=AlphaSynth.Sf2.GeneratorEnum.Instrument?(globalGens=p.Zones[0].Generators,i=1):i=0;for(var regionList=[];i<p.Zones.length;){var presetLoKey=0,presetHiKey=127,presetLoVel=0,presetHiVel=127;if(p.Zones[i].Generators[0].GeneratorType==AlphaSynth.Sf2.GeneratorEnum.KeyRange?(AlphaSynth.Platform.TypeUtils.IsLittleEndian?(presetLoKey=255&p.Zones[i].Generators[0].get_AmountInt16()&255,presetHiKey=p.Zones[i].Generators[0].get_AmountInt16()>>8&255&255):(presetHiKey=255&p.Zones[i].Generators[0].get_AmountInt16()&255,presetLoKey=p.Zones[i].Generators[0].get_AmountInt16()>>8&255&255),p.Zones[i].Generators.length>1&&p.Zones[i].Generators[1].GeneratorType==AlphaSynth.Sf2.GeneratorEnum.VelocityRange&&(AlphaSynth.Platform.TypeUtils.IsLittleEndian?(presetLoVel=255&p.Zones[i].Generators[1].get_AmountInt16()&255,presetHiVel=p.Zones[i].Generators[1].get_AmountInt16()>>8&255&255):(presetHiVel=255&p.Zones[i].Generators[1].get_AmountInt16()&255,presetLoVel=p.Zones[i].Generators[1].get_AmountInt16()>>8&255&255))):p.Zones[i].Generators[0].GeneratorType==AlphaSynth.Sf2.GeneratorEnum.VelocityRange&&(AlphaSynth.Platform.TypeUtils.IsLittleEndian?(presetLoVel=255&p.Zones[i].Generators[0].get_AmountInt16()&255,presetHiVel=p.Zones[i].Generators[0].get_AmountInt16()>>8&255&255):(presetHiVel=255&p.Zones[i].Generators[0].get_AmountInt16()&255,presetLoVel=p.Zones[i].Generators[0].get_AmountInt16()>>8&255&255)),p.Zones[i].Generators[p.Zones[i].Generators.length-1].GeneratorType==AlphaSynth.Sf2.GeneratorEnum.Instrument)for(var insts=sfinsts[p.Zones[i].Generators[p.Zones[i].Generators.length-1].get_AmountInt16()],$i6=0,$l6=insts.length,inst=insts[$i6];$l6>$i6;$i6++,inst=insts[$i6]){var instLoKey,instHiKey,instLoVel,instHiVel;if(AlphaSynth.Platform.TypeUtils.IsLittleEndian?(instLoKey=255&inst.Generators[43]&255,instHiKey=inst.Generators[43]>>8&255&255,instLoVel=255&inst.Generators[44]&255,instHiVel=inst.Generators[44]>>8&255&255):(instHiKey=255&inst.Generators[43]&255,instLoKey=inst.Generators[43]>>8&255&255,instHiVel=255&inst.Generators[44]&255,instLoVel=inst.Generators[44]>>8&255&255),presetHiKey>=instLoKey&&instHiKey>=presetLoKey&&presetHiVel>=instLoVel&&instHiVel>=presetLoVel){var r=new AlphaSynth.Sf2.Sf2Region;AlphaSynth.Platform.Std.ArrayCopy(inst.Generators,0,r.Generators,0,r.Generators.length),this.ReadSf2Region(r,globalGens,p.Zones[i].Generators,!0),regionList.push(r)}}i++}var mp=new AlphaSynth.Bank.Patch.MultiPatch(p.Name);mp.LoadSf2(regionList.slice(0),this._assets),this._assets.PatchAssets.push(new AlphaSynth.Bank.PatchAsset(mp.Name,mp)),this.AssignPatchToBank(mp,p.BankNumber,p.PatchNumber,p.PatchNumber)}},ReadSf2Instruments:function(instruments){for(var regions=new Array(instruments.length),x=0;x<instruments.length;x++){var i,globalGens=null;0==instruments[x].Zones[0].Generators.length||instruments[x].Zones[0].Generators[instruments[x].Zones[0].Generators.length-1].GeneratorType!=AlphaSynth.Sf2.GeneratorEnum.SampleID?(globalGens=instruments[x].Zones[0].Generators,i=1):i=0,regions[x]=new Array(instruments[x].Zones.length-i);for(var j=0;j<regions[x].length;j++){var r=new AlphaSynth.Sf2.Sf2Region;r.ApplyDefaultValues(),this.ReadSf2Region(r,globalGens,instruments[x].Zones[j+i].Generators,!1),regions[x][j]=r}}return regions},ReadSf2Region:function(region,globals,gens,isRelative){if(isRelative){for(var genList=[],$i7=0,$l7=gens.length,generator=gens[$i7];$l7>$i7;$i7++,generator=gens[$i7])genList.push(generator);if(null!=globals)for(var x=0;x<globals.length;x++){for(var found=!1,i=0;i<genList.length;i++)if(genList[i].GeneratorType==globals[x].GeneratorType){found=!0;break}found||genList.push(globals[x])}for(var x=0;x<genList.length;x++){var value=genList[x].GeneratorType;if(!(5>value||12==value||45==value||46==value||47==value||50==value||54==value||57==value||58==value))if(43==value||44==value){var lo_a,hi_a,lo_b,hi_b;if(AlphaSynth.Platform.TypeUtils.IsLittleEndian?(lo_a=255&region.Generators[value]&255,hi_a=region.Generators[value]>>8&255&255,lo_b=255&genList[x].get_AmountInt16()&255,hi_b=genList[x].get_AmountInt16()>>8&255&255):(hi_a=255&region.Generators[value]&255,lo_a=region.Generators[value]>>8&255&255,hi_b=255&genList[x].get_AmountInt16()&255,lo_b=genList[x].get_AmountInt16()>>8&255&255),lo_a=Math.max(lo_a,lo_b),hi_a=Math.min(hi_a,hi_b),lo_a>hi_a)throw $CreateException(new System.Exception.ctor$$String("Invalid sf2 region. The range generators do not intersect."),new Error);region.Generators[value]=AlphaSynth.Platform.TypeUtils.ToInt16(AlphaSynth.Platform.TypeUtils.IsLittleEndian?lo_a|hi_a<<8:lo_a<<8|hi_a)}else region.Generators[value]=AlphaSynth.Platform.TypeUtils.ToInt16(region.Generators[value]+genList[x].get_AmountInt16())}}else{if(null!=globals)for(var x=0;x<globals.length;x++)region.Generators[globals[x].GeneratorType]=globals[x].get_AmountInt16();for(var x=0;x<gens.length;x++)region.Generators[gens[x].GeneratorType]=gens[x].get_AmountInt16()}},AssignPatchToBank:function(patch,bankNumber,startRange,endRange){if(!(0>bankNumber)){if(startRange>endRange){var range=startRange;startRange=endRange,endRange=range}if(0>startRange||startRange>=128)throw $CreateException(new System.Exception.ctor$$String("startRange out of range"),new Error);if(0>endRange||endRange>=128)throw $CreateException(new System.Exception.ctor$$String("endRange out of range"),new Error);var patches;this._bank.hasOwnProperty(bankNumber)?patches=this._bank[bankNumber]:(patches=new Array(128),this._bank[bankNumber]=patches);for(var x=startRange;endRange>=x;x++)patches[x]=patch}}},$StaticConstructor(function(){AlphaSynth.Bank.PatchBank.DrumBank=128,AlphaSynth.Bank.PatchBank.BankSize=128}),AlphaSynth.Bank.PatchAsset=function(name,patch){this.Name=null,this.Patch=null,this.Name=name,this.Patch=patch},AlphaSynth.Ds=AlphaSynth.Ds||{},AlphaSynth.Ds.LinkedList=function(){this.First=null,this.Length=0,this.Length=0},AlphaSynth.Ds.LinkedList.prototype={AddFirst:function(value){var node=new AlphaSynth.Ds.LinkedListNode;node.Value=value,null==this.First?this.InsertNodeToEmptyList(node):(this.InsertNodeBefore(this.First,node),this.First=node)},AddLast:function(value){var node=new AlphaSynth.Ds.LinkedListNode;node.Value=value,null==this.First?this.InsertNodeToEmptyList(node):this.InsertNodeBefore(this.First,node)},RemoveFirst:function(){if(null==this.First)return null;var v=this.First.Value;return this.Remove(this.First),v},RemoveLast:function(){if(null==this.First)return null;var v=null!=this.First._prev?this.First._prev.Value:null;return this.Remove(this.First._prev),v},Remove:function(n){n._next==n?this.First=null:(n._next._prev=n._prev,n._prev._next=n._next,this.First==n&&(this.First=n._next)),n.Invalidate(),this.Length--},InsertNodeBefore:function(node,newNode){newNode._next=node,newNode._prev=node._prev,node._prev._next=newNode,node._prev=newNode,newNode._list=this,this.Length++},InsertNodeToEmptyList:function(node){node._next=node,node._prev=node,node._list=this,this.First=node,this.Length++}},AlphaSynth.Ds.LinkedListNode=function(){this._list=null,this._next=null,this._prev=null,this.Value=null},AlphaSynth.Ds.LinkedListNode.prototype={get_Next:function(){return null==this._next||this._list.First==this._next?null:this._next},get_Prev:function(){return null==this._prev||this==this._list.First?null:this._prev},Invalidate:function(){this._list=null,this._next=null,this._prev=null}},AlphaSynth.Ds.CircularSampleBuffer=function(size){this._buffer=null,this._writePosition=0,this._readPosition=0,this._sampleCount=0,this._buffer=new Float32Array(size),this._writePosition=0,this._readPosition=0,this._sampleCount=0},AlphaSynth.Ds.CircularSampleBuffer.prototype={get_Count:function(){return this._sampleCount},Clear:function(){this._readPosition=0,this._writePosition=0,this._sampleCount=0,this._buffer=new Float32Array(this._buffer.length)},Write:function(data,offset,count){var samplesWritten=0;count>this._buffer.length-this._sampleCount&&(count=this._buffer.length-this._sampleCount);var writeToEnd=Math.min(this._buffer.length-this._writePosition,count);return this._buffer.set(data.subarray(offset,offset+writeToEnd),this._writePosition),this._writePosition+=writeToEnd,this._writePosition%=this._buffer.length,samplesWritten+=writeToEnd,count>samplesWritten&&(this._buffer.set(data.subarray(offset+samplesWritten,offset+samplesWritten+count-samplesWritten),this._writePosition),this._writePosition+=count-samplesWritten,samplesWritten=count),this._sampleCount+=samplesWritten,samplesWritten},Read:function(data,offset,count){count>this._sampleCount&&(count=this._sampleCount);var samplesRead=0,readToEnd=Math.min(this._buffer.length-this._readPosition,count);return data.set(this._buffer.subarray(this._readPosition,this._readPosition+readToEnd),offset),samplesRead+=readToEnd,this._readPosition+=readToEnd,this._readPosition%=this._buffer.length,count>samplesRead&&(data.set(this._buffer.subarray(this._readPosition,this._readPosition+count-samplesRead),offset+samplesRead),this._readPosition+=count-samplesRead,samplesRead=count),this._sampleCount-=samplesRead,samplesRead}},AlphaSynth.IO=AlphaSynth.IO||{},AlphaSynth.IO.ByteBuffer=function(){this._buffer=null,this._capacity=0,this._position=0,this.Length=0},AlphaSynth.IO.ByteBuffer.prototype={get_Position:function(){return this._position},set_Position:function(value){this._position=value},GetBuffer:function(){return this._buffer},Reset:function(){this.set_Position(0)},Skip:function(offset){this.set_Position(this.get_Position()+offset)},SetCapacity:function(value){if(value!=this._capacity){if(value>0){var newBuffer=new Uint8Array(value);this.Length>0&&newBuffer.set(this._buffer.subarray(0,0+this.Length),0),this._buffer=newBuffer}else this._buffer=null;this._capacity=value}},ReadByte:function(){var n=this.Length-this.get_Position();if(0>=n)return-1;var b=this._buffer[this.get_Position()];return this.set_Position(this.get_Position()+1),b},Read:function(buffer,offset,count){var n=this.Length-this.get_Position();if(n>count&&(n=count),0>=n)return 0;if(8>=n)for(var byteCount=n;--byteCount>=0;)buffer[offset+byteCount]=this._buffer[this.get_Position()+byteCount];else buffer.set(this._buffer.subarray(this.get_Position(),this.get_Position()+n),offset);return this.set_Position(this.get_Position()+n),n},WriteByte:function(value){var buffer=new Uint8Array(1);buffer[0]=value,this.Write(buffer,0,1)},Write:function(buffer,offset,count){var i=this.get_Position()+count;if(i>this.Length&&(i>this._capacity&&this.EnsureCapacity(i),this.Length=i),8>=count&&buffer!=this._buffer)for(var byteCount=count;--byteCount>=0;)this._buffer[this.get_Position()+byteCount]=buffer[offset+byteCount];else this._buffer.set(buffer.subarray(offset,offset+count),this.get_Position());this.set_Position(i)},EnsureCapacity:function(value){if(value>this._capacity){var newCapacity=value;256>newCapacity&&(newCapacity=256),newCapacity<2*this._capacity&&(newCapacity=2*this._capacity),this.SetCapacity(newCapacity)}},ToArray:function(){var copy=new Uint8Array(this.Length);return copy.set(this._buffer.subarray(0,0+this.Length),0),copy}},AlphaSynth.IO.ByteBuffer.Empty=function(){return AlphaSynth.IO.ByteBuffer.WithCapactiy(0)},AlphaSynth.IO.ByteBuffer.WithCapactiy=function(capacity){var buffer=new AlphaSynth.IO.ByteBuffer;return buffer._buffer=new Uint8Array(capacity),buffer._capacity=capacity,buffer},AlphaSynth.IO.ByteBuffer.FromBuffer=function(data){var buffer=new AlphaSynth.IO.ByteBuffer;return buffer._buffer=data,buffer._capacity=buffer.Length=data.length,buffer},AlphaSynth.Midi=AlphaSynth.Midi||{},AlphaSynth.Midi.Event=AlphaSynth.Midi.Event||{},AlphaSynth.Midi.Event.MidiEvent=function(delta,status,data1,data2){this.Message=0,this.DeltaTime=0,this.DeltaTime=delta,this.Message=status|data1<<8|data2<<16},AlphaSynth.Midi.Event.MidiEvent.prototype={get_Channel:function(){return 15&this.Message},get_Command:function(){return 240&this.Message},get_Data1:function(){return(65280&this.Message)>>8},get_Data2:function(){return(16711680&this.Message)>>16}},AlphaSynth.Midi.Event.SystemCommonEvent=function(delta,status,data1,data2){AlphaSynth.Midi.Event.MidiEvent.call(this,delta,status,data1,data2)},AlphaSynth.Midi.Event.SystemCommonEvent.prototype={get_Channel:function(){return-1},get_Command:function(){return 255&this.Message}},$Inherit(AlphaSynth.Midi.Event.SystemCommonEvent,AlphaSynth.Midi.Event.MidiEvent),AlphaSynth.Midi.Event.SystemExclusiveEvent=function(delta,status,id,data){this.Data=null,AlphaSynth.Midi.Event.SystemCommonEvent.call(this,delta,status,255&id,id>>8),this.Data=data},AlphaSynth.Midi.Event.SystemExclusiveEvent.prototype={get_ManufacturerId:function(){return this.Message>>8}},$Inherit(AlphaSynth.Midi.Event.SystemExclusiveEvent,AlphaSynth.Midi.Event.SystemCommonEvent),AlphaSynth.Midi.Event.SystemCommonTypeEnum={SystemExclusive:240,MtcQuarterFrame:241,SongPosition:242,SongSelect:243,TuneRequest:246,SystemExclusive2:247},AlphaSynth.Midi.Event.RealTimeTypeEnum={MidiClock:248,MidiTick:249,MidiStart:250,MidiContinue:252,MidiStop:253,ActiveSense:254,Reset:255},AlphaSynth.Midi.Event.RealTimeEvent=function(delta,status,data1,data2){AlphaSynth.Midi.Event.MidiEvent.call(this,delta,status,data1,data2)},AlphaSynth.Midi.Event.RealTimeEvent.prototype={get_Channel:function(){return-1},get_Command:function(){return 255&this.Message}},$Inherit(AlphaSynth.Midi.Event.RealTimeEvent,AlphaSynth.Midi.Event.MidiEvent),AlphaSynth.Midi.Event.MidiEventTypeEnum={NoteOff:128,NoteOn:144,NoteAftertouch:160,Controller:176,ProgramChange:192,ChannelAftertouch:208,PitchBend:224,Meta:255},AlphaSynth.Midi.Event.ControllerTypeEnum={BankSelectCoarse:0,ModulationCoarse:1,BreathControllerCoarse:2,FootControllerCoarse:4,PortamentoTimeCoarse:5,DataEntryCoarse:6,VolumeCoarse:7,BalanceCoarse:8,PanCoarse:10,ExpressionControllerCoarse:11,EffectControl1Coarse:12,EffectControl2Coarse:13,GeneralPurposeSlider1:16,GeneralPurposeSlider2:17,GeneralPurposeSlider3:18,GeneralPurposeSlider4:19,BankSelectFine:32,ModulationFine:33,BreathControllerFine:34,FootControllerFine:36,PortamentoTimeFine:37,DataEntryFine:38,VolumeFine:39,BalanceFine:40,PanFine:42,ExpressionControllerFine:43,EffectControl1Fine:44,EffectControl2Fine:45,HoldPedal:64,Portamento:65,SostenutoPedal:66,SoftPedal:67,LegatoPedal:68,Hold2Pedal:69,SoundVariation:70,SoundTimbre:71,SoundReleaseTime:72,SoundAttackTime:73,SoundBrightness:74,SoundControl6:75,SoundControl7:76,SoundControl8:77,SoundControl9:78,SoundControl10:79,GeneralPurposeButton1:80,GeneralPurposeButton2:81,GeneralPurposeButton3:82,GeneralPurposeButton4:83,EffectsLevel:91,TremuloLevel:92,ChorusLevel:93,CelesteLevel:94,PhaseLevel:95,DataButtonIncrement:96,DataButtonDecrement:97,NonRegisteredParameterFine:98,NonRegisteredParameterCourse:99,RegisteredParameterFine:100,RegisteredParameterCourse:101,AllSoundOff:120,ResetControllers:121,LocalKeyboard:122,AllNotesOff:123,OmniModeOff:124,OmniModeOn:125,MonoMode:126,PolyMode:127},AlphaSynth.Midi.Event.MetaEvent=function(delta,status,data1,data2){AlphaSynth.Midi.Event.MidiEvent.call(this,delta,status,data1,data2)},AlphaSynth.Midi.Event.MetaEvent.prototype={get_Channel:function(){return-1},get_Command:function(){return 255&this.Message},get_MetaStatus:function(){return this.get_Data1()}},$Inherit(AlphaSynth.Midi.Event.MetaEvent,AlphaSynth.Midi.Event.MidiEvent),AlphaSynth.Midi.Event.MetaTextEvent=function(delta,status,metaId,text){this.Text=null,AlphaSynth.Midi.Event.MetaEvent.call(this,delta,status,metaId,0),this.Text=text},$Inherit(AlphaSynth.Midi.Event.MetaTextEvent,AlphaSynth.Midi.Event.MetaEvent),AlphaSynth.Midi.Event.MetaNumberEvent=function(delta,status,metaId,number){this.Value=0,AlphaSynth.Midi.Event.MetaEvent.call(this,delta,status,metaId,0),this.Value=number},$Inherit(AlphaSynth.Midi.Event.MetaNumberEvent,AlphaSynth.Midi.Event.MetaEvent),AlphaSynth.Midi.Event.MetaEventTypeEnum={SequenceNumber:0,TextEvent:1,CopyrightNotice:2,SequenceOrTrackName:3,InstrumentName:4,LyricText:5,MarkerText:6,CuePoint:7,PatchName:8,PortName:9,MidiChannel:32,MidiPort:33,EndOfTrack:47,Tempo:81,SmpteOffset:84,TimeSignature:88,KeySignature:89,SequencerSpecific:127},AlphaSynth.Midi.Event.MetaDataEvent=function(delta,status,metaId,data){this.Data=null,AlphaSynth.Midi.Event.MetaEvent.call(this,delta,status,metaId,0),this.Data=data},$Inherit(AlphaSynth.Midi.Event.MetaDataEvent,AlphaSynth.Midi.Event.MetaEvent),AlphaSynth.Midi.MidiTrack=function(instPrograms,drumPrograms,activeChannels,midiEvents){this.Instruments=null,this.DrumInstruments=null,this.ActiveChannels=null,this.MidiEvents=null,this.NoteOnCount=0,this.EndTime=0,this.Instruments=instPrograms,this.DrumInstruments=drumPrograms,this.ActiveChannels=activeChannels,this.MidiEvents=midiEvents,this.NoteOnCount=0,this.EndTime=0},AlphaSynth.Midi.MidiHelper=function(){},$StaticConstructor(function(){AlphaSynth.Midi.MidiHelper.MicroSecondsPerMinute=6e7,AlphaSynth.Midi.MidiHelper.MinChannel=0,AlphaSynth.Midi.MidiHelper.MaxChannel=15,AlphaSynth.Midi.MidiHelper.DrumChannel=9}),AlphaSynth.Midi.MidiFile=function(){this.Division=0,this.TrackFormat=AlphaSynth.Midi.MidiTrackFormat.SingleTrack,this.TimingStandard=AlphaSynth.Midi.MidiTimeFormat.TicksPerBeat,this.Tracks=null,this.Division=0,this.TrackFormat=AlphaSynth.Midi.MidiTrackFormat.SingleTrack,this.TimingStandard=AlphaSynth.Midi.MidiTimeFormat.TicksPerBeat},AlphaSynth.Midi.MidiFile.prototype={CombineTracks:function(){for(var finalTrack=this.MergeTracks(),absEvents=new Array(this.Tracks.length),i=0;i<this.Tracks.length;i++){absEvents[i]=new Array(this.Tracks[i].MidiEvents.length);for(var totalDeltaTime=0,j=0;j<this.Tracks[i].MidiEvents.length;j++)absEvents[i][j]=this.Tracks[i].MidiEvents[j],totalDeltaTime+=absEvents[i][j].DeltaTime,absEvents[i][j].DeltaTime=totalDeltaTime}var eventCount=0,delta=0,nextdelta=2147483647,counters=new Int32Array(absEvents.length);for(AlphaSynth.Platform.TypeUtils.ClearIntArray(counters);eventCount<finalTrack.MidiEvents.length;){for(var x=0;x<absEvents.length;x++){for(;counters[x]<absEvents[x].length&&absEvents[x][counters[x]].DeltaTime==delta;)finalTrack.MidiEvents[eventCount]=absEvents[x][counters[x]],eventCount++,counters[x]++;counters[x]<absEvents[x].length&&absEvents[x][counters[x]].DeltaTime<nextdelta&&(nextdelta=absEvents[x][counters[x]].DeltaTime)}delta=nextdelta,nextdelta=2147483647}finalTrack.EndTime=finalTrack.MidiEvents[finalTrack.MidiEvents.length-1].DeltaTime;for(var deltaDiff=0,x=0;x<finalTrack.MidiEvents.length;x++){var oldTime=finalTrack.MidiEvents[x].DeltaTime;finalTrack.MidiEvents[x].DeltaTime-=deltaDiff,deltaDiff=oldTime}this.Tracks=[finalTrack],this.TrackFormat=AlphaSynth.Midi.MidiTrackFormat.SingleTrack},MergeTracks:function(){for(var eventCount=0,notesPlayed=0,programsUsed=[],drumProgramsUsed=[],channelsUsed=[],x=0;x<this.Tracks.length;x++){eventCount+=this.Tracks[x].MidiEvents.length,notesPlayed+=this.Tracks[x].NoteOnCount;for(var i=0;i<this.Tracks[x].Instruments.length;i++){var p=this.Tracks[x].Instruments[i];-1==Array.prototype.indexOf.call(programsUsed,p)&&programsUsed.push(p)}for(var i=0;i<this.Tracks[x].DrumInstruments.length;i++){var p=this.Tracks[x].DrumInstruments[i];-1==Array.prototype.indexOf.call(drumProgramsUsed,p)&&drumProgramsUsed.push(p)}for(var i=0;i<this.Tracks[x].ActiveChannels.length;i++){var p=this.Tracks[x].ActiveChannels[i];-1==Array.prototype.indexOf.call(channelsUsed,p)&&channelsUsed.push(p)}}var track=new AlphaSynth.Midi.MidiTrack(programsUsed.slice(0),drumProgramsUsed.slice(0),channelsUsed.slice(0),new Array(eventCount));return track.NoteOnCount=notesPlayed,track},Load:function(input){if(!this.FindHead(input,500))throw $CreateException(new System.Exception.ctor$$String("Invalid midi file : MThd chunk could not be found."),new Error);this.ReadHeader(input);for(var x=0;x<this.Tracks.length;x++)this.Tracks[x]=this.ReadTrack(input)},FindHead:function(input,attempts){for(var match=0;attempts>0;){switch(input.ReadByte()){case 77:match=1;break;case 84:match=1==match?2:0;break;case 104:match=2==match?3:0;break;case 100:if(3==match)return!0;match=0}attempts--}return!1},ReadHeader:function(input){if(6!=AlphaSynth.Util.IOHelper.ReadInt32BE(input))throw $CreateException(new System.Exception.ctor$$String("Midi header is invalid."),new Error);this.TrackFormat=AlphaSynth.Util.IOHelper.ReadInt16BE(input),this.Tracks=new Array(AlphaSynth.Util.IOHelper.ReadInt16BE(input));var div=AlphaSynth.Util.IOHelper.ReadInt16BE(input);this.Division=32767&div,this.TimingStandard=(32768&div)>0?AlphaSynth.Midi.MidiTimeFormat.FramesPerSecond:AlphaSynth.Midi.MidiTimeFormat.TicksPerBeat},ReadTrack:function(input){for(var instList=[],drumList=[],channelList=[],eventList=[],noteOnCount=0,totalTime=0;"MTrk"!=AlphaSynth.Util.IOHelper.Read8BitChars(input,4);)for(var length=AlphaSynth.Util.IOHelper.ReadInt32BE(input);length>0;)length--,input.ReadByte();for(var endPosition=AlphaSynth.Util.IOHelper.ReadInt32BE(input)+input.get_Position(),prevStatus=0;input.get_Position()<endPosition;){var delta=AlphaSynth.Midi.MidiFile.ReadVariableLength(input);totalTime+=delta;var status=input.ReadByte();if(status>=128&&239>=status)prevStatus=status,eventList.push(AlphaSynth.Midi.MidiFile.ReadVoiceMessage(input,delta,status,input.ReadByte())),noteOnCount=AlphaSynth.Midi.MidiFile.TrackVoiceStats(eventList[eventList.length-1],instList,drumList,channelList,noteOnCount);
else if(status>=240&&247>=status)prevStatus=0,eventList.push(AlphaSynth.Midi.MidiFile.ReadSystemCommonMessage(input,delta,status));else if(status>=248&&255>=status)eventList.push(AlphaSynth.Midi.MidiFile.ReadRealTimeMessage(input,delta,status));else if(0==prevStatus){for(;128!=(128&status);)status=input.ReadByte();status>=128&&239>=status?(prevStatus=status,eventList.push(AlphaSynth.Midi.MidiFile.ReadVoiceMessage(input,delta,status,input.ReadByte())),noteOnCount=AlphaSynth.Midi.MidiFile.TrackVoiceStats(eventList[eventList.length-1],instList,drumList,channelList,noteOnCount)):status>=240&&247>=status?eventList.push(AlphaSynth.Midi.MidiFile.ReadSystemCommonMessage(input,delta,status)):status>=248&&255>=status&&eventList.push(AlphaSynth.Midi.MidiFile.ReadRealTimeMessage(input,delta,status))}else eventList.push(AlphaSynth.Midi.MidiFile.ReadVoiceMessage(input,delta,prevStatus,status)),noteOnCount=AlphaSynth.Midi.MidiFile.TrackVoiceStats(eventList[eventList.length-1],instList,drumList,channelList,noteOnCount)}if(input.get_Position()!=endPosition)throw $CreateException(new System.Exception.ctor$$String("The track length was invalid for the current MTrk chunk."),new Error);-1!=Array.prototype.indexOf.call(channelList,9)?-1==Array.prototype.indexOf.call(drumList,0)&&drumList.push(0):-1==Array.prototype.indexOf.call(instList,0)&&instList.push(0);var track=new AlphaSynth.Midi.MidiTrack(instList.slice(0),drumList.slice(0),channelList.slice(0),eventList.slice(0));return track.NoteOnCount=noteOnCount,track.EndTime=totalTime,track}},AlphaSynth.Midi.MidiFile.ReadMetaMessage=function(input,delta,status){var metaStatus=input.ReadByte();switch(metaStatus){case AlphaSynth.Midi.Event.MetaEventTypeEnum.SequenceNumber:var count=input.ReadByte();if(0==count)return new AlphaSynth.Midi.Event.MetaNumberEvent(delta,status,metaStatus,-1);if(2==count)return new AlphaSynth.Midi.Event.MetaNumberEvent(delta,status,metaStatus,AlphaSynth.Util.IOHelper.ReadInt16BE(input));throw $CreateException(new System.Exception.ctor$$String("Invalid sequence number event."),new Error);case AlphaSynth.Midi.Event.MetaEventTypeEnum.TextEvent:return new AlphaSynth.Midi.Event.MetaTextEvent(delta,status,metaStatus,AlphaSynth.Midi.MidiFile.ReadString(input));case AlphaSynth.Midi.Event.MetaEventTypeEnum.CopyrightNotice:return new AlphaSynth.Midi.Event.MetaTextEvent(delta,status,metaStatus,AlphaSynth.Midi.MidiFile.ReadString(input));case AlphaSynth.Midi.Event.MetaEventTypeEnum.SequenceOrTrackName:return new AlphaSynth.Midi.Event.MetaTextEvent(delta,status,metaStatus,AlphaSynth.Midi.MidiFile.ReadString(input));case AlphaSynth.Midi.Event.MetaEventTypeEnum.InstrumentName:return new AlphaSynth.Midi.Event.MetaTextEvent(delta,status,metaStatus,AlphaSynth.Midi.MidiFile.ReadString(input));case AlphaSynth.Midi.Event.MetaEventTypeEnum.LyricText:return new AlphaSynth.Midi.Event.MetaTextEvent(delta,status,metaStatus,AlphaSynth.Midi.MidiFile.ReadString(input));case AlphaSynth.Midi.Event.MetaEventTypeEnum.MarkerText:return new AlphaSynth.Midi.Event.MetaTextEvent(delta,status,metaStatus,AlphaSynth.Midi.MidiFile.ReadString(input));case AlphaSynth.Midi.Event.MetaEventTypeEnum.CuePoint:return new AlphaSynth.Midi.Event.MetaTextEvent(delta,status,metaStatus,AlphaSynth.Midi.MidiFile.ReadString(input));case AlphaSynth.Midi.Event.MetaEventTypeEnum.PatchName:return new AlphaSynth.Midi.Event.MetaTextEvent(delta,status,metaStatus,AlphaSynth.Midi.MidiFile.ReadString(input));case AlphaSynth.Midi.Event.MetaEventTypeEnum.PortName:return new AlphaSynth.Midi.Event.MetaTextEvent(delta,status,metaStatus,AlphaSynth.Midi.MidiFile.ReadString(input));case AlphaSynth.Midi.Event.MetaEventTypeEnum.MidiChannel:if(1!=input.ReadByte())throw $CreateException(new System.Exception.ctor$$String("Invalid midi channel event. Expected size of 1."),new Error);return new AlphaSynth.Midi.Event.MetaEvent(delta,status,metaStatus,input.ReadByte());case AlphaSynth.Midi.Event.MetaEventTypeEnum.MidiPort:if(1!=input.ReadByte())throw $CreateException(new System.Exception.ctor$$String("Invalid midi port event. Expected size of 1."),new Error);return new AlphaSynth.Midi.Event.MetaEvent(delta,status,metaStatus,input.ReadByte());case AlphaSynth.Midi.Event.MetaEventTypeEnum.EndOfTrack:return new AlphaSynth.Midi.Event.MetaEvent(delta,status,metaStatus,input.ReadByte());case AlphaSynth.Midi.Event.MetaEventTypeEnum.Tempo:if(3!=input.ReadByte())throw $CreateException(new System.Exception.ctor$$String("Invalid tempo event. Expected size of 3."),new Error);return new AlphaSynth.Midi.Event.MetaNumberEvent(delta,status,metaStatus,input.ReadByte()<<16|input.ReadByte()<<8|input.ReadByte());case AlphaSynth.Midi.Event.MetaEventTypeEnum.SmpteOffset:if(5!=input.ReadByte())throw $CreateException(new System.Exception.ctor$$String("Invalid smpte event. Expected size of 5."),new Error);return new AlphaSynth.Midi.Event.MetaTextEvent(delta,status,metaStatus,input.ReadByte()+":"+input.ReadByte()+":"+input.ReadByte()+":"+input.ReadByte()+":"+input.ReadByte());case AlphaSynth.Midi.Event.MetaEventTypeEnum.TimeSignature:if(4!=input.ReadByte())throw $CreateException(new System.Exception.ctor$$String("Invalid time signature event. Expected size of 4."),new Error);return new AlphaSynth.Midi.Event.MetaTextEvent(delta,status,metaStatus,input.ReadByte()+":"+input.ReadByte()+":"+input.ReadByte()+":"+input.ReadByte());case AlphaSynth.Midi.Event.MetaEventTypeEnum.KeySignature:if(2!=input.ReadByte())throw $CreateException(new System.Exception.ctor$$String("Invalid key signature event. Expected size of 2."),new Error);return new AlphaSynth.Midi.Event.MetaTextEvent(delta,status,metaStatus,input.ReadByte()+":"+input.ReadByte());case AlphaSynth.Midi.Event.MetaEventTypeEnum.SequencerSpecific:var length=AlphaSynth.Midi.MidiFile.ReadVariableLength(input),data=AlphaSynth.Util.IOHelper.ReadByteArray(input,length);return new AlphaSynth.Midi.Event.MetaDataEvent(delta,status,metaStatus,data)}throw $CreateException(new System.Exception.ctor$$String("Not a valid meta message Status: "+status+" Meta: "+metaStatus),new Error)},AlphaSynth.Midi.MidiFile.ReadRealTimeMessage=function(input,delta,status){switch(status){case AlphaSynth.Midi.Event.RealTimeTypeEnum.MidiClock:return new AlphaSynth.Midi.Event.RealTimeEvent(delta,status,0,0);case AlphaSynth.Midi.Event.RealTimeTypeEnum.MidiTick:return new AlphaSynth.Midi.Event.RealTimeEvent(delta,status,0,0);case AlphaSynth.Midi.Event.RealTimeTypeEnum.MidiStart:return new AlphaSynth.Midi.Event.RealTimeEvent(delta,status,0,0);case AlphaSynth.Midi.Event.RealTimeTypeEnum.MidiContinue:return new AlphaSynth.Midi.Event.RealTimeEvent(delta,status,0,0);case AlphaSynth.Midi.Event.RealTimeTypeEnum.MidiStop:return new AlphaSynth.Midi.Event.RealTimeEvent(delta,status,0,0);case AlphaSynth.Midi.Event.RealTimeTypeEnum.ActiveSense:return new AlphaSynth.Midi.Event.RealTimeEvent(delta,status,0,0);case AlphaSynth.Midi.Event.RealTimeTypeEnum.Reset:return AlphaSynth.Midi.MidiFile.ReadMetaMessage(input,delta,status);default:throw $CreateException(new System.Exception.ctor$$String("The real time message was invalid or unsupported : "+status),new Error)}},AlphaSynth.Midi.MidiFile.ReadSystemCommonMessage=function(input,delta,status){switch(status){case AlphaSynth.Midi.Event.SystemCommonTypeEnum.SystemExclusive2:case AlphaSynth.Midi.Event.SystemCommonTypeEnum.SystemExclusive:var maker=AlphaSynth.Util.IOHelper.ReadInt16BE(input);if(0==maker)maker=AlphaSynth.Util.IOHelper.ReadInt16BE(input);else if(247==maker)return null;for(var data=[],b=input.ReadByte();247!=b;)data.push(b),b=input.ReadByte();return new AlphaSynth.Midi.Event.SystemExclusiveEvent(delta,status,maker,data.slice(0));case AlphaSynth.Midi.Event.SystemCommonTypeEnum.MtcQuarterFrame:return new AlphaSynth.Midi.Event.SystemCommonEvent(delta,status,input.ReadByte(),0);case AlphaSynth.Midi.Event.SystemCommonTypeEnum.SongPosition:return new AlphaSynth.Midi.Event.SystemCommonEvent(delta,status,input.ReadByte(),input.ReadByte());case AlphaSynth.Midi.Event.SystemCommonTypeEnum.SongSelect:return new AlphaSynth.Midi.Event.SystemCommonEvent(delta,status,input.ReadByte(),0);case AlphaSynth.Midi.Event.SystemCommonTypeEnum.TuneRequest:return new AlphaSynth.Midi.Event.SystemCommonEvent(delta,status,0,0);default:throw $CreateException(new System.Exception.ctor$$String("The system common message was invalid or unsupported : "+status),new Error)}},AlphaSynth.Midi.MidiFile.ReadVoiceMessage=function(input,delta,status,data1){switch(240&status){case AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteOff:return new AlphaSynth.Midi.Event.MidiEvent(delta,status,data1,input.ReadByte());case AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteOn:var velocity=input.ReadByte();return 0==velocity&&(status=15&status|128),new AlphaSynth.Midi.Event.MidiEvent(delta,status,data1,velocity);case AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteAftertouch:return new AlphaSynth.Midi.Event.MidiEvent(delta,status,data1,input.ReadByte());case AlphaSynth.Midi.Event.MidiEventTypeEnum.Controller:return new AlphaSynth.Midi.Event.MidiEvent(delta,status,data1,input.ReadByte());case AlphaSynth.Midi.Event.MidiEventTypeEnum.ProgramChange:return new AlphaSynth.Midi.Event.MidiEvent(delta,status,data1,0);case AlphaSynth.Midi.Event.MidiEventTypeEnum.ChannelAftertouch:return new AlphaSynth.Midi.Event.MidiEvent(delta,status,data1,0);case AlphaSynth.Midi.Event.MidiEventTypeEnum.PitchBend:return new AlphaSynth.Midi.Event.MidiEvent(delta,status,data1,input.ReadByte());default:throw $CreateException(new System.Exception.ctor$$String("The status provided was not that of a voice message."),new Error)}},AlphaSynth.Midi.MidiFile.TrackVoiceStats=function(midiEvent,instList,drumList,channelList,noteOnCount){if(midiEvent.get_Command()==AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteOn){var chan=midiEvent.get_Channel();-1==Array.prototype.indexOf.call(channelList,chan)&&channelList.push(chan),noteOnCount++}else if(midiEvent.get_Command()==AlphaSynth.Midi.Event.MidiEventTypeEnum.ProgramChange){var chan=midiEvent.get_Channel(),prog=midiEvent.get_Data1();9==chan?-1==Array.prototype.indexOf.call(drumList,prog)&&drumList.push(prog):-1==Array.prototype.indexOf.call(instList,prog)&&instList.push(prog)}return noteOnCount},AlphaSynth.Midi.MidiFile.ReadVariableLength=function(input){var next,value=0;do next=input.ReadByte(),value<<=7,value|=127&next;while(128==(128&next));return value},AlphaSynth.Midi.MidiFile.ReadString=function(input){var length=AlphaSynth.Midi.MidiFile.ReadVariableLength(input);return AlphaSynth.Util.IOHelper.Read8BitChars(input,length)},AlphaSynth.Midi.MidiTrackFormat={SingleTrack:0,MultiTrack:1,MultiSong:2},AlphaSynth.Midi.MidiTimeFormat={TicksPerBeat:0,FramesPerSecond:1},AlphaSynth.Player.SynthPlayerState={Stopped:0,Playing:1,Paused:2},AlphaSynth.Player.SynthPlayer=function(){this._tickPosition=0,this._timePosition=0,this.PositionChanged=null,this.PlayerStateChanged=null,this.Finished=null,this.SoundFontLoad=null,this.SoundFontLoaded=null,this.SoundFontLoadFailed=null,this.MidiLoad=null,this.MidiLoaded=null,this.MidiLoadFailed=null,this.ReadyForPlay=null,this.Output=null,this.Synth=null,this.Sequencer=null,this.State=AlphaSynth.Player.SynthPlayerState.Stopped,this.IsSoundFontLoaded=!1,this.IsMidiLoaded=!1,AlphaSynth.Util.Logger.Debug("Initializing player"),this.State=AlphaSynth.Player.SynthPlayerState.Stopped,this.OnPlayerStateChanged(new AlphaSynth.Player.PlayerStateChangedEventArgs(this.State)),AlphaSynth.Util.Logger.Debug("Creating synthesizer"),this.Synth=new AlphaSynth.Synthesis.Synthesizer(44100,2,441,3,100),this.Sequencer=new AlphaSynth.Sequencer.MidiFileSequencer(this.Synth),AlphaSynth.Util.Logger.Debug("Opening output"),this.Output=AlphaSynth.Platform.Platform.CreateOutput(this.Synth),this.Sequencer.AddFinishedListener($CreateDelegate(this.Output,this.Output.SequencerFinished)),this.Output.add_Finished($CreateAnonymousDelegate(this,function(){this.Stop(),AlphaSynth.Util.Logger.Debug("Finished playback"),this.OnFinished()})),this.Output.add_SampleRequest($CreateAnonymousDelegate(this,function(){this.Sequencer.FillMidiEventQueue(),this.Synth.Synthesize(),this.Output.AddSamples(this.Synth.SampleBuffer)})),this.Output.add_PositionChanged($CreateAnonymousDelegate(this,function(pos){this.FirePositionChanged(pos)})),this.Output.Open()},AlphaSynth.Player.SynthPlayer.prototype={get_TickPosition:function(){return this._tickPosition},set_TickPosition:function(value){this.set_TimePosition(this.Sequencer.TicksToMillis(value))},get_MasterVolume:function(){return this.Synth.get_MasterVolume()},set_MasterVolume:function(value){this.Synth.set_MasterVolume(value)},get_TimePosition:function(){return this._timePosition},set_TimePosition:function(value){AlphaSynth.Util.Logger.Debug("Seeking to position "+value+"ms"),this.State==AlphaSynth.Player.SynthPlayerState.Playing&&(this.Sequencer.Pause(),this.Output.Pause()),this.Sequencer.Seek(value),this.Output.Seek(value),this.State==AlphaSynth.Player.SynthPlayerState.Playing&&(this.Sequencer.Play(),this.Output.Play())},get_IsReady:function(){return this.IsSoundFontLoaded&&this.IsMidiLoaded},Play:function(){this.State!=AlphaSynth.Player.SynthPlayerState.Playing&&this.get_IsReady()&&(AlphaSynth.Util.Logger.Debug("Starting playback"),this.Sequencer.Play(),this.Output.Play(),this.State=AlphaSynth.Player.SynthPlayerState.Playing,this.OnPlayerStateChanged(new AlphaSynth.Player.PlayerStateChangedEventArgs(this.State)))},Pause:function(){this.State==AlphaSynth.Player.SynthPlayerState.Playing&&this.get_IsReady()&&(AlphaSynth.Util.Logger.Debug("Pausing playback"),this.Sequencer.Pause(),this.Output.Pause(),this.State=AlphaSynth.Player.SynthPlayerState.Paused,this.OnPlayerStateChanged(new AlphaSynth.Player.PlayerStateChangedEventArgs(this.State)))},PlayPause:function(){this.State!=AlphaSynth.Player.SynthPlayerState.Playing&&this.get_IsReady()?this.Play():this.Pause()},Stop:function(){this.State!=AlphaSynth.Player.SynthPlayerState.Stopped&&this.get_IsReady()&&(AlphaSynth.Util.Logger.Debug("Stopping playback"),this.Sequencer.Stop(),this.Synth.Stop(),this.Output.Stop(),this.State=AlphaSynth.Player.SynthPlayerState.Stopped,this.OnPlayerStateChanged(new AlphaSynth.Player.PlayerStateChangedEventArgs(this.State)),this.FirePositionChanged(0))},LoadSoundFontUrl:function(url){if(this.State==AlphaSynth.Player.SynthPlayerState.Stopped){AlphaSynth.Util.Logger.Info("Start loading soundfont from url "+url);var loader=new AlphaSynth.Util.UrlLoader;loader.Url=url,loader.Method="GET",loader.Complete=$CreateDelegate(this,this.LoadSoundFontBytes),loader.Progress=$CreateDelegate(this,this.OnLoaderSoundFontLoad);try{loader.Load()}catch(e){AlphaSynth.Util.Logger.Error("Could not load soundfont from url: "+e)}}},LoadSoundFontBytes:function(data){if(this.State==AlphaSynth.Player.SynthPlayerState.Stopped){var input=AlphaSynth.IO.ByteBuffer.FromBuffer(data);try{AlphaSynth.Util.Logger.Info("Loading soundfont from bytes");var bank=new AlphaSynth.Bank.PatchBank;bank.LoadSf2(input),this.Synth.LoadBank(bank),this.IsSoundFontLoaded=!0,this.OnSoundFontLoaded(),AlphaSynth.Util.Logger.Info("soundFont successfully loaded"),this.get_IsReady()&&this.OnReadyForPlay()}catch(e){AlphaSynth.Util.Logger.Error("Could not load soundfont from bytes "+e),this.IsSoundFontLoaded=!1,this.Synth.UnloadBank(),this.OnSoundFontLoadFailed()}}},LoadMidiUrl:function(url){if(this.State==AlphaSynth.Player.SynthPlayerState.Stopped){AlphaSynth.Util.Logger.Info("Start loading midi from url "+url);var loader=new AlphaSynth.Util.UrlLoader;loader.Url=url,loader.Method="GET",loader.Complete=$CreateDelegate(this,this.LoadMidiBytes),loader.Progress=$CreateDelegate(this,this.OnLoaderMidiLoad);try{loader.Load()}catch(e){AlphaSynth.Util.Logger.Error("Could not load midi from url: "+e)}}},LoadMidiBytes:function(data){if(this.State==AlphaSynth.Player.SynthPlayerState.Stopped){var input=AlphaSynth.IO.ByteBuffer.FromBuffer(data);try{AlphaSynth.Util.Logger.Info("Loading midi from bytes");var midi=new AlphaSynth.Midi.MidiFile;midi.Load(input),this.Sequencer.LoadMidi(midi),this.IsMidiLoaded=!0,this.OnMidiLoaded(),AlphaSynth.Util.Logger.Info("Midi successfully loaded"),this.get_IsReady()&&this.OnReadyForPlay(),this.FirePositionChanged(0)}catch(e){AlphaSynth.Util.Logger.Error("Could not load midi from bytes "+e),this.IsMidiLoaded=!1,this.Sequencer.UnloadMidi(),this.OnMidiLoadFailed()}}},OnLoaderSoundFontLoad:function(loaded,total){AlphaSynth.Util.Logger.Debug("Soundfont downloading: "+loaded+"/"+total+" bytes"),this.OnSoundFontLoad(new AlphaSynth.Player.ProgressEventArgs(loaded,total))},OnLoaderMidiLoad:function(loaded,total){AlphaSynth.Util.Logger.Debug("Midi downloading: "+loaded+"/"+total+" bytes"),this.OnMidiLoad(new AlphaSynth.Player.ProgressEventArgs(loaded,total))},FirePositionChanged:function(pos){var endTime=1e3*(this.Sequencer.EndTime/this.Synth.SampleRate|0),currentTime=pos,endTick=this.Sequencer.MillisToTicks(endTime),currentTick=this.Sequencer.MillisToTicks(currentTime);this._tickPosition=currentTick,this._timePosition=currentTime,AlphaSynth.Util.Logger.Debug("Position changed: (time: "+currentTime+"/"+endTime+", tick: "+currentTick+"/"+endTime+")"),this.OnPositionChanged(new AlphaSynth.Player.PositionChangedEventArgs(currentTime,endTime,currentTick,endTick))},add_PositionChanged:function(value){this.PositionChanged=$CombineDelegates(this.PositionChanged,value)},remove_PositionChanged:function(value){this.PositionChanged=$RemoveDelegate(this.PositionChanged,value)},OnPositionChanged:function(e){var handler=this.PositionChanged;null!=handler&&handler(this,e)},add_PlayerStateChanged:function(value){this.PlayerStateChanged=$CombineDelegates(this.PlayerStateChanged,value)},remove_PlayerStateChanged:function(value){this.PlayerStateChanged=$RemoveDelegate(this.PlayerStateChanged,value)},OnPlayerStateChanged:function(e){var handler=this.PlayerStateChanged;null!=handler&&handler(this,e)},add_Finished:function(value){this.Finished=$CombineDelegates(this.Finished,value)},remove_Finished:function(value){this.Finished=$RemoveDelegate(this.Finished,value)},OnFinished:function(){var handler=this.Finished;null!=handler&&handler(this,AlphaSynth.Player.EmptyEventArgs.Instance)},add_SoundFontLoad:function(value){this.SoundFontLoad=$CombineDelegates(this.SoundFontLoad,value)},remove_SoundFontLoad:function(value){this.SoundFontLoad=$RemoveDelegate(this.SoundFontLoad,value)},OnSoundFontLoad:function(e){var handler=this.SoundFontLoad;null!=handler&&handler(this,e)},add_SoundFontLoaded:function(value){this.SoundFontLoaded=$CombineDelegates(this.SoundFontLoaded,value)},remove_SoundFontLoaded:function(value){this.SoundFontLoaded=$RemoveDelegate(this.SoundFontLoaded,value)},OnSoundFontLoaded:function(){var handler=this.SoundFontLoaded;null!=handler&&handler(this,AlphaSynth.Player.EmptyEventArgs.Instance)},add_SoundFontLoadFailed:function(value){this.SoundFontLoadFailed=$CombineDelegates(this.SoundFontLoadFailed,value)},remove_SoundFontLoadFailed:function(value){this.SoundFontLoadFailed=$RemoveDelegate(this.SoundFontLoadFailed,value)},OnSoundFontLoadFailed:function(){var handler=this.SoundFontLoadFailed;null!=handler&&handler(this,AlphaSynth.Player.EmptyEventArgs.Instance)},add_MidiLoad:function(value){this.MidiLoad=$CombineDelegates(this.MidiLoad,value)},remove_MidiLoad:function(value){this.MidiLoad=$RemoveDelegate(this.MidiLoad,value)},OnMidiLoad:function(e){var handler=this.MidiLoad;null!=handler&&handler(this,e)},add_MidiLoaded:function(value){this.MidiLoaded=$CombineDelegates(this.MidiLoaded,value)},remove_MidiLoaded:function(value){this.MidiLoaded=$RemoveDelegate(this.MidiLoaded,value)},OnMidiLoaded:function(){var handler=this.MidiLoaded;null!=handler&&handler(this,AlphaSynth.Player.EmptyEventArgs.Instance)},add_MidiLoadFailed:function(value){this.MidiLoadFailed=$CombineDelegates(this.MidiLoadFailed,value)},remove_MidiLoadFailed:function(value){this.MidiLoadFailed=$RemoveDelegate(this.MidiLoadFailed,value)},OnMidiLoadFailed:function(){var handler=this.MidiLoadFailed;null!=handler&&handler(this,AlphaSynth.Player.EmptyEventArgs.Instance)},add_ReadyForPlay:function(value){this.ReadyForPlay=$CombineDelegates(this.ReadyForPlay,value)},remove_ReadyForPlay:function(value){this.ReadyForPlay=$RemoveDelegate(this.ReadyForPlay,value)},OnReadyForPlay:function(){var handler=this.ReadyForPlay;null!=handler&&handler(this,AlphaSynth.Player.EmptyEventArgs.Instance)}},AlphaSynth.Player.EmptyEventArgs=function(){},$StaticConstructor(function(){AlphaSynth.Player.EmptyEventArgs.Instance=new AlphaSynth.Player.EmptyEventArgs}),AlphaSynth.Player.ProgressEventArgs=function(loaded,total){this.Loaded=0,this.Total=0,this.Loaded=loaded,this.Total=total},AlphaSynth.Player.PlayerStateChangedEventArgs=function(state){this.State=AlphaSynth.Player.SynthPlayerState.Stopped,this.State=state},AlphaSynth.Player.PositionChangedEventArgs=function(currentTime,endTime,currentTick,endTick){this.CurrentTime=0,this.EndTime=0,this.CurrentTick=0,this.EndTick=0,this.CurrentTime=currentTime,this.EndTime=endTime,this.CurrentTick=currentTick,this.EndTick=endTick},AlphaSynth.Sequencer=AlphaSynth.Sequencer||{},AlphaSynth.Sequencer.MidiFileSequencer=function(synth){this._synthData=null,this._tempoChanges=null,this._finished=null,this._blockList=null,this._playbackRate=0,this._eventIndex=0,this._division=0,this.Synth=null,this.IsPlaying=!1,this.CurrentTempo=0,this.CurrentTime=0,this.EndTime=0,this.Synth=synth,this._eventIndex=0,this._division=0,this._playbackRate=1,this.IsPlaying=!1,this._blockList=new Array(16),this._finished=[],synth.AddMidiMessageProcessed($CreateDelegate(this,this.MidiEventProcessed))},AlphaSynth.Sequencer.MidiFileSequencer.prototype={get_IsMidiLoaded:function(){return null!=this._synthData},get_PlaySpeed:function(){return this._playbackRate},set_PlaySpeed:function(value){this._playbackRate=AlphaSynth.Synthesis.SynthHelper.ClampF(value,.125,8)},AddFinishedListener:function(listener){this._finished.push(listener)},FireFinished:function(){for(var i=0;i<this._finished.length;i++){var l=this._finished[i];null!=l&&l()}},LoadMidi:function(midiFile){return this.IsPlaying?!1:(this.LoadMidiFile(midiFile),!0)},UnloadMidi:function(){return this.IsPlaying?!1:(this._synthData=null,!0)},Play:function(){this.IsPlaying||null==this._synthData||(this.IsPlaying=!0)},Pause:function(){this.IsPlaying=!1},Stop:function(){this.IsPlaying=!1,this.CurrentTime=0,this._eventIndex=0},IsChannelMuted:function(channel){return this._blockList[channel]},MuteAllChannels:function(){for(var x=0;x<this._blockList.length;x++)this._blockList[x]=!0},UnMuteAllChannels:function(){for(var x=0;x<this._blockList.length;x++)this._blockList[x]=!1},SetMute:function(channel,muteValue){this._blockList[channel]=muteValue},Seek:function(milliseconds){var targetSampleTime=this.Synth.SampleRate*(milliseconds/1e3)|0;targetSampleTime>this.CurrentTime?this.SilentProcess(targetSampleTime-this.CurrentTime):targetSampleTime<this.CurrentTime&&(this.CurrentTime=0,this._eventIndex=0,this.Synth.NoteOffAll(!0),this.Synth.ResetPrograms(),this.Synth.ResetSynthControls(),this.SilentProcess(targetSampleTime))},FillMidiEventQueue:function(){if(this.IsPlaying&&0==this.Synth.MidiEventQueue.Length){if(this.CurrentTime>=this.EndTime)return this.CurrentTime=0,this._eventIndex=0,this.IsPlaying=!1,this.Synth.NoteOffAll(!0),this.Synth.ResetPrograms(),this.Synth.ResetSynthControls(),void this.FireFinished();for(var newMSize=this.Synth.MicroBufferSize*this._playbackRate|0,x=(this.CurrentTime+newMSize*this.Synth.MicroBufferCount,0);x<this.Synth.MicroBufferCount;x++)for(this.CurrentTime+=newMSize;this._eventIndex<this._synthData.length&&this._synthData[this._eventIndex].Delta<this.CurrentTime;)this._synthData[this._eventIndex].Event.get_Command()==AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteOn&&this._blockList[this._synthData[this._eventIndex].Event.get_Channel()]||(this.Synth.MidiEventQueue.AddFirst(this._synthData[this._eventIndex]),this.Synth.MidiEventCounts[x]++),this._eventIndex++}},LoadMidiFile:function(midiFile){this._tempoChanges=[];var bpm=120;(midiFile.Tracks.length>1||0==midiFile.Tracks[0].EndTime)&&midiFile.CombineTracks(),this._synthData=new Array(midiFile.Tracks[0].MidiEvents.length),this._division=midiFile.Division,this._eventIndex=0,this.CurrentTime=0,this.CurrentTempo=0|bpm;for(var absDelta=0,absTick=0,absTime=0,x=0;x<midiFile.Tracks[0].MidiEvents.length;x++){var mEvent=midiFile.Tracks[0].MidiEvents[x];if(this._synthData[x]=new AlphaSynth.Synthesis.SynthEvent(mEvent),absTick+=mEvent.DeltaTime,absTime+=mEvent.DeltaTime*(6e4/(bpm*midiFile.Division)),absDelta+=this.Synth.SampleRate*mEvent.DeltaTime*(60/(bpm*midiFile.Division)),this._synthData[x].Delta=0|absDelta,this.IsTempoMessage(mEvent.get_Command(),mEvent.get_Data1())){var meta=mEvent;bpm=6e7/meta.Value|0,this._tempoChanges.push(new AlphaSynth.Sequencer.MidiFileSequencerTempoChange(bpm,absTick,0|absTime))}}this.EndTime=this._synthData[this._synthData.length-1].Delta},MidiEventProcessed:function(midiEvent){if(this.IsTempoMessage(midiEvent.get_Command(),midiEvent.get_Data1())){var meta=midiEvent;this.CurrentTempo=6e7/meta.Value|0}},IsTempoMessage:function(command,data1){return command==AlphaSynth.Midi.Event.MidiEventTypeEnum.Meta&&81==data1},MillisToTicks:function(time){for(var ticks=0,bpm=120,lastChange=0,i=0;i<this._tempoChanges.length;i++){var c=this._tempoChanges[i];if(time<c.Time)break;ticks=c.Ticks,bpm=c.Bpm,lastChange=c.Time}return time-=lastChange,ticks+=time/(6e4/(bpm*this._division))|0},TicksToMillis:function(ticks){for(var time=0,bpm=120,lastChange=0,i=0;i<this._tempoChanges.length;i++){var c=this._tempoChanges[i];if(ticks<c.Ticks)break;time=c.Time,bpm=c.Bpm,lastChange=c.Ticks}return ticks-=lastChange,time+=ticks*(6e4/(bpm*this._division))|0},SilentProcess:function(amount){if(!(0>=amount)){for(;this._eventIndex<this._synthData.length&&this._synthData[this._eventIndex].Delta<this.CurrentTime+amount;){if(this._synthData[this._eventIndex].Event.get_Command()!=AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteOn){var m=this._synthData[this._eventIndex];this.Synth.ProcessMidiMessage(m.Event)}this._eventIndex++}this.CurrentTime+=amount}}},AlphaSynth.Sequencer.MidiFileSequencerTempoChange=function(bpm,ticks,time){this.Bpm=0,this.Ticks=0,this.Time=0,this.Bpm=bpm,this.Ticks=ticks,this.Time=time},AlphaSynth.Sf2=AlphaSynth.Sf2||{},AlphaSynth.Sf2.Chunks=AlphaSynth.Sf2.Chunks||{},AlphaSynth.Sf2.Chunks.Chunk=function(id,size){this.Id=null,this.Size=0,this.Id=id,this.Size=size},AlphaSynth.Sf2.Chunks.ZoneChunk=function(id,size,input){this._zoneData=null,AlphaSynth.Sf2.Chunks.Chunk.call(this,id,size),this._zoneData=new Array(size/4|0);for(var lastZone=null,x=0;x<this._zoneData.length;x++){var z=new AlphaSynth.Sf2.Chunks.RawZoneData;z.GeneratorIndex=AlphaSynth.Util.IOHelper.ReadUInt16LE(input),z.ModulatorIndex=AlphaSynth.Util.IOHelper.ReadUInt16LE(input),null!=lastZone&&(lastZone.GeneratorCount=z.GeneratorIndex-lastZone.GeneratorIndex&65535,lastZone.ModulatorCount=z.ModulatorIndex-lastZone.ModulatorIndex&65535),this._zoneData[x]=z,lastZone=z}},AlphaSynth.Sf2.Chunks.ZoneChunk.prototype={ToZones:function(modulators,generators){for(var zones=new Array(this._zoneData.length-1),x=0;x<zones.length;x++){var rawZone=this._zoneData[x],zone=new AlphaSynth.Sf2.Zone;zone.Generators=new Array(rawZone.GeneratorCount),AlphaSynth.Platform.Std.ArrayCopy(generators,rawZone.GeneratorIndex,zone.Generators,0,rawZone.GeneratorCount),zone.Modulators=new Array(rawZone.ModulatorCount),AlphaSynth.Platform.Std.ArrayCopy(modulators,rawZone.ModulatorIndex,zone.Modulators,0,rawZone.ModulatorCount),zones[x]=zone}return zones}},$Inherit(AlphaSynth.Sf2.Chunks.ZoneChunk,AlphaSynth.Sf2.Chunks.Chunk),AlphaSynth.Sf2.Chunks.RawZoneData=function(){this.GeneratorIndex=0,this.ModulatorIndex=0,this.GeneratorCount=0,this.ModulatorCount=0},AlphaSynth.Sf2.Chunks.SampleHeaderChunk=function(id,size,input){if(this.SampleHeaders=null,AlphaSynth.Sf2.Chunks.Chunk.call(this,id,size),size%46!=0)throw $CreateException(new System.Exception.ctor$$String("Invalid SoundFont. The sample header chunk was invalid."),new Error);this.SampleHeaders=new Array(size/46-1|0);for(var x=0;x<this.SampleHeaders.length;x++)this.SampleHeaders[x]=new AlphaSynth.Sf2.SampleHeader(input);new AlphaSynth.Sf2.SampleHeader(input)},$Inherit(AlphaSynth.Sf2.Chunks.SampleHeaderChunk,AlphaSynth.Sf2.Chunks.Chunk),AlphaSynth.Sf2.Chunks.PresetHeaderChunk=function(id,size,input){if(this._rawPresets=null,AlphaSynth.Sf2.Chunks.Chunk.call(this,id,size),size%38!=0)throw $CreateException(new System.Exception.ctor$$String("Invalid SoundFont. The preset chunk was invalid."),new Error);this._rawPresets=new Array(size/38|0);for(var lastPreset=null,x=0;x<this._rawPresets.length;x++){var p=new AlphaSynth.Sf2.Chunks.RawPreset;p.Name=AlphaSynth.Util.IOHelper.Read8BitStringLength(input,20),p.PatchNumber=AlphaSynth.Util.IOHelper.ReadUInt16LE(input),p.BankNumber=AlphaSynth.Util.IOHelper.ReadUInt16LE(input),p.StartPresetZoneIndex=AlphaSynth.Util.IOHelper.ReadUInt16LE(input),p.Library=AlphaSynth.Util.IOHelper.ReadInt32LE(input),p.Genre=AlphaSynth.Util.IOHelper.ReadInt32LE(input),p.Morphology=AlphaSynth.Util.IOHelper.ReadInt32LE(input),null!=lastPreset&&(lastPreset.EndPresetZoneIndex=p.StartPresetZoneIndex-1&65535),this._rawPresets[x]=p,lastPreset=p}},AlphaSynth.Sf2.Chunks.PresetHeaderChunk.prototype={ToPresets:function(presetZones){for(var presets=new Array(this._rawPresets.length-1),x=0;x<presets.length;x++){var rawPreset=this._rawPresets[x],p=new AlphaSynth.Sf2.PresetHeader;p.BankNumber=rawPreset.BankNumber,p.Genre=rawPreset.Genre,p.Library=rawPreset.Library,p.Morphology=rawPreset.Morphology,p.Name=rawPreset.Name,p.PatchNumber=rawPreset.PatchNumber,p.Zones=new Array(rawPreset.EndPresetZoneIndex-rawPreset.StartPresetZoneIndex+1),AlphaSynth.Platform.Std.ArrayCopy(presetZones,rawPreset.StartPresetZoneIndex,p.Zones,0,p.Zones.length),presets[x]=p}return presets}},$Inherit(AlphaSynth.Sf2.Chunks.PresetHeaderChunk,AlphaSynth.Sf2.Chunks.Chunk),AlphaSynth.Sf2.Chunks.RawPreset=function(){this.Name=null,this.PatchNumber=0,this.BankNumber=0,this.StartPresetZoneIndex=0,this.EndPresetZoneIndex=0,this.Library=0,this.Genre=0,this.Morphology=0},AlphaSynth.Sf2.Chunks.ModulatorChunk=function(id,size,input){if(this.Modulators=null,AlphaSynth.Sf2.Chunks.Chunk.call(this,id,size),size%10!=0)throw $CreateException(new System.Exception.ctor$$String("Invalid SoundFont. The presetzone chunk was invalid."),new Error);this.Modulators=new Array((size/10|0)-1);for(var x=0;x<this.Modulators.length;x++)this.Modulators[x]=new AlphaSynth.Sf2.Modulator(input);new AlphaSynth.Sf2.Modulator(input)},$Inherit(AlphaSynth.Sf2.Chunks.ModulatorChunk,AlphaSynth.Sf2.Chunks.Chunk),AlphaSynth.Sf2.Chunks.InstrumentChunk=function(id,size,input){if(this._rawInstruments=null,AlphaSynth.Sf2.Chunks.Chunk.call(this,id,size),size%22!=0)throw $CreateException(new System.Exception.ctor$$String("Invalid SoundFont. The preset chunk was invalid."),new Error);this._rawInstruments=new Array(size/22|0);for(var lastInstrument=null,x=0;x<this._rawInstruments.length;x++){var i=new AlphaSynth.Sf2.Chunks.RawInstrument;i.Name=AlphaSynth.Util.IOHelper.Read8BitStringLength(input,20),i.StartInstrumentZoneIndex=AlphaSynth.Util.IOHelper.ReadUInt16LE(input),null!=lastInstrument&&(lastInstrument.EndInstrumentZoneIndex=i.StartInstrumentZoneIndex-1&65535),this._rawInstruments[x]=i,lastInstrument=i}},AlphaSynth.Sf2.Chunks.InstrumentChunk.prototype={ToInstruments:function(zones){for(var inst=new Array(this._rawInstruments.length-1),x=0;x<inst.length;x++){var rawInst=this._rawInstruments[x],i=new AlphaSynth.Sf2.Instrument;i.Name=rawInst.Name,i.Zones=new Array(rawInst.EndInstrumentZoneIndex-rawInst.StartInstrumentZoneIndex+1),AlphaSynth.Platform.Std.ArrayCopy(zones,rawInst.StartInstrumentZoneIndex,i.Zones,0,i.Zones.length),inst[x]=i}return inst}},$Inherit(AlphaSynth.Sf2.Chunks.InstrumentChunk,AlphaSynth.Sf2.Chunks.Chunk),AlphaSynth.Sf2.Chunks.RawInstrument=function(){this.Name=null,this.StartInstrumentZoneIndex=0,this.EndInstrumentZoneIndex=0
},AlphaSynth.Sf2.Chunks.GeneratorChunk=function(id,size,input){if(this.Generators=null,AlphaSynth.Sf2.Chunks.Chunk.call(this,id,size),size%4!=0)throw $CreateException(new System.Exception.ctor$$String("Invalid SoundFont. The presetzone chunk was invalid"),new Error);this.Generators=new Array(size/4-1|0);for(var x=0;x<this.Generators.length;x++)this.Generators[x]=new AlphaSynth.Sf2.Generator(input);new AlphaSynth.Sf2.Generator(input)},$Inherit(AlphaSynth.Sf2.Chunks.GeneratorChunk,AlphaSynth.Sf2.Chunks.Chunk),AlphaSynth.Sf2.Modulator=function(input){this._sourceModulationData=null,this._destinationGenerator=0,this._amount=0,this._sourceModulationAmount=null,this._sourceTransform=0,this._sourceModulationData=new AlphaSynth.Sf2.ModulatorType(input),this._destinationGenerator=AlphaSynth.Util.IOHelper.ReadUInt16LE(input),this._amount=AlphaSynth.Util.IOHelper.ReadInt16LE(input),this._sourceModulationAmount=new AlphaSynth.Sf2.ModulatorType(input),this._sourceTransform=AlphaSynth.Util.IOHelper.ReadUInt16LE(input)},AlphaSynth.Sf2.Zone=function(){this.Modulators=null,this.Generators=null},AlphaSynth.Sf2.SoundFontSampleData=function(input){this.BitsPerSample=0,this.SampleData=null;var id=AlphaSynth.Util.IOHelper.Read8BitChars(input,4),size=AlphaSynth.Util.IOHelper.ReadInt32LE(input);if("list"!=id.toLowerCase())throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. Could not find sdta LIST chunk."),new Error);var readTo=input.get_Position()+size;if(id=AlphaSynth.Util.IOHelper.Read8BitChars(input,4),"sdta"!=id.toLowerCase())throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. The LIST chunk is not of type sdta."),new Error);this.BitsPerSample=0;for(var rawSampleData=null;input.get_Position()<readTo;){var subID=AlphaSynth.Util.IOHelper.Read8BitChars(input,4);switch(size=AlphaSynth.Util.IOHelper.ReadInt32LE(input),subID.toLowerCase()){case"smpl":this.BitsPerSample=16,rawSampleData=AlphaSynth.Util.IOHelper.ReadByteArray(input,size);break;case"sm24":if(null==rawSampleData||size!=Math.ceil(this.SampleData.length/2))input.Skip(size);else{this.BitsPerSample=24;for(var x=0;x<this.SampleData.length;x++){var b=new Uint8Array(3);b[0]=input.ReadByte(),b[1]=rawSampleData[2*x],b[2]=rawSampleData[2*x+1]}}size%2==1&&0!=input.ReadByte()&&input.set_Position(input.get_Position()-1);break;default:throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. Unknown chunk id: "+subID+"."),new Error)}}if(16==this.BitsPerSample)this.SampleData=rawSampleData;else if(24!=this.BitsPerSample)throw $CreateException(new System.Exception.ctor$$String("Only 16 and 24 bit samples are supported."),new Error)},AlphaSynth.Sf2.SoundFontPresets=function(input){this.SampleHeaders=null,this.PresetHeaders=null,this.Instruments=null;var id=AlphaSynth.Util.IOHelper.Read8BitChars(input,4),size=AlphaSynth.Util.IOHelper.ReadInt32LE(input);if("list"!=id.toLowerCase())throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. Could not find pdta LIST chunk."),new Error);var readTo=input.get_Position()+size;if(id=AlphaSynth.Util.IOHelper.Read8BitChars(input,4),"pdta"!=id.toLowerCase())throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. The LIST chunk is not of type pdta."),new Error);for(var presetModulators=null,presetGenerators=null,instrumentModulators=null,instrumentGenerators=null,pbag=null,ibag=null,phdr=null,inst=null;input.get_Position()<readTo;)switch(id=AlphaSynth.Util.IOHelper.Read8BitChars(input,4),size=AlphaSynth.Util.IOHelper.ReadInt32LE(input),id.toLowerCase()){case"phdr":phdr=new AlphaSynth.Sf2.Chunks.PresetHeaderChunk(id,size,input);break;case"pbag":pbag=new AlphaSynth.Sf2.Chunks.ZoneChunk(id,size,input);break;case"pmod":presetModulators=new AlphaSynth.Sf2.Chunks.ModulatorChunk(id,size,input).Modulators;break;case"pgen":presetGenerators=new AlphaSynth.Sf2.Chunks.GeneratorChunk(id,size,input).Generators;break;case"inst":inst=new AlphaSynth.Sf2.Chunks.InstrumentChunk(id,size,input);break;case"ibag":ibag=new AlphaSynth.Sf2.Chunks.ZoneChunk(id,size,input);break;case"imod":instrumentModulators=new AlphaSynth.Sf2.Chunks.ModulatorChunk(id,size,input).Modulators;break;case"igen":instrumentGenerators=new AlphaSynth.Sf2.Chunks.GeneratorChunk(id,size,input).Generators;break;case"shdr":this.SampleHeaders=new AlphaSynth.Sf2.Chunks.SampleHeaderChunk(id,size,input).SampleHeaders;break;default:throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. Unrecognized sub chunk: "+id),new Error)}var pZones=pbag.ToZones(presetModulators,presetGenerators);this.PresetHeaders=phdr.ToPresets(pZones);var iZones=ibag.ToZones(instrumentModulators,instrumentGenerators);this.Instruments=inst.ToInstruments(iZones)},AlphaSynth.Sf2.SoundFontInfo=function(input){this.RomVersionMajor=0,this.RomVersionMinor=0,this.SfVersionMajor=0,this.SfVersionMinor=0,this.SoundEngine=null,this.BankName=null,this.DataRom=null,this.CreationDate=null,this.Author=null,this.TargetProduct=null,this.Copyright=null,this.Comments=null,this.Tools=null,this.Tools="",this.Comments="",this.Copyright="",this.TargetProduct="",this.Author="",this.DataRom="",this.CreationDate="",this.BankName="",this.SoundEngine="";var id=AlphaSynth.Util.IOHelper.Read8BitChars(input,4),size=AlphaSynth.Util.IOHelper.ReadInt32LE(input);if("list"!=id.toLowerCase())throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. Could not find INFO LIST chunk."),new Error);var readTo=input.get_Position()+size;if(id=AlphaSynth.Util.IOHelper.Read8BitChars(input,4),"info"!=id.toLowerCase())throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. The LIST chunk is not of type INFO."),new Error);for(;input.get_Position()<readTo;)switch(id=AlphaSynth.Util.IOHelper.Read8BitChars(input,4),size=AlphaSynth.Util.IOHelper.ReadInt32LE(input),id.toLowerCase()){case"ifil":this.SfVersionMajor=AlphaSynth.Util.IOHelper.ReadInt16LE(input),this.SfVersionMinor=AlphaSynth.Util.IOHelper.ReadInt16LE(input);break;case"isng":this.SoundEngine=AlphaSynth.Util.IOHelper.Read8BitStringLength(input,size);break;case"inam":this.BankName=AlphaSynth.Util.IOHelper.Read8BitStringLength(input,size);break;case"irom":this.DataRom=AlphaSynth.Util.IOHelper.Read8BitStringLength(input,size);break;case"iver":this.RomVersionMajor=AlphaSynth.Util.IOHelper.ReadInt16LE(input),this.RomVersionMinor=AlphaSynth.Util.IOHelper.ReadInt16LE(input);break;case"icrd":this.CreationDate=AlphaSynth.Util.IOHelper.Read8BitStringLength(input,size);break;case"ieng":this.Author=AlphaSynth.Util.IOHelper.Read8BitStringLength(input,size);break;case"iprd":this.TargetProduct=AlphaSynth.Util.IOHelper.Read8BitStringLength(input,size);break;case"icop":this.Copyright=AlphaSynth.Util.IOHelper.Read8BitStringLength(input,size);break;case"icmt":this.Comments=AlphaSynth.Util.IOHelper.Read8BitStringLength(input,size);break;case"isft":this.Tools=AlphaSynth.Util.IOHelper.Read8BitStringLength(input,size);break;default:throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. The Chunk: "+id+" was not expected."),new Error)}},AlphaSynth.Sf2.SoundFont=function(){this.Info=null,this.SampleData=null,this.Presets=null},AlphaSynth.Sf2.SoundFont.prototype={Load:function(input){{var id=AlphaSynth.Util.IOHelper.Read8BitChars(input,4);AlphaSynth.Util.IOHelper.ReadInt32LE(input)}if("riff"!=id.toLowerCase())throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. Could not find RIFF header."),new Error);if(id=AlphaSynth.Util.IOHelper.Read8BitChars(input,4),"sfbk"!=id.toLowerCase())throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. Riff type is invalid."),new Error);AlphaSynth.Util.Logger.Debug("Reading info chunk"),this.Info=new AlphaSynth.Sf2.SoundFontInfo(input),AlphaSynth.Util.Logger.Debug("Reading sampledata chunk"),this.SampleData=new AlphaSynth.Sf2.SoundFontSampleData(input),AlphaSynth.Util.Logger.Debug("Reading preset chunk"),this.Presets=new AlphaSynth.Sf2.SoundFontPresets(input)}},AlphaSynth.Sf2.Sf2Region=function(){this.Generators=null,this.Generators=new Int16Array(61)},AlphaSynth.Sf2.Sf2Region.prototype={ApplyDefaultValues:function(){this.Generators[0]=0,this.Generators[1]=0,this.Generators[2]=0,this.Generators[3]=0,this.Generators[4]=0,this.Generators[5]=0,this.Generators[6]=0,this.Generators[7]=0,this.Generators[8]=13500,this.Generators[9]=0,this.Generators[10]=0,this.Generators[11]=0,this.Generators[12]=0,this.Generators[13]=0,this.Generators[15]=0,this.Generators[16]=0,this.Generators[17]=0,this.Generators[21]=-12e3,this.Generators[22]=0,this.Generators[23]=-12e3,this.Generators[24]=0,this.Generators[25]=-12e3,this.Generators[26]=-12e3,this.Generators[27]=-12e3,this.Generators[28]=-12e3,this.Generators[29]=0,this.Generators[30]=-12e3,this.Generators[31]=0,this.Generators[32]=0,this.Generators[33]=-12e3,this.Generators[34]=-12e3,this.Generators[35]=-12e3,this.Generators[36]=-12e3,this.Generators[37]=0,this.Generators[38]=-12e3,this.Generators[39]=0,this.Generators[40]=0,this.Generators[43]=32512,this.Generators[44]=32512,this.Generators[45]=0,this.Generators[46]=-1,this.Generators[47]=-1,this.Generators[48]=0,this.Generators[50]=0,this.Generators[51]=0,this.Generators[52]=0,this.Generators[54]=0,this.Generators[56]=100,this.Generators[57]=0,this.Generators[58]=-1}},AlphaSynth.Sf2.SampleHeader=function(input){this.Name=null,this.Start=0,this.End=0,this.StartLoop=0,this.EndLoop=0,this.SampleRate=0,this.RootKey=0,this.Tune=0,this.SampleLink=0,this.SoundFontSampleLink=AlphaSynth.Sf2.SFSampleLink.MonoSample,this.Name=AlphaSynth.Util.IOHelper.Read8BitStringLength(input,20),this.Start=AlphaSynth.Util.IOHelper.ReadInt32LE(input),this.End=AlphaSynth.Util.IOHelper.ReadInt32LE(input),this.StartLoop=AlphaSynth.Util.IOHelper.ReadInt32LE(input),this.EndLoop=AlphaSynth.Util.IOHelper.ReadInt32LE(input),this.SampleRate=AlphaSynth.Util.IOHelper.ReadInt32LE(input),this.RootKey=input.ReadByte(),this.Tune=AlphaSynth.Platform.TypeUtils.ToInt16(input.ReadByte()),this.SampleLink=AlphaSynth.Util.IOHelper.ReadUInt16LE(input),this.SoundFontSampleLink=AlphaSynth.Util.IOHelper.ReadUInt16LE(input)},AlphaSynth.Sf2.PresetHeader=function(){this.Name=null,this.PatchNumber=0,this.BankNumber=0,this.Library=0,this.Genre=0,this.Morphology=0,this.Zones=null},AlphaSynth.Sf2.ModulatorType=function(input){this._controllerSource=0,this.Polarity=AlphaSynth.Sf2.PolarityEnum.Unipolar,this.Direction=AlphaSynth.Sf2.DirectionEnum.MinToMax,this.SourceType=0,this.IsMidiContinuousController=!1;var raw=AlphaSynth.Util.IOHelper.ReadUInt16LE(input);this.Polarity=512==(512&raw)?AlphaSynth.Sf2.PolarityEnum.Bipolar:AlphaSynth.Sf2.PolarityEnum.Unipolar,this.Direction=256==(256&raw)?AlphaSynth.Sf2.DirectionEnum.MaxToMin:AlphaSynth.Sf2.DirectionEnum.MinToMax,this.IsMidiContinuousController=128==(128&raw),this.SourceType=(64512&raw)>>10,this._controllerSource=127&raw&65535},AlphaSynth.Sf2.Instrument=function(){this.Name=null,this.Zones=null},AlphaSynth.Sf2.Generator=function(input){this._rawAmount=0,this.GeneratorType=AlphaSynth.Sf2.GeneratorEnum.StartAddressOffset,this.GeneratorType=AlphaSynth.Util.IOHelper.ReadUInt16LE(input),this._rawAmount=AlphaSynth.Util.IOHelper.ReadUInt16LE(input)},AlphaSynth.Sf2.Generator.prototype={get_AmountInt16:function(){return AlphaSynth.Platform.TypeUtils.ToInt16(this._rawAmount)},set_AmountInt16:function(value){this._rawAmount=65535&value},get_LowByteAmount:function(){return 255&this._rawAmount&255},set_LowByteAmount:function(value){this._rawAmount=(65280&this._rawAmount)+(255&value)&65535},get_HighByteAmount:function(){return(65280&this._rawAmount)>>8&255},set_HighByteAmount:function(value){this._rawAmount=(255&this._rawAmount)+((255&value)<<8)&65535}},AlphaSynth.Sf2.SFSampleLink={MonoSample:1,RightSample:2,LeftSample:4,LinkedSample:8,RomMonoSample:32769,RomRightSample:32770,RomLeftSample:32772,RomLinkedSample:32776},AlphaSynth.Sf2.GeneratorEnum={StartAddressOffset:0,EndAddressOffset:1,StartLoopAddressOffset:2,EndLoopAddressOffset:3,StartAddressCoarseOffset:4,ModulationLFOToPitch:5,VibratoLFOToPitch:6,ModulationEnvelopeToPitch:7,InitialFilterCutoffFrequency:8,InitialFilterQ:9,ModulationLFOToFilterCutoffFrequency:10,ModulationEnvelopeToFilterCutoffFrequency:11,EndAddressCoarseOffset:12,ModulationLFOToVolume:13,Unused1:14,ChorusEffectsSend:15,ReverbEffectsSend:16,Pan:17,Unused2:18,Unused3:19,Unused4:20,DelayModulationLFO:21,FrequencyModulationLFO:22,DelayVibratoLFO:23,FrequencyVibratoLFO:24,DelayModulationEnvelope:25,AttackModulationEnvelope:26,HoldModulationEnvelope:27,DecayModulationEnvelope:28,SustainModulationEnvelope:29,ReleaseModulationEnvelope:30,KeyNumberToModulationEnvelopeHold:31,KeyNumberToModulationEnvelopeDecay:32,DelayVolumeEnvelope:33,AttackVolumeEnvelope:34,HoldVolumeEnvelope:35,DecayVolumeEnvelope:36,SustainVolumeEnvelope:37,ReleaseVolumeEnvelope:38,KeyNumberToVolumeEnvelopeHold:39,KeyNumberToVolumeEnvelopeDecay:40,Instrument:41,Reserved1:42,KeyRange:43,VelocityRange:44,StartLoopAddressCoarseOffset:45,KeyNumber:46,Velocity:47,InitialAttenuation:48,Reserved2:49,EndLoopAddressCoarseOffset:50,CoarseTune:51,FineTune:52,SampleID:53,SampleModes:54,Reserved3:55,ScaleTuning:56,ExclusiveClass:57,OverridingRootKey:58,Unused5:59,UnusedEnd:60},AlphaSynth.Sf2.TransformEnum={Linear:0,AbsoluteValue:2},AlphaSynth.Sf2.ControllerSourceEnum={NoController:0,NoteOnVelocity:2,NoteOnKeyNumber:3,PolyPressure:10,ChannelPressure:13,PitchWheel:14,PitchWheelSensitivity:16,Link:127},AlphaSynth.Sf2.DirectionEnum={MinToMax:0,MaxToMin:1},AlphaSynth.Sf2.PolarityEnum={Unipolar:0,Bipolar:1},AlphaSynth.Sf2.SourceTypeEnum={Linear:0,Concave:1,Convex:2,Switch:3},AlphaSynth.Synthesis=AlphaSynth.Synthesis||{},AlphaSynth.Synthesis.CCValue=function(coarse,fine){this._coarseValue=0,this._fineValue=0,this._combined=0,this._coarseValue=coarse,this._fineValue=fine,this._combined=0,this.UpdateCombined()},AlphaSynth.Synthesis.CCValue=function(combined){this._coarseValue=0,this._fineValue=0,this._combined=0,this._coarseValue=0,this._fineValue=0,this._combined=combined,this.UpdateCoarseFinePair()},AlphaSynth.Synthesis.CCValue.prototype={get_Coarse:function(){return this._coarseValue},set_Coarse:function(value){this._coarseValue=value,this.UpdateCombined()},get_Fine:function(){return this._fineValue},set_Fine:function(value){this._fineValue=value,this.UpdateCombined()},get_Combined:function(){return this._combined},set_Combined:function(value){this._combined=value,this.UpdateCoarseFinePair()},UpdateCombined:function(){this._combined=AlphaSynth.Platform.TypeUtils.IsLittleEndian?this._coarseValue<<7|this._fineValue|0:this._fineValue<<7|this._coarseValue|0},UpdateCoarseFinePair:function(){AlphaSynth.Platform.TypeUtils.IsLittleEndian?(this._coarseValue=this._combined>>7,this._fineValue=127&this._combined):(this._fineValue=this._combined>>7,this._coarseValue=127&this._combined)}},AlphaSynth.Synthesis.SynthParameters=function(synth){this.Program=0,this.BankSelect=0,this.ChannelAfterTouch=0,this.Pan=null,this.Volume=null,this.Expression=null,this.ModRange=null,this.PitchBend=null,this.PitchBendRangeCoarse=0,this.PitchBendRangeFine=0,this.MasterCoarseTune=0,this.MasterFineTune=null,this.HoldPedal=!1,this.LegatoPedal=!1,this.Rpn=null,this.Synth=null,this.CurrentVolume=0,this.CurrentPitch=0,this.CurrentMod=0,this.CurrentPan=null,this.Synth=synth,this.Pan=new AlphaSynth.Synthesis.CCValue(0),this.Volume=new AlphaSynth.Synthesis.CCValue(0),this.Expression=new AlphaSynth.Synthesis.CCValue(0),this.ModRange=new AlphaSynth.Synthesis.CCValue(0),this.PitchBend=new AlphaSynth.Synthesis.CCValue(0),this.MasterFineTune=new AlphaSynth.Synthesis.CCValue(0),this.Rpn=new AlphaSynth.Synthesis.CCValue(0),this.CurrentPan=new AlphaSynth.Bank.Components.PanComponent,this.ResetControllers()},AlphaSynth.Synthesis.SynthParameters.prototype={ResetControllers:function(){this.Program=0,this.BankSelect=0,this.ChannelAfterTouch=0,this.Pan.set_Combined(8192),this.Volume.set_Fine(0),this.Volume.set_Coarse(100),this.Expression.set_Combined(16383),this.ModRange.set_Combined(0),this.PitchBend.set_Combined(8192),this.PitchBendRangeCoarse=2,this.PitchBendRangeFine=0,this.MasterCoarseTune=0,this.MasterFineTune.set_Combined(8192),this.HoldPedal=!1,this.LegatoPedal=!1,this.Rpn.set_Combined(16383),this.UpdateCurrentPan(),this.UpdateCurrentPitch(),this.UpdateCurrentVolume()},UpdateCurrentVolume:function(){this.CurrentVolume=this.Expression.get_Combined()/16383,this.CurrentVolume*=this.CurrentVolume},UpdateCurrentPitch:function(){this.CurrentPitch=(this.PitchBend.get_Combined()-8192)/8192*(100*this.PitchBendRangeCoarse+this.PitchBendRangeFine)|0},UpdateCurrentMod:function(){this.CurrentMod=100*(this.ModRange.get_Combined()/16383)|0},UpdateCurrentPan:function(){var value=1.5707963267949*(this.Pan.get_Combined()/16383);this.CurrentPan.Left=Math.cos(value),this.CurrentPan.Right=Math.sin(value)}},AlphaSynth.Synthesis.VoiceParameters=function(){this.mix1=0,this.mix2=0,this.Channel=0,this.Note=0,this.Velocity=0,this.NoteOffPending=!1,this.State=AlphaSynth.Synthesis.VoiceStateEnum.Stopped,this.PitchOffset=0,this.VolOffset=0,this.BlockBuffer=null,this.PData=null,this.SynthParams=null,this.GeneratorParams=null,this.Envelopes=null,this.Filters=null,this.Lfos=null,this.BlockBuffer=new Float32Array(64),this.PData=new Array(4),this.GeneratorParams=new Array(4),this.Envelopes=new Array(4),this.Filters=new Array(4),this.Lfos=new Array(4);for(var x=0;4>x;x++)this.GeneratorParams[x]=new AlphaSynth.Bank.Components.Generators.GeneratorParameters,this.Envelopes[x]=new AlphaSynth.Bank.Components.Envelope,this.Filters[x]=new AlphaSynth.Bank.Components.Filter,this.Lfos[x]=new AlphaSynth.Bank.Components.Lfo},AlphaSynth.Synthesis.VoiceParameters.prototype={get_CombinedVolume:function(){return this.mix1+this.mix2},Reset:function(){this.NoteOffPending=!1,this.PitchOffset=0,this.VolOffset=0;for(var i=0;i<this.PData.length;i++)this.PData[i]=new DataView(new ArrayBuffer(8));this.mix1=0,this.mix2=0},MixMonoToMonoInterp:function(startIndex,volume){for(var inc=(volume-this.mix1)/64,i=0;i<this.BlockBuffer.length;i++)this.mix1+=inc,this.SynthParams.Synth.SampleBuffer[startIndex+i]+=this.BlockBuffer[i]*this.mix1;this.mix1=volume},MixMonoToStereoInterp:function(startIndex,leftVol,rightVol){for(var inc_l=(leftVol-this.mix1)/64,inc_r=(rightVol-this.mix2)/64,i=0;i<this.BlockBuffer.length;i++)this.mix1+=inc_l,this.mix2+=inc_r,this.SynthParams.Synth.SampleBuffer[startIndex]+=this.BlockBuffer[i]*this.mix1,this.SynthParams.Synth.SampleBuffer[startIndex+1]+=this.BlockBuffer[i]*this.mix2,startIndex+=2;this.mix1=leftVol,this.mix2=rightVol},MixStereoToStereoInterp:function(startIndex,leftVol,rightVol){for(var inc_l=(leftVol-this.mix1)/64,inc_r=(rightVol-this.mix2)/64,i=0;i<this.BlockBuffer.length;i++)this.mix1+=inc_l,this.mix2+=inc_r,this.SynthParams.Synth.SampleBuffer[startIndex+i]+=this.BlockBuffer[i]*this.mix1,i++,this.SynthParams.Synth.SampleBuffer[startIndex+i]+=this.BlockBuffer[i]*this.mix2;this.mix1=leftVol,this.mix2=rightVol}},AlphaSynth.Synthesis.VoiceStealingMethod={Oldest:0,Quietest:1},AlphaSynth.Synthesis.VoiceNode=function(){this.Value=null,this.Next=null},AlphaSynth.Synthesis.VoiceManager=function(voiceCount){this._voicePool=null,this._vNodes=null,this.StealingMethod=AlphaSynth.Synthesis.VoiceStealingMethod.Oldest,this.Polyphony=0,this.FreeVoices=null,this.ActiveVoices=null,this.Registry=null,this.StealingMethod=AlphaSynth.Synthesis.VoiceStealingMethod.Quietest,this.Polyphony=voiceCount,this._voicePool=new Array(voiceCount),this._vNodes=new AlphaSynth.Ds.LinkedList,this.FreeVoices=new AlphaSynth.Ds.LinkedList,this.ActiveVoices=new AlphaSynth.Ds.LinkedList;for(var i=0;voiceCount>i;i++){var v=new AlphaSynth.Synthesis.Voice;this._voicePool[i]=v,this._vNodes.AddLast(new AlphaSynth.Synthesis.VoiceNode),this.FreeVoices.AddLast(v)}this.Registry=new Array(16);for(var i=0;i<this.Registry.length;i++)this.Registry[i]=new Array(128)},AlphaSynth.Synthesis.VoiceManager.prototype={GetFreeVoice:function(){if(this.FreeVoices.Length>0){var voice=this.FreeVoices.First.Value;return this.FreeVoices.RemoveFirst(),voice}switch(this.StealingMethod){case AlphaSynth.Synthesis.VoiceStealingMethod.Oldest:return this.StealOldest();case AlphaSynth.Synthesis.VoiceStealingMethod.Quietest:return this.StealQuietestVoice();default:return null}},AddToRegistry:function(voice){var node=this._vNodes.RemoveLast();node.Value=voice,node.Next=this.Registry[voice.VoiceParams.Channel][voice.VoiceParams.Note],this.Registry[voice.VoiceParams.Channel][voice.VoiceParams.Note]=node},RemoveFromRegistry:function(channel,note){for(var node=this.Registry[channel][note];null!=node;)this._vNodes.AddLast(node),node=node.Next;this.Registry[channel][note]=null},RemoveVoiceFromRegistry:function(voice){var node=this.Registry[voice.VoiceParams.Channel][voice.VoiceParams.Note];if(null!=node)if(node.Value==voice)this.Registry[voice.VoiceParams.Channel][voice.VoiceParams.Note]=node.Next,this._vNodes.AddLast(node);else{var node2=node;for(node=node.Next;null!=node;){if(node.Value==voice)return node2.Next=node.Next,void this._vNodes.AddLast(node);node2=node,node=node.Next}}},ClearRegistry:function(){for(var node=this.ActiveVoices.First;null!=node;){for(var vnode=this.Registry[node.Value.VoiceParams.Channel][node.Value.VoiceParams.Note];null!=vnode;)this._vNodes.AddLast(vnode),vnode=vnode.Next;this.Registry[node.Value.VoiceParams.Channel][node.Value.VoiceParams.Note]=null,node=node.get_Next()}},UnloadPatches:function(){for(var $i8=0,$t8=this._voicePool,$l8=$t8.length,v=$t8[$i8];$l8>$i8;$i8++,v=$t8[$i8]){v.Configure(0,0,0,null,null);for(var current=this._vNodes.First;null!=current;)current.Value.Value=null,current=current.get_Next()}},StealOldest:function(){for(var node=this.ActiveVoices.First;null!=node&&node.Value.VoiceParams.State==AlphaSynth.Synthesis.VoiceStateEnum.Playing;)node=node.get_Next();return null==node&&(node=this.ActiveVoices.First),this.RemoveVoiceFromRegistry(node.Value),this.ActiveVoices.Remove(node),node.Value.VoiceParams.State=AlphaSynth.Synthesis.VoiceStateEnum.Stopped,node.Value},StealQuietestVoice:function(){for(var voiceVolume=1e3,quietest=null,node=this.ActiveVoices.First;null!=node;){if(node.Value.VoiceParams.State!=AlphaSynth.Synthesis.VoiceStateEnum.Playing){var volume=node.Value.VoiceParams.get_CombinedVolume();voiceVolume>volume&&(quietest=node,voiceVolume=volume)}node=node.get_Next()}return null==quietest&&(quietest=this.ActiveVoices.First),this.RemoveVoiceFromRegistry(quietest.Value),this.ActiveVoices.Remove(quietest),quietest.Value.VoiceParams.State=AlphaSynth.Synthesis.VoiceStateEnum.Stopped,quietest.Value}},AlphaSynth.Synthesis.VoiceStateEnum={Stopped:0,Stopping:1,Playing:2},AlphaSynth.Synthesis.Voice=function(){this.Patch=null,this.VoiceParams=null,this.VoiceParams=new AlphaSynth.Synthesis.VoiceParameters},AlphaSynth.Synthesis.Voice.prototype={Start:function(){this.VoiceParams.State==AlphaSynth.Synthesis.VoiceStateEnum.Stopped&&this.Patch.Start(this.VoiceParams)&&(this.VoiceParams.State=AlphaSynth.Synthesis.VoiceStateEnum.Playing)},Stop:function(){this.VoiceParams.State==AlphaSynth.Synthesis.VoiceStateEnum.Playing&&(this.VoiceParams.State=AlphaSynth.Synthesis.VoiceStateEnum.Stopping,this.Patch.Stop(this.VoiceParams))},StopImmediately:function(){this.VoiceParams.State=AlphaSynth.Synthesis.VoiceStateEnum.Stopped},Process:function(startIndex,endIndex){this.VoiceParams.State!=AlphaSynth.Synthesis.VoiceStateEnum.Stopped&&this.Patch.Process(this.VoiceParams,startIndex,endIndex)},Configure:function(channel,note,velocity,patch,synthParams){this.VoiceParams.Reset(),this.VoiceParams.Channel=channel,this.VoiceParams.Note=note,this.VoiceParams.Velocity=velocity,this.VoiceParams.SynthParams=synthParams,this.Patch=patch}},AlphaSynth.Synthesis.SynthHelper=function(){},AlphaSynth.Synthesis.SynthHelper.ClampD=function(value,min,max){return min>=value?min:value>=max?max:value},AlphaSynth.Synthesis.SynthHelper.ClampF=function(value,min,max){return min>=value?min:value>=max?max:value},AlphaSynth.Synthesis.SynthHelper.ClampI=function(value,min,max){return min>=value?min:value>=max?max:value},AlphaSynth.Synthesis.SynthHelper.ClampS=function(value,min,max){return min>=value?min:value>=max?max:value},AlphaSynth.Synthesis.SynthHelper.NearestPowerOfTwo=function(value){return Math.pow(2,Math.Round(Math.Log(value,2)))},AlphaSynth.Synthesis.SynthHelper.SamplesFromTime=function(sampleRate,seconds){return sampleRate*seconds},AlphaSynth.Synthesis.SynthHelper.TimeFromSamples=function(sampleRate,samples){return samples/sampleRate},AlphaSynth.Synthesis.SynthHelper.DBtoLinear=function(dBvalue){return Math.pow(10,dBvalue/20)},AlphaSynth.Synthesis.SynthHelper.LineartoDB=function(linearvalue){return 20*(Math.log(linearvalue)/Math.LN10)},AlphaSynth.Synthesis.SynthHelper.FrequencyToKey=function(frequency,rootkey){return 12*Math.Log(frequency/440,2)+rootkey},AlphaSynth.Synthesis.SynthHelper.KeyToFrequency=function(key,rootkey){return 440*Math.pow(2,(key-rootkey)/12)},AlphaSynth.Synthesis.SynthHelper.SemitoneToPitch=function(key){return-127>key?key=-127:key>127&&(key=127),AlphaSynth.Util.Tables.SemitoneTable(127+key)},AlphaSynth.Synthesis.SynthHelper.CentsToPitch=function(cents){var key=cents/100|0;return cents-=100*key,-127>key?key=-127:key>127&&(key=127),AlphaSynth.Util.Tables.SemitoneTable(127+key)*AlphaSynth.Util.Tables.CentTable(100+cents)},AlphaSynth.Synthesis.SynthEvent=function(e){this.Event=null,this.Delta=0,this.Event=e},AlphaSynth.Synthesis.Synthesizer=function(sampleRate,audioChannels,bufferSize,bufferCount,polyphony){this._voiceManager=null,this._synthChannels=null,this._masterVolume=0,this._synthGain=0,this._midiMessageProcessed=null,this._layerList=null,this.MidiEventQueue=null,this.MidiEventCounts=null,this.SampleBuffer=null,this.AudioChannels=0,this.LittleEndian=!1,this.SoundBank=null,this.SampleRate=0,this.MicroBufferSize=0,this.MicroBufferCount=0;var MinSampleRate=8e3,MaxSampleRate=96e3;if(MinSampleRate>sampleRate||sampleRate>MaxSampleRate)throw $CreateException(new System.Exception.ctor$$String("Invalid paramater: (sampleRate) Valid ranges are "+MinSampleRate+" to "+MaxSampleRate),new Error);if(1>audioChannels||audioChannels>2)throw $CreateException(new System.Exception.ctor$$String("Invalid paramater: (audioChannels) Valid ranges are 1 to 2"),new Error);this._midiMessageProcessed=[],this._synthGain=.35,this._masterVolume=1,this.SampleRate=sampleRate,this.AudioChannels=audioChannels,this.MicroBufferSize=AlphaSynth.Synthesis.SynthHelper.ClampI(bufferSize,.001*sampleRate|0,.05*sampleRate|0),this.MicroBufferSize=64*Math.ceil(this.MicroBufferSize/64)|0,this.MicroBufferCount=Math.max(1,bufferCount),this.SampleBuffer=new Float32Array(this.MicroBufferSize*this.MicroBufferCount*audioChannels),this.LittleEndian=!0,this._synthChannels=new Array(16);for(var x=0;x<this._synthChannels.length;x++)this._synthChannels[x]=new AlphaSynth.Synthesis.SynthParameters(this);this._voiceManager=new AlphaSynth.Synthesis.VoiceManager(AlphaSynth.Synthesis.SynthHelper.ClampI(polyphony,5,250)),this.MidiEventQueue=new AlphaSynth.Ds.LinkedList,this.MidiEventCounts=new Int32Array(this.MicroBufferCount),this._layerList=new Array(15),this._midiMessageProcessed=[],this.ResetSynthControls()},AlphaSynth.Synthesis.Synthesizer.prototype={get_MasterVolume:function(){return this._masterVolume},set_MasterVolume:function(value){this._masterVolume=AlphaSynth.Synthesis.SynthHelper.ClampF(value,0,10)},get_MixGain:function(){return this._synthGain},set_MixGain:function(value){this._synthGain=AlphaSynth.Synthesis.SynthHelper.ClampF(value,.5,1)},get_VoiceStealMethod:function(){return this._voiceManager.StealingMethod},set_VoiceStealMethod:function(value){this._voiceManager.StealingMethod=value},get_ActiveVoices:function(){return this._voiceManager.ActiveVoices.Length},get_FreeVoices:function(){return this._voiceManager.FreeVoices.Length},get_RawBufferSize:function(){return 2*this.SampleBuffer.length},get_WorkingBufferSize:function(){return this.SampleBuffer.length},get_Polyphony:function(){return this._voiceManager.Polyphony},LoadBank:function(bank){this.UnloadBank(),this.SoundBank=bank},UnloadBank:function(){null!=this.SoundBank&&(this.NoteOffAll(!0),this._voiceManager.UnloadPatches(),this.SoundBank=null)},Stop:function(){this.ResetSynthControls(),this.ResetPrograms(),this.NoteOffAll(!0)},ResetSynthControls:function(){for(var x=0;x<this._synthChannels.length;x++)this._synthChannels[x].ResetControllers();this._synthChannels[9].BankSelect=128,this.ReleaseAllHoldPedals()},ResetPrograms:function(){for(var x=0;x<this._synthChannels.length;x++)this._synthChannels[x].Program=0},GetProgramName:function(channel){var p=this.GetProgram(channel);return null==p?"null":p.Name},GetProgram:function(channel){if(null!=this.SoundBank){var sChannel=this._synthChannels[channel],inst=this.SoundBank.GetPatchByNumber(sChannel.BankSelect,sChannel.Program);if(null!=inst)return inst}return null},SetAudioChannelCount:function(channels){channels=AlphaSynth.Synthesis.SynthHelper.ClampI(channels,1,2),this.AudioChannels!=channels&&(this.AudioChannels=channels,this.SampleBuffer=new Float32Array(this.MicroBufferSize*this.MicroBufferCount*this.AudioChannels))},Synthesize:function(){this.SampleBuffer=new Float32Array(this.SampleBuffer.length),this.FillWorkingBuffer()},GetChannelVolume:function(channel){return this._synthChannels[channel].Volume.get_Combined()/16383},GetChannelExpression:function(channel){return this._synthChannels[channel].Expression.get_Combined()/16383},GetChannelPan:function(channel){return(this._synthChannels[channel].Pan.get_Combined()-8192)/8192},GetChannelPitchBend:function(channel){return(this._synthChannels[channel].PitchBend.get_Combined()-8192)/8192},GetChannelHoldPedalStatus:function(channel){return this._synthChannels[channel].HoldPedal},FillWorkingBuffer:function(){for(var sampleIndex=0,x=0;x<this.MicroBufferCount;x++){if(this.MidiEventQueue.Length>0)for(var i=0;i<this.MidiEventCounts[x];i++){var m=this.MidiEventQueue.RemoveLast();this.ProcessMidiMessage(m.Event)}for(var node=this._voiceManager.ActiveVoices.First;null!=node;)if(node.Value.Process(sampleIndex,sampleIndex+this.MicroBufferSize*this.AudioChannels),node.Value.VoiceParams.State==AlphaSynth.Synthesis.VoiceStateEnum.Stopped){var delnode=node;node=node.get_Next(),this._voiceManager.RemoveVoiceFromRegistry(delnode.Value),this._voiceManager.ActiveVoices.Remove(delnode),this._voiceManager.FreeVoices.AddFirst(delnode.Value)}else node=node.get_Next();sampleIndex+=this.MicroBufferSize*this.AudioChannels}AlphaSynth.Platform.TypeUtils.ClearIntArray(this.MidiEventCounts)},NoteOn:function(channel,note,velocity){var sChan=this._synthChannels[channel],inst=this.SoundBank.GetPatchByNumber(sChan.BankSelect,sChan.Program);if(null!=inst){var layerCount;if(layerCount=inst.FindPatches(channel,note,velocity,this._layerList),null!=this._voiceManager.Registry[channel][note]){for(var node=this._voiceManager.Registry[channel][note];null!=node;)node.Value.Stop(),node=node.Next;this._voiceManager.RemoveFromRegistry(channel,note)}for(var x=0;layerCount>x;x++){for(var notseen=!0,i=x-1;i>=0;i--)if(this._layerList[x].ExclusiveGroupTarget==this._layerList[i].ExclusiveGroupTarget){notseen=!1;break}if(0!=this._layerList[x].ExclusiveGroupTarget&&notseen)for(var node=this._voiceManager.ActiveVoices.First;null!=node;)this._layerList[x].ExclusiveGroupTarget==node.Value.Patch.ExclusiveGroup&&(node.Value.Stop(),this._voiceManager.RemoveVoiceFromRegistry(node.Value)),node=node.get_Next()}for(var x=0;layerCount>x;x++){var voice=this._voiceManager.GetFreeVoice();if(null==voice)break;voice.Configure(channel,note,velocity,this._layerList[x],this._synthChannels[channel]),this._voiceManager.AddToRegistry(voice),this._voiceManager.ActiveVoices.AddLast(voice),voice.Start()}for(var x=0;layerCount>x;x++)this._layerList[x]=null}},NoteOff:function(channel,note){if(this._synthChannels[channel].HoldPedal)for(var node=this._voiceManager.Registry[channel][note];null!=node;)node.Value.VoiceParams.NoteOffPending=!0,node=node.Next;
else{for(var node=this._voiceManager.Registry[channel][note];null!=node;)node.Value.Stop(),node=node.Next;this._voiceManager.RemoveFromRegistry(channel,note)}},NoteOffAll:function(immediate){var node=this._voiceManager.ActiveVoices.First;if(immediate)for(this._voiceManager.ClearRegistry();null!=node;){node.Value.StopImmediately();var delnode=node;node=node.get_Next(),this._voiceManager.ActiveVoices.Remove(delnode),this._voiceManager.FreeVoices.AddFirst(delnode.Value)}else for(;null!=node;){var voiceParams=node.Value.VoiceParams;voiceParams.State==AlphaSynth.Synthesis.VoiceStateEnum.Playing&&(this._synthChannels[voiceParams.Channel].HoldPedal?voiceParams.NoteOffPending=!0:(node.Value.Stop(),this._voiceManager.RemoveVoiceFromRegistry(node.Value))),node=node.get_Next()}},NoteOffAllChannel:function(channel,immediate){for(var node=this._voiceManager.ActiveVoices.First;null!=node;)if(channel==node.Value.VoiceParams.Channel)if(immediate){node.Value.StopImmediately();var delnode=node;node=node.get_Next(),this._voiceManager.ActiveVoices.Remove(delnode),this._voiceManager.FreeVoices.AddFirst(delnode.Value)}else this._synthChannels[channel].HoldPedal?node.Value.VoiceParams.NoteOffPending=!0:node.Value.Stop(),node=node.get_Next()},ProcessMidiMessage:function(e){var command=e.get_Command(),channel=e.get_Channel(),data1=e.get_Data1(),data2=e.get_Data2();switch(command){case AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteOff:this.NoteOff(channel,data1);break;case AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteOn:0==data2?this.NoteOff(channel,data1):this.NoteOn(channel,data1,data2);break;case AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteAftertouch:break;case AlphaSynth.Midi.Event.MidiEventTypeEnum.Controller:switch(data1){case AlphaSynth.Midi.Event.ControllerTypeEnum.BankSelectCoarse:9==channel&&(data2+=128),this._synthChannels[channel].BankSelect=this.SoundBank.IsBankLoaded(data2)?data2:9==channel?128:0;break;case AlphaSynth.Midi.Event.ControllerTypeEnum.ModulationCoarse:this._synthChannels[channel].ModRange.set_Coarse(data2),this._synthChannels[channel].UpdateCurrentMod();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.ModulationFine:this._synthChannels[channel].ModRange.set_Fine(data2),this._synthChannels[channel].UpdateCurrentMod();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.VolumeCoarse:this._synthChannels[channel].Volume.set_Coarse(data2);break;case AlphaSynth.Midi.Event.ControllerTypeEnum.VolumeFine:this._synthChannels[channel].Volume.set_Fine(data2);break;case AlphaSynth.Midi.Event.ControllerTypeEnum.PanCoarse:this._synthChannels[channel].Pan.set_Coarse(data2),this._synthChannels[channel].UpdateCurrentPan();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.PanFine:this._synthChannels[channel].Pan.set_Fine(data2),this._synthChannels[channel].UpdateCurrentPan();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.ExpressionControllerCoarse:this._synthChannels[channel].Expression.set_Coarse(data2),this._synthChannels[channel].UpdateCurrentVolume();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.ExpressionControllerFine:this._synthChannels[channel].Expression.set_Fine(data2),this._synthChannels[channel].UpdateCurrentVolume();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.HoldPedal:!this._synthChannels[channel].HoldPedal||data2>63||this.ReleaseHoldPedal(channel),this._synthChannels[channel].HoldPedal=data2>63;break;case AlphaSynth.Midi.Event.ControllerTypeEnum.LegatoPedal:this._synthChannels[channel].LegatoPedal=data2>63;break;case AlphaSynth.Midi.Event.ControllerTypeEnum.NonRegisteredParameterCourse:this._synthChannels[channel].Rpn.set_Combined(16383);break;case AlphaSynth.Midi.Event.ControllerTypeEnum.NonRegisteredParameterFine:this._synthChannels[channel].Rpn.set_Combined(16383);break;case AlphaSynth.Midi.Event.ControllerTypeEnum.RegisteredParameterCourse:this._synthChannels[channel].Rpn.set_Coarse(data2);break;case AlphaSynth.Midi.Event.ControllerTypeEnum.RegisteredParameterFine:this._synthChannels[channel].Rpn.set_Fine(data2);break;case AlphaSynth.Midi.Event.ControllerTypeEnum.AllNotesOff:this.NoteOffAll(!1);break;case AlphaSynth.Midi.Event.ControllerTypeEnum.DataEntryCoarse:switch(this._synthChannels[channel].Rpn.get_Combined()){case 0:this._synthChannels[channel].PitchBendRangeCoarse=data2,this._synthChannels[channel].UpdateCurrentPitch();break;case 1:this._synthChannels[channel].MasterFineTune.set_Coarse(data2);break;case 2:this._synthChannels[channel].MasterCoarseTune=data2-64|0}break;case AlphaSynth.Midi.Event.ControllerTypeEnum.DataEntryFine:switch(this._synthChannels[channel].Rpn.get_Combined()){case 0:this._synthChannels[channel].PitchBendRangeFine=data2,this._synthChannels[channel].UpdateCurrentPitch();break;case 1:this._synthChannels[channel].MasterFineTune.set_Fine(data2)}break;case AlphaSynth.Midi.Event.ControllerTypeEnum.ResetControllers:this._synthChannels[channel].Expression.set_Combined(16383),this._synthChannels[channel].ModRange.set_Combined(0),this._synthChannels[channel].HoldPedal&&this.ReleaseHoldPedal(channel),this._synthChannels[channel].HoldPedal=!1,this._synthChannels[channel].LegatoPedal=!1,this._synthChannels[channel].Rpn.set_Combined(16383),this._synthChannels[channel].PitchBend.set_Combined(8192),this._synthChannels[channel].ChannelAfterTouch=0,this._synthChannels[channel].UpdateCurrentPitch(),this._synthChannels[channel].UpdateCurrentVolume();break;default:return}break;case AlphaSynth.Midi.Event.MidiEventTypeEnum.ProgramChange:this._synthChannels[channel].Program=data1;break;case AlphaSynth.Midi.Event.MidiEventTypeEnum.ChannelAftertouch:this._synthChannels[channel].ChannelAfterTouch=data2;break;case AlphaSynth.Midi.Event.MidiEventTypeEnum.PitchBend:this._synthChannels[channel].PitchBend.set_Coarse(data2),this._synthChannels[channel].PitchBend.set_Fine(data1),this._synthChannels[channel].UpdateCurrentPitch()}this.FireMidiMessageProcessed(e)},AddMidiMessageProcessed:function(listener){this._midiMessageProcessed.push(listener)},FireMidiMessageProcessed:function(e){for(var i=0;i<this._midiMessageProcessed.length;i++){var l=this._midiMessageProcessed[i];null!=l&&l(e)}},ReleaseAllHoldPedals:function(){for(var node=this._voiceManager.ActiveVoices.First;null!=node;)node.Value.VoiceParams.NoteOffPending&&(node.Value.Stop(),this._voiceManager.RemoveVoiceFromRegistry(node.Value)),node=node.get_Next()},ReleaseHoldPedal:function(channel){for(var node=this._voiceManager.ActiveVoices.First;null!=node;)node.Value.VoiceParams.Channel==channel&&node.Value.VoiceParams.NoteOffPending&&(node.Value.Stop(),this._voiceManager.RemoveVoiceFromRegistry(node.Value)),node=node.get_Next()}},AlphaSynth.Util.PcmData=function(bits,pcmData,isDataInLittleEndianFormat){if(this.Data=null,this.Length=0,this.BytesPerSample=0,this.BytesPerSample=bits/8|0,pcmData.length%this.BytesPerSample!=0)throw $CreateException(new System.Exception.ctor$$String("Invalid PCM format. The PCM data was an invalid size."),new Error);this.Data=pcmData,this.Length=this.Data.length/this.BytesPerSample|0,AlphaSynth.Platform.TypeUtils.IsLittleEndian!=isDataInLittleEndianFormat&&AlphaSynth.Util.WaveHelper.SwapEndianess(this.Data,bits)},AlphaSynth.Util.PcmData.prototype={get_BitsPerSample:function(){return 8*this.BytesPerSample}},AlphaSynth.Util.PcmData.Create=function(bits,pcmData,isDataInLittleEndianFormat){switch(bits){case 8:return new AlphaSynth.Util.PcmData8Bit(bits,pcmData,isDataInLittleEndianFormat);case 16:return new AlphaSynth.Util.PcmData16Bit(bits,pcmData,isDataInLittleEndianFormat);case 24:return new AlphaSynth.Util.PcmData24Bit(bits,pcmData,isDataInLittleEndianFormat);case 32:return new AlphaSynth.Util.PcmData32Bit(bits,pcmData,isDataInLittleEndianFormat);default:throw $CreateException(new System.Exception.ctor$$String("Invalid PCM format. "+bits+"bit pcm data is not supported."),new Error)}},AlphaSynth.Util.PcmData8Bit=function(bits,pcmData,isDataInLittleEndianFormat){AlphaSynth.Util.PcmData.call(this,bits,pcmData,isDataInLittleEndianFormat)},AlphaSynth.Util.PcmData8Bit.prototype={get_Item:function(index){return this.Data[index]/255*2-1}},$Inherit(AlphaSynth.Util.PcmData8Bit,AlphaSynth.Util.PcmData),AlphaSynth.Util.PcmData16Bit=function(bits,pcmData,isDataInLittleEndianFormat){AlphaSynth.Util.PcmData.call(this,bits,pcmData,isDataInLittleEndianFormat)},AlphaSynth.Util.PcmData16Bit.prototype={get_Item:function(index){return index*=2,((this.Data[index]|this.Data[index+1]<<8)<<16>>16)/32768}},$Inherit(AlphaSynth.Util.PcmData16Bit,AlphaSynth.Util.PcmData),AlphaSynth.Util.PcmData24Bit=function(bits,pcmData,isDataInLittleEndianFormat){AlphaSynth.Util.PcmData.call(this,bits,pcmData,isDataInLittleEndianFormat)},AlphaSynth.Util.PcmData24Bit.prototype={get_Item:function(index){return index*=3,((this.Data[index]|this.Data[index+1]<<8|this.Data[index+2]<<16)<<12>>12)/8388608}},$Inherit(AlphaSynth.Util.PcmData24Bit,AlphaSynth.Util.PcmData),AlphaSynth.Util.PcmData32Bit=function(bits,pcmData,isDataInLittleEndianFormat){AlphaSynth.Util.PcmData.call(this,bits,pcmData,isDataInLittleEndianFormat)},AlphaSynth.Util.PcmData32Bit.prototype={get_Item:function(index){return index*=4,(this.Data[index]|this.Data[index+1]<<8|this.Data[index+2]<<16|this.Data[index+3]<<24)/2147484e3}},$Inherit(AlphaSynth.Util.PcmData32Bit,AlphaSynth.Util.PcmData),AlphaSynth.Util.Tables=function(){},$StaticConstructor(function(){AlphaSynth.Util.Tables._isInitialized=!1,AlphaSynth.Util.Tables._envelopeTables=null,AlphaSynth.Util.Tables._semitoneTable=null,AlphaSynth.Util.Tables._centTable=null,AlphaSynth.Util.Tables._sincTable=null}),AlphaSynth.Util.Tables.EnvelopeTables=function(index){return AlphaSynth.Util.Tables._isInitialized||AlphaSynth.Util.Tables.Init(),AlphaSynth.Util.Tables._envelopeTables[index]},AlphaSynth.Util.Tables.SemitoneTable=function(index){return AlphaSynth.Util.Tables._isInitialized||AlphaSynth.Util.Tables.Init(),AlphaSynth.Util.Tables._semitoneTable[index]},AlphaSynth.Util.Tables.CentTable=function(index){return AlphaSynth.Util.Tables._isInitialized||AlphaSynth.Util.Tables.Init(),AlphaSynth.Util.Tables._centTable[index]},AlphaSynth.Util.Tables.SincTable=function(index){return AlphaSynth.Util.Tables._isInitialized||AlphaSynth.Util.Tables.Init(),AlphaSynth.Util.Tables._sincTable[index]},AlphaSynth.Util.Tables.Init=function(){var EnvelopeSize=64,ExponentialCoeff=.09;AlphaSynth.Util.Tables._envelopeTables=new Array(4),AlphaSynth.Util.Tables._envelopeTables[0]=AlphaSynth.Util.Tables.RemoveDenormals(AlphaSynth.Util.Tables.CreateSustainTable(EnvelopeSize)),AlphaSynth.Util.Tables._envelopeTables[1]=AlphaSynth.Util.Tables.RemoveDenormals(AlphaSynth.Util.Tables.CreateLinearTable(EnvelopeSize)),AlphaSynth.Util.Tables._envelopeTables[2]=AlphaSynth.Util.Tables.RemoveDenormals(AlphaSynth.Util.Tables.CreateExponentialTable(EnvelopeSize,ExponentialCoeff)),AlphaSynth.Util.Tables._envelopeTables[3]=AlphaSynth.Util.Tables.RemoveDenormals(AlphaSynth.Util.Tables.CreateSineTable(EnvelopeSize)),AlphaSynth.Util.Tables._centTable=AlphaSynth.Util.Tables.CreateCentTable(),AlphaSynth.Util.Tables._semitoneTable=AlphaSynth.Util.Tables.CreateSemitoneTable(),AlphaSynth.Util.Tables._sincTable=AlphaSynth.Util.Tables.CreateSincTable(16,64,.43,AlphaSynth.Util.Tables.HammingWindow),AlphaSynth.Util.Tables._isInitialized=!0},AlphaSynth.Util.Tables.CreateSquareTable=function(size,k){for(var FourOverPi=1.27323954473516,squaretable=new Float32Array(size),inc=1/size,phase=0,x=0;size>x;x++){for(var value=0,i=1;k+1>i;i++){var twokminus1=2*i-1;value+=Math.sin(6.28318530717958*twokminus1*phase)/twokminus1}squaretable[x]=AlphaSynth.Synthesis.SynthHelper.ClampF(FourOverPi*value,-1,1),phase+=inc}return squaretable},AlphaSynth.Util.Tables.CreateCentTable=function(){for(var cents=new Float32Array(201),x=0;x<cents.length;x++)cents[x]=Math.pow(2,(x-100)/1200);return cents},AlphaSynth.Util.Tables.CreateSemitoneTable=function(){for(var table=new Float32Array(255),x=0;x<table.length;x++)table[x]=Math.pow(2,(x-127)/12);return table},AlphaSynth.Util.Tables.CreateSustainTable=function(size){for(var table=new Float32Array(size),x=0;size>x;x++)table[x]=1;return table},AlphaSynth.Util.Tables.CreateLinearTable=function(size){for(var table=new Float32Array(size),x=0;size>x;x++)table[x]=x/(size-1);return table},AlphaSynth.Util.Tables.CreateExponentialTable=function(size,coeff){coeff=AlphaSynth.Synthesis.SynthHelper.ClampF(coeff,.001,.9);for(var graph=new Float32Array(size),val=0,x=0;size>x;x++)graph[x]=val,val+=coeff*(1.58730158730159-val);for(var x=0;size>x;x++)graph[x]=graph[x]/graph[graph.length-1];return graph},AlphaSynth.Util.Tables.CreateSineTable=function(size){for(var graph=new Float32Array(size),inc=4.712389/(size-1),phase=0,x=0;size>x;x++)graph[x]=Math.abs(Math.sin(phase)),phase+=inc;return graph},AlphaSynth.Util.Tables.RemoveDenormals=function(data){for(var x=0;x<data.length;x++)Math.abs(data[x])<1e-38&&(data[x]=0);return data},AlphaSynth.Util.Tables.VonHannWindow=function(i,size){return.5-.5*Math.cos(6.28318530717958*(.5+i/size))},AlphaSynth.Util.Tables.HammingWindow=function(i,size){return.54-.46*Math.cos(6.28318530717958*i/size)},AlphaSynth.Util.Tables.BlackmanWindow=function(i,size){return.42659-.49656*Math.cos(6.28318530717958*i/size)+.076849*Math.cos(12.5663706143592*i/size)},AlphaSynth.Util.Tables.CreateSincTable=function(windowSize,resolution,cornerRatio,windowFunction){for(var subWindow=(windowSize/2|0)+1,table=new Float32Array(subWindow*resolution),gain=2*cornerRatio,x=0;subWindow>x;x++)for(var y=0;resolution>y;y++){var a=x+y/resolution,sinc=6.28318530717958*cornerRatio*a;sinc=Math.abs(sinc)>1e-5?Math.sin(sinc)/sinc:1,table[64*x+y]=gain*sinc*windowFunction(a,windowSize)}return table},AlphaSynth.Util.SynthConstants=function(){},$StaticConstructor(function(){AlphaSynth.Util.SynthConstants.InterpolationMode=AlphaSynth.Bank.Components.Generators.Interpolation.Linear,AlphaSynth.Util.SynthConstants.SampleRate=44100,AlphaSynth.Util.SynthConstants.Pi=3.14159265358979,AlphaSynth.Util.SynthConstants.TwoPi=6.28318530717958,AlphaSynth.Util.SynthConstants.HalfPi=1.5707963267949,AlphaSynth.Util.SynthConstants.InverseSqrtOfTwo=.707106781186,AlphaSynth.Util.SynthConstants.DefaultLfoFrequency=8,AlphaSynth.Util.SynthConstants.DefaultModDepth=100,AlphaSynth.Util.SynthConstants.DefaultPolyphony=40,AlphaSynth.Util.SynthConstants.MinPolyphony=5,AlphaSynth.Util.SynthConstants.MaxPolyphony=250,AlphaSynth.Util.SynthConstants.DefaultBlockSize=64,AlphaSynth.Util.SynthConstants.MaxBufferSize=.05,AlphaSynth.Util.SynthConstants.MinBufferSize=.001,AlphaSynth.Util.SynthConstants.DenormLimit=1e-38,AlphaSynth.Util.SynthConstants.NonAudible=1e-5,AlphaSynth.Util.SynthConstants.SincWidth=16,AlphaSynth.Util.SynthConstants.SincResolution=64,AlphaSynth.Util.SynthConstants.MaxVoiceComponents=4,AlphaSynth.Util.SynthConstants.DefaultChannelCount=16,AlphaSynth.Util.SynthConstants.DefaultKeyCount=128}),AlphaSynth.Util.IOHelper=function(){},AlphaSynth.Util.IOHelper.ReadInt32LE=function(input){var ch1=input.ReadByte(),ch2=input.ReadByte(),ch3=input.ReadByte(),ch4=input.ReadByte();return ch4<<24|ch3<<16|ch2<<8|ch1<<0},AlphaSynth.Util.IOHelper.ReadUInt16LE=function(input){var ch1=input.ReadByte(),ch2=input.ReadByte();return ch2<<8|ch1<<0&65535},AlphaSynth.Util.IOHelper.ReadInt16LE=function(input){var ch1=input.ReadByte(),ch2=input.ReadByte();return AlphaSynth.Platform.TypeUtils.ToInt16(ch2<<8|ch1<<0)},AlphaSynth.Util.IOHelper.ReadInt32BE=function(input){var ch1=input.ReadByte(),ch2=input.ReadByte(),ch3=input.ReadByte(),ch4=input.ReadByte();return ch1<<24|ch2<<16|ch3<<8|ch4<<0},AlphaSynth.Util.IOHelper.ReadUInt16BE=function(input){var ch1=input.ReadByte(),ch2=input.ReadByte();return ch1<<8|ch2<<0&65535},AlphaSynth.Util.IOHelper.ReadInt16BE=function(input){var ch1=input.ReadByte(),ch2=input.ReadByte();return AlphaSynth.Platform.TypeUtils.ToInt16(ch1<<8|ch2<<0)},AlphaSynth.Util.IOHelper.ReadByteArray=function(input,length){var v=new Uint8Array(length);return input.Read(v,0,length),v},AlphaSynth.Util.IOHelper.Read8BitChars=function(input,length){for(var s=new Array,i=0;length>i;i++)s.push(String.fromCharCode(input.ReadByte()));return s.join("")},AlphaSynth.Util.IOHelper.Read8BitString=function(input){for(var s=new Array,c=input.ReadByte();0!=c;)s.push(String.fromCharCode(c)),c=input.ReadByte();return s.join("")},AlphaSynth.Util.IOHelper.Read8BitStringLength=function(input,length){for(var s=new Array,z=-1,i=0;length>i;i++){var c=input.ReadByte();0==c&&-1==z&&(z=i),s.push(String.fromCharCode(c))}var t=s.join("");return z>=0?t.substr(0,z):t},AlphaSynth.Util.IOHelper.ReadSInt8=function(input){var v=input.ReadByte();return-256*((255&v)>>7)+(255&v)},AlphaSynth.Util.IOHelper.ReadUInt32=function(input){var ch1=input.ReadByte(),ch2=input.ReadByte(),ch3=input.ReadByte(),ch4=input.ReadByte();return ch1<<24|ch2<<16|ch3<<8|ch4<<0},AlphaSynth.Util.IOHelper.ReadInt24=function(input,index){var i;return AlphaSynth.Platform.TypeUtils.IsLittleEndian?(i=input[index]|input[index+1]<<8|input[index+2]<<16,8388608==(8388608&i)&&(i=-16777216|i)):(i=input[index]<<16|input[index+1]<<8|input[index+2],256==(256&i)&&(i=255|i)),i},AlphaSynth.Util.IOHelper.ReadInt16=function(input,index){return AlphaSynth.Platform.TypeUtils.ToInt16(AlphaSynth.Platform.TypeUtils.IsLittleEndian?input[index]|input[index+1]<<8:input[index]<<8|input[index+1])},AlphaSynth.Util.WaveHelper=function(){},AlphaSynth.Util.WaveHelper.SwapEndianess=function(data,bits){bits/=8;for(var swapArray=new Uint8Array(bits),x=0;x<data.length;x+=bits)swapArray.set(data.subarray(x,x+bits),0),AlphaSynth.Platform.Std.Reverse(swapArray),data.set(swapArray.subarray(0,0+bits),x)};for(var i=0;i<$StaticConstructors.length;i++)$StaticConstructors[i]();