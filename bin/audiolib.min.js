this.audioLib=(function AUDIOLIB(s,j){var p=s.Float32Array||Array,e=this;function b(w){var x=new p(w);x.subarray=x.subarray||x.slice;return x}e.Float32Array=b;function u(B,x,y,C,A){this.attack=x||50;this.decay=y||50;this.sustain=C||1;this.release=A||50;this.value=0;var E=this,w=3,z=false,D=[function(){E.value+=1000/E.sampleRate/E.attack;if(E.value>=1){w=1}},function(){E.value-=1000/E.sampleRate/E.decay*E.sustain;if(E.value<=E.sustain){w=2}},function(){E.value=E.sustain},function(){E.value=j.max(0,E.value-1000/E.sampleRate/E.release)}];this.generate=function(){D[w]();return this.value};this.triggerGate=function(F){z=F;w=z?0:3};this.sampleRate=B}function v(){var E=this,B=[];this.velocity=0;this.legato=0;this.retrigger=0;this.polyphony=1;this.activeKeys=[];this.voices=[];this.pitchBend=0;function C(F,G){this.key=F;this.velocity=G;this.noteOff=function(){};this.onKeyChange=function(){};this.changeKey=function(I,H){this.key=I;this.v=H;this.onKeyChange()};this.getFrequency=function(){return E.getFrequencyForKey(this.key)};E.voice.apply(this)}function z(G){var F;for(F=0;F<B.length;F++){if(B[F].key===G){B.splice(F--,1)}}}function D(F,G){z(F);B.push({key:F,velocity:G})}function x(){var F,H,G=[];if(E.legato===0){G=B.slice(0)}else{if(E.legato===1){for(F=0;F<B.length;F++){for(H=0;H<G.length;H++){if(H===B.length-1||(G[H-1].key>B[F].key&&G[H].key<B[F].key)){G.splice(H,0,B[F]);break}}}}else{if(E.legato===2){for(F=0;F<B.length;F++){for(H=0;H<G.length;H++){if(H===B.length-1||(G[H-1].key<B[F].key&&G[H].key>B[F].key)){G.splice(H,0,B[F]);break}}}}}}E.activeKeys=G.slice(-E.polyphony)}function w(){if(!E.voice){return}var F,H,G;if(E.polyphony===1&&E.activeKeys.length>0){F=E.activeKeys.length-1;if(E.voices.length===0){E.voices.push(new C(E.activeKeys[F].key,E.activeKeys[F].velocity))}else{E.voices[0].changeKey(E.activeKeys[F].key,E.activeKeys[F].velocity)}}else{for(H=0;H<E.activeKeys.length;H++){G=false;for(F=0;F<E.voices.length;F++){if(E.voices[F].key===E.activeKeys[H].key){G=true;break}}if(!G){E.voices.push(new C(E.activeKeys[F].key,E.activeKeys[F].velocity))}}}for(F=0;F<E.voices.length;F++){G=false;for(H=0;H<E.activeKeys.length;H++){if(E.voices[F].key===E.activeKeys[H].key){G=true;break}}if(!G){E.voices[F].noteOff();E.voices.splice(F--,1)}}}function A(G,H){var F=E.activeKeys.length;D(G,H);x();w();E.onNoteOn(G,H);if(E.retrigger===0||(F===0&&E.activeKeys.length>0)){E.onTrigger()}}function y(F,G){z(F,G);x();w();E.onNoteOff(F,G);if(E.activeKeys===0){E.onRelease()}}this.onMidi=function(F){switch(F.status){case 9:A(F.data1,F.data2/127);break;case 8:y(F.data1,F.data2/127);break;case 14:E.pitchBend=(F.data1*128+F.data2-8192)/8192;break}};this.getFrequencyForKey=function(F){return 440*j.pow(1.059,F-69)};this.getFrequency=function(){var G=[],F;for(F=0;F<E.activeKeys.length;F++){G.push(E.getFrequencyForKey(E.activeKeys[F].key))}if(G.length>2){return G[0]}return G};this.onTrigger=function(){};this.onRelease=function(){};this.onNoteOn=function(){};this.onNoteOff=function(){};this.voice=null;this.listener=function(F){E.onMidi(F)}}function t(A,x,z,B){var y=this,w=0;y.sampleRate=A;y.stepLength=x||200;y.steps=z||[1,0];y.value=0;y.attack=B||0;y.generate=function(){var E=y.sampleRate/1000*y.stepLength,G=y.steps,F=E*G.length,I,C,D,H,J;if(++w===F){w=0}I=w/F*G.length;C=I%1;I=j.floor(I);D=(I||G.length)-1;H=G[I]-G[D];J=G[I];if(C<y.attack){J-=H-H/y.attack*C}y.value=J;return J};y.triggerGate=function(){w=0}}function o(E,w,z,A){var F=this,y=new b(w),x=w-1,C=z,D=0,B=0;this.volume=F.volume||1;F.sampleRate=E;F.pushSample=function(G){y[C++]=G;B=y[D++]*F.volume;if(C>=x){C=0}if(D>=x){D=0}return B};F.getMix=function(){return B}}function r(D,A,z,w){var E=this,y,x,C;E.delayTime=A||30;E.depth=z||3;E.freq=w||0.1;function B(){y=new b(E.sampleRate*0.1);x=0;var G,F=y.length;for(G=0;G<F;G++){y[G]=0}}E.sampleRate=D;E.osc=new c(D,w);E.calcCoeff=B;E.pushSample=function(G){if(++x>=y.length){x=0}y[x]=G;E.osc.generate();var F=E.delayTime+E.osc.getMix()*E.depth;F*=E.sampleRate/1000;F=x-j.floor(F);while(F<0){F+=y.length}C=y[F];return C};E.getMix=function(){return C};B()}function f(G,C,A){var K=this,B=(!G?44100:G)*2,F=new b(B),E=0,D=0,z=0,J=0,H=j.floor;function I(){D=B/K.samplerate/K.time*1000;z=K.time}function x(M,O,N){var L=O;while(L++!==N){if(L>=B){L=0}F[L]=M}}function y(L){F[E++]+=L;if(E>K.time/1000*K.samplerate){E=0}F[E]=F[E]*K.feedback}function w(M){var L=H(E);if(z!==K.time){I()}E+=D;if(E>=B){E-=B}x(M+F[H(E)]*K.feedback,L,H(E))}this.time=!C?1000:C;this.feedback=0;this.algorithm=0;this.samplerate=G;this.pushSample=function(L){if(this.algorithm===0){y(L)}else{w(L)}J=F[H(E)];return J};this.getMix=function(){return J}}function m(w){var A=new g(w,720.484),z=new g(w,723.431),y=new g(w,1),x=0;this.gain=4;this.master=1;this.sampleRate=w;this.filters=[A,z,y];this.pushSample=function(B){A.pushSample(B);x=A.getMix(1)*this.gain;x=j.atan(x)+x;if(x>0.4){x=0.4}else{if(x<-0.4){x=-0.4}}z.pushSample(x);y.pushSample(z.getMix(0));x=y.getMix(1)*this.master;return x};this.getMix=function(){return x}}(function(x,w){w.Capper=function(z,A){var y=this,B=0;y.sampleRate=z;y.cap=A||1;y.pushSample=function(C){B=C>y.cap?2*y.cap-C:C<-y.cap?-2*y.cap-C:C;return B};y.getMix=function(){return B}};w.Expo=function(z,A){var y=this;sample=0;y.sampleRate=z;y.param=A||0.8;y.pushSample=function(B){sample=(B<0?-j.pow(y.param*2,-B):j.pow(y.param*2,B))/10;return sample};y.getMix=function(){return sample}}}(this,e));function g(B,x,I,G){var J=this,D=[0,0,0,0],w,z,H,y,F=j.sin,A=j.min,C=j.pow;J.cutoff=!x?20000:x;J.resonance=!I?0.1:I;J.samplerate=B;J.type=G||0;function E(){w=2*F(j.PI*A(0.25,J.cutoff/(J.samplerate*2)));z=A(2*(1-C(J.resonance,0.25)),A(2,2/w-w*0.5))}J.pushSample=function(K){if(H!==J.cutoff||y!==J.resonance){E();H=J.cutoff;y=J.resonance}D[3]=K-z*D[2];D[0]=D[0]+w*D[2];D[1]=D[3]-D[0];D[2]=w*D[1]+D[2];D[3]=K-z*D[2];D[0]=D[0]+w*D[2];D[1]=D[3]-D[0];D[2]=w*D[1]+D[2];return D[J.type]};J.getMix=function(K){return D[K||J.type]}}function a(y,z,A){var w=this,x=[0,0];w.cutoff=!z?20000:z;w.resonance=!A?0:A;w.samplerate=y;w.pushSample=function(C){var B=w.cutoff*2/w.samplerate,D=w.resonance+w.resonance/(1-B);x[0]=x[0]+B*(C-x[0]+D*(x[0]-x[1]));x[1]=x[1]+B*(x[0]-x[1]);return x[1]};w.getMix=function(){return x[1]}}function q(C,z,J){var K=this,H=0,B=0,E=j.PI*2,G,y,x,F,I,A;K.cutoff=!z?20000:z;K.resonance=!J?1:J;K.samplerate=C;function D(){G=E*K.cutoff/K.samplerate;y=1-G/(2*(K.resonance+0.5/(1+G))+G-2);x=y*y;F=x+1-2*j.cos(G)*y}K.pushSample=function(w){if(I!==K.cutoff||A!==K.resonance){D();I=K.cutoff;A=K.resonance}H+=(w-B)*F;B+=H;H*=x;return B};K.getMix=function(){return B};D()}function c(z,C){var x=0,B=0,y=j.PI*2,w=new b(1),A;this.frequency=440;if(C){this.frequency=C}this.phaseOffset=0;this.pulseWidth=0.5;this.waveShape=0;this.samplerate=z;this.generate=function(){var G=this.frequency+0,F=this.pulseWidth,E,D=arguments.length;for(E=0;E<D;E++){G+=G*arguments[E]}x=(x+G/this.samplerate/2)%1;B=(x+this.phaseOffset)%1;B=B<F?B/F:(B-F)/(1-F)};this.getMix=function(){return A[this.waveShape]()};this.getPhase=function(){return B};this.reset=function(){x=0};this.setWavetable=function(D){w=D;return true};this.sine=function(){return j.sin(B*y)};this.triangle=function(){if(B<0.5){return 4*B-1}return 3-4*B};this.square=function(){return(B<0.5)?-1:1};this.sawtooth=function(){return 1-B*2};this.invSawtooth=function(){return B*2-1};this.pulse=function(){if(B<0.5){if(B<0.25){return B*8-1}else{return 1-(B-0.25)*8}}return -1};this.wavetable=function(){return w[j.floor(B*w.length)]};A=this.waveShapes=[this.sine,this.triangle,this.pulse,this.sawtooth,this.invSawtooth,this.square]}function d(y,A,B){var x=this,w=[],z;x.sampleRate=y;x.sample=A;x.pitch=B||440;x.delayStart=0;x.delayEnd=0;x.maxVoices=0;x.noteOn=function(G){G=G||x.pitch;var F=G/x.pitch,E=x.sampleRate,H=E*x.delayStart,C=x.sample.length-E*x.delayEnd,D={f:G,p:H,s:F,l:C};w.push(D);return D};x.generate=function(){var C,D;for(C=0;C<w.length;C++){D=w[C];D.p+=D.s;D.p>D.l&&w.splice(C--,1)&&D.onend&&D.onend()}};x.getMix=function(E){var D=0,C;E=E||0;for(C=0;C<w.length;C++){D+=d.interpolate(x.samples[E],w[C].p)}return D};x.load=function(F,E){var C=x.samples=d.splitChannels(F.data,F.channelCount),D;if(E){for(D=0;D<C.length;D++){C[D]=d.resample(C[D],F.sampleRate,1,x.sampleRate,1)}}x.sample=E?d.resample(C,F.sampleRate,1,x.sampleRate,1):C}}d.interpolate=function(w,A){var z=j.floor(A),y=z+1,x=A-z;y=y<w.length?y:0;return w[z]*(1-x)+w[y]*x};d.resample=function(C,w,F,G,y){var A=G/w*y/F,B=C.length,x=j.ceil(B/A),E=new b(x),D,z;for(D=0,z=0;D<B;D+=A){E[z++]=d.interpolate(C,D)}return E};d.splitChannels=function(x,B){var w=x.length,A=w/B,y=[],z,C;for(z=0;z<B;z++){y[z]=new b(A);for(C=0;C<A;C++){y[z][C]=x[z*B+C]}}return y};d.joinChannels=function(y){var A=y.length,x=y[0].length,w=new b(x*A),z,B;for(z=0;z<A;z++){for(B=0;B<x;B++){w[z+B*A]=y[z][B]}}return w};(function(w){function B(I){var K,J=I.length,H={};for(K=0;K<J;K++){H[I[K]]=true}return H}var E=B([256,512,1024,2048,4096,8192,16384]),x=B([48000,44100,22050]),G=String.fromCharCode;function F(M,L,K,J){var I=F.devices,H;for(H in I){if(I.hasOwnProperty(H)&&I[H].enabled){try{return new I[H](M,L,K,J)}catch(N){}}}throw"No audio device available."}function y(H){this.boundTo=H;this.buffers=[];H.activeRecordings.push(this)}y.prototype={add:function(H){this.buffers.push(H)},clear:function(){this.buffers=[]},stop:function(){var H=this.boundTo.activeRecordings,I;for(I=0;I<H.length;I++){if(H[I]===this){H.splice(I--,1)}}},join:function(){var L=0,M=0,J=this.buffers,H,N,K,I=J.length;for(K=0;K<I;K++){L+=J[K].length}H=new b(L);for(K=0;K<I;K++){for(N=0;N<J[K].length;N++){H[M+N]=J[K][N]}M+=J[K].length}return H}};function D(H){this.type=H}D.prototype={record:function(){return new y(this)},recordData:function(I){var K=this.activeRecordings,J,H=K.length;for(J=0;J<H;J++){K[J].add(I)}},writeBuffers:function(J){var I=this.buffers,H=J.length,K,M,L,N;if(I){for(L=0;L<I.length;L++){K=I[L];M=K.length;for(N=0;N<H&&N<M;N++){J[N]+=K[N]}I[L]=K.subarray(N);L>=M&&I.splice(L--,1)}}},writeBuffer:function(I){var H=this.buffers=this.buffers||[];H.push(I);return H.length}};function C(R,O,I,T){T=x[T]?T:44100;I=E[I]?I:T/2;var V=this,K=0,S=null,Q=new Audio(),P,N,M,L,H;function U(ab,X){var aa,Z,W;if(C.backgroundWork){if(window.MozBlobBuilder){W=new MozBlobBuilder();W.append('setInterval(function(){ postMessage("tic"); }, '+X+");");Z=window.URL.createObjectURL(W.getBlob());aa=new Worker(Z);aa.onmessage=function(){ab()};return function(){aa.terminate();window.URL.revokeObjectURL(Z)}}Z=W=+new Date+"";function Y(ac){if(ac.source===window&&ac.data===Z&&W<+new Date){W=+new Date+X;ab()}window.postMessage(Z,"*")}window.addEventListener("message",Y,true);window.postMessage(Z,"*");return function(){window.removeEventListener("message",Y)}}else{aa=setInterval(ab,X);return function(){clearInterval(aa)}}}function J(){if(S){P=Q.mozWriteAudio(S);K+=P;if(P<S.length){S=S.subarray(P);return S}S=null}N=Q.mozCurrentSampleOffset();M=Number(N+I*O-K)+0;if(M>0){L=new b(M);R&&R(L,V.channelCount);V.writeBuffers(L);V.recordData(L);P=Q.mozWriteAudio(L);if(P<L.length){S=L.subarray(P)}K+=P}}Q.mozSetup(O,T);H=U(J,20);this.kill=function(){H()};this.activeRecordings=[];this.sampleRate=T;this.channelCount=O;this.type="moz"}C.enabled=true;C.backgroundWork=false;C.prototype=new D("moz");function A(M,L,I,O){O=x[O]?O:44100;I=E[I]?I:4096;var P=this,H=new (window.AudioContext||webkitAudioContext)(),K=H.createJavaScriptNode(I,0,L),N=H.createBufferSource();function J(X){var Q=X.outputBuffer,T=Q.numberOfChannels,V,S,U=Q.length,Y=Q.size,W=new Array(T),R=new b(U*T);for(V=0;V<T;V++){W[V]=Q.getChannelData(V)}M&&M(R,T);P.writeBuffers(R);P.recordData(R);for(V=0;V<U;V++){for(S=0;S<T;S++){W[S][V]=R[V*T+S]}}}K.onaudioprocess=J;N.connect(K);K.connect(H.destination);this.kill=function(){};this.activeRecordings=[];this.sampleRate=H.sampleRate;this.channelCount=L;this.type="webkit"}A.enabled=true;A.prototype=new D("webkit");function z(M,L,K,J){J=x[J]?J:44100;K=E[K]?bufferSize:8192;var H=this,N;function I(){var O=new b(K*L);M&&M(O,H.channelCount);H.writeBuffers(O);H.recordData(O)}this.kill=function(){clearInterval(N)};this.activeRecordings=[];setInterval(I,K/J*1000);this.sampleRate=J;this.channelCount=L;this.type="dummy"}z.enabled=true;z.prototype=new D("dummy");F.deviceClass=D;F.propertyEnum=B;F.devices={moz:C,webkit:A,dummy:z};F.Recording=y;w.AudioDevice=F}(this));this.AudioDevice.createScheduled=function(A){var z=[],w=0,x;function y(C,F){var B=C.length/F,I=x.chunkSize,E=I*F,H,D,G;w=+new Date;for(D=0;D<B;D+=I){for(H=0;H<z.length;H++){z[H].t-=I;if(z[H].t<=0){z[H].f.apply(z[H].x,z[H].a);z.splice(H--,1)}}G=D*E;A(C.subarray(G,G+E),F)}}x=this.apply(this,[y].concat(Array.prototype.splice.call(arguments,1)));x.schedule=function(D,C,B){z.push({f:D,x:C,a:B,t:((new Date-w)*0.001*this.sampleRate)})};x.chunkSize=1;return x};(function(){function w(){var y=arguments,x=y.length,A,z;for(z=0;z<x;z++){A=y[z];this.postMessage({type:"injection",code:A instanceof Function?"("+String(A)+").call(this);":A})}}e.AudioWorker=function(z,B){var x=new (window.MozBlobBuilder||window.BlobBuilder)(),y,A;x.append("var audioLib = ("+String(AUDIOLIB)+"(this, Math));\n");B&&x.append('this.addEventListener("message",function(e){e.data&&e.data.type==="injection"&&Function(e.data.code).call(this)}, true);\n');x.append(z instanceof Function?"("+String(z)+").call(this);":z);y=window.URL.createObjectURL(x.getBlob());A=new Worker(y);A._terminate=A.terminate;A.terminate=function(){window.URL.revokeObjectURL(id);return A._terminate.call(A,arguments)};if(B){A.inject=w}return A}}());(function(x,z){var G=String.fromCharCode,E=true,A=false;function B(y,H){return H?G(y&255)+B(y>>8,H-1):""}function D(y,H){return H?D(y>>8,H-1)+G(255-y&255):""}function F(y,H,I){return I?D(y,H):B(y,H)}function w(L,K){var y=L.length,J=y-1,M=0,I=z.pow,H;if(K){for(H=0;H<y;H++){M+=(255-L.charCodeAt(H))*I(256,J-H)}}else{for(H=0;H<y;H++){M+=L.charCodeAt(H)*I(256,H)}}return M}function C(K,P,J,S){var O=z.pow,N=z.floor,H=C.convertFromBinary,Q=C.convertToBinary,y=K/8,M=O(2,K),R=M/2,T=R-1,L=1/R,I=1/T;return S?J?P?function(U,V){U=N(U<0?U*R+M:U*T);return Q(U,y,V)}:function(U,V){return Q(N(U*T),y,V)}:P?function(U,V){return Q(U<0?U+M:U,y,V)}:function(U,V){return Q(U,y,V)}:J?P?function(W,V){var U=H(W,V);return U>T?(U-M)*L:U*I}:function(V,U){return H(V,U)*I}:P?function(W,V){var U=H(W,V);return U>T?U-M:U}:function(V,U){return H(V,U)}}C.convertToBinary=F;C.convertFromBinary=w;C.fromFloat32=C(32,E,E,E);C.toFloat32=C(32,E,E,A);C.fromFloat24=C(24,E,E,E);C.toFloat24=C(24,E,E,A);C.fromFloat16=C(16,E,E,E);C.toFloat16=C(16,E,E,A);C.fromFloat8=C(8,E,E,E);C.toFloat8=C(8,E,E,A);C.fromInt32=C(32,E,A,E);C.toInt32=C(32,E,A,A);C.fromInt16=C(16,E,A,E);C.toInt16=C(16,E,A,A);C.fromInt8=C(8,E,A,E);C.toInt8=C(8,E,A,A);C.fromUint32=C(32,A,A,E);C.toUint32=C(32,A,A,A);C.fromUint16=C(16,A,A,E);C.toUint16=C(16,A,A,A);C.fromUint8=C(8,A,A,E);C.toUint8=C(8,A,A,A);x.Binary=C}(this,j));(function(A,B){function C(D){this.data=D}var z=C.prototype={read:function(E){var D=this,F=D.data.substr(0,E);D.skip(E);return F},skip:function(E){var D=this,F=D.data=D.data.substr(E);D.pointer+=E;return F.length},readBuffer:function(E,H,J){var F=this,I="read"+J+H,K=H/8,D=E.length,G=0;while(F.data&&G<D){E[G++]=F[I]()}return G}},y,x;function w(G,E,F){var D=E/8;z["read"+G+E]=function(H){return F(this.read(D),H)}}for(y in B){x=/to([a-z]+)([0-9]+)/i.exec(y);x&&w(x[1],x[2],B[y])}A.Stream=C;C.newType=w}(this,this.Binary));this.PCMData=(function(w,x){function y(z){return(typeof z==="string"?y.decode:y.encode)(z)}y.decodeFrame=function(B,A,z){(new x(B)).readBuffer(z,A,"Float");return z};y.encodeFrame=function(E,C){var A=w["fromFloat"+C],z=E.length,D="",B;for(B=0;B<z;B++){D+=A(E[B])}return D};y.decode=function(Y,X){var C=new x(Y),I=C.read(4),Q=C.readUint32();C=new x(C.read(Q));var F=C.read(4),H=C.read(4),O=C.readUint32(),z=new x(C.read(O)),B=z.readUint16(),T=z.readUint16(),W=z.readUint32(),D=z.readUint32(),V=z.readUint16(),U=V/T,G=O===16?z.readUint16():z.readUint32(),A,K,M,R,P,E,S,N={},J={channelCount:T,bytesPerSample:V/T,sampleRate:D/V,chunks:N,data:P};function L(){A=C.read(4);K=C.readUint32();R=C.read(K);E=N[A]=N[A]||[];if(A==="data"){M=~~(K/U);P=J.data=new (typeof b!=="undefined"?b:Array)(M);y.decodeFrame(R,U*8,P)}else{E.push(R)}X&&(C.data?setTimeout(L,1):X(J))}if(X){C.data?L():X(J)}else{while(C.data){L()}}return J};y.encode=function(R,P){var L=w.fromUint32,S=w.fromUint16,I=R.data,z=R.sampleRate,D=R.channelCount||1,N=R.bytesPerSample||1,E=N*8,B=D*N,O=z*B,C=I.length,A=C*N,H=j.pow(2,E-1)-1,G=[],F="",Q,M,J,K;G.push("fmt "+L(16)+S(1)+S(D)+L(z)+L(O)+S(B)+S(E));G.push("data"+L(A)+y.encodeFrame(I,E));K=R.chunks;if(K){for(M in K){if(K.hasOwnProperty(M)){Q=K[M];for(J=0;J<Q.length;J++){F=Q[J];G.push(M+L(F.length)+F)}}}}G=G.join("");G="RIFF"+L(G.length)+"WAVE"+G;P&&setTimeout(function(){P(G)},1);return G};return y}(this.Binary,this.Stream));(function(x,y){var E=y.sin,I=y.cos,H=y.sqrt,C=y.floor,D=y.pow,w=y.ln2,B=y.PI,A=B*2;function z(K,J,L){K.sampleRate=J;K.bufferSize=L;K.bandWidth=0.5*L*J*0.5;K.spectrum=new b(L*0.5);K.real=new b(L);K.imag=new b(L);K.peakBand=K.peak=0;K.getBandFrequency=function(M){return this.bandwidth*M+this.bandwidth*0.5};K.calculateSpectrum=function(){var X=this,T=X.spectrum,U=X.real,M=X.imag,W=0.5*X.bufferSize,O=H,S=L*0.5,R,V,Q,P;for(P=0;P<S;P++){R=U[P];V=M[P];Q=W*O(R*R+V*V);if(Q>X.peak){X.peakBand=P;X.peak=Q}}}}function G(K,J,L){return new G[K](J,L)}function F(K,Q){var J=this,O=Q*Q*0.5,M=new b(O),P=new b(O),L;z(J,K,Q);for(L=0;L<O;L++){M[L]=E(L*A/Q);P[L]=I(L*A/Q)}J.forward=function(V){var aa=this,Y=aa.real,R=aa.imag,X=aa.bufferSize*0.5,T=V.length,W,Z,U,S,ab;for(U=0;U<X;U++){W=Z=0;for(S=0;S<T;S++){W+=P[ab=U*S]*V[S];Z+=M[ab]*V[S]}Y[U]=W;R[U]=Z}return aa.calculateSpectrum()}}x.FourierTransform=G;G.DFT=F}(this,j));e.ADSREnvelope=u;e.MidiEventTracker=v;e.StepSequencer=t;e.AllPassFilter=o;e.Chorus=r;e.Delay=f;e.Distortion=m;e.IIRFilter=g;e.LowPassFilter=a;e.LP12Filter=q;e.Oscillator=c;e.Sampler=d;function l(){}l.prototype={type:"effect",sink:true,source:true,mix:0.5,join:function(){return n.apply(0,[this].concat(Array.prototype.splice.call(arguments,0)))}};function n(){var w=Array.prototype.splice.call(arguments,0),x=w.prototype=n.prototype;for(i in x){if(x.hasOwnProperty(i)){w[i]=x[i]}}return w}(function(w){n.prototype=w;w.pushSample=function(A){var x=this,z,y;for(y=0;y<x.length;y++){z=x[y].mix;A=x[y].pushSample(A)*z+A*(1-z)}return A}}(new l()));function h(y,x,w){this.channelCount=x;this.effects=[];function z(){y.apply(this,w)}z.prototype=y.prototype;while(x--){this.effects.push(new z())}}h.prototype={mix:0.5,append:function(x){var y=this,A=y.channelCount,w=x.length,z,B;for(z=0;z<w;z+=A){for(B=0;B<A;B++){x[z+B]=y.effects[B].pushSample(x[z+B])*y.mix+x[z+B]*(1-y.mix)}}return x},join:function(){return BufferEffectChain.apply(0,[this].concat(Array.prototype.splice.call(arguments,0)))}};(function(B,y,A,x,z){A=e.effects={};function w(C){return new e.BufferEffect(this,C,[].slice.call(arguments,1))}for(y=0;y<B.length;y++){x=B[y];A[x]=e[x];z=A[x].prototype=new l();z.name=z.fxid=x;A[x].createBufferBased=w}}(["AllPassFilter","Chorus","Delay","Distortion","IIRFilter","LowPassFilter","LP12Filter"]));function k(w,x){var y=w[0].toUpperCase()+w.substr(1).toLowerCase();k[w]=x;if(x.decode){e.Sampler.prototype["load"+y]=function(z){this.load.apply(this,[k[w].decode(z)].concat([].slice.call(arguments,1)))}}if(x.encode){e.AudioDevice.Recording.prototype["to"+y]=function(z){return k[w].encode({data:this.join(),sampleRate:this.boundTo.sampleRate,channelCount:this.boundTo.channelCount,bytesPerSample:z})}}return x}k("wav",e.PCMData);e.EffectChain=n;e.EffectClass=l;e.BufferEffect=h;e.codecs=e.Codec=k;e.version="0.4.7";return e}).call(typeof exports==="undefined"?{}:this,this.window||global,Math);